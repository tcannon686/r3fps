(this.webpackJsonpr3fps=this.webpackJsonpr3fps||[]).push([[0],{129:function(e,t,n){},130:function(e,t,n){},146:function(e,t,n){"use strict";n.r(t);var c=n(0),r=n.n(c),a=n(21),o=n.n(a),i=(n(129),n(130),n(14)),s=n(5),u=n(13),j=n(12),l=n(197),b=n(199),p=n(209),d=n(204),f=n(200),O=n(208),h=n(201),m=n(107),v=n.n(m),x=n(106),g=n.n(x),y=n(103),C=n.n(y),k=n(105),S=n.n(k),M=n(104),w=n.n(M),V=n(191),E=n(190),z=n(19),P=n(18),D=n(29),N=n(25),R=n(2),B=Object(c.createContext)(Object(P.h)({}));function L(e){var t=e.children,n=Object(c.useMemo)((function(){return Object(P.h)({})}),[]);return Object(R.jsx)(B.Provider,{value:n,children:t})}function I(e){var t=e.children,n=Object(c.useMemo)((function(){return Object(P.h)({})}),[]);return Object(N.b)((function(e,t){n.update(Math.min(t,.1))})),Object(R.jsx)(B.Provider,{value:n,children:t})}function F(e,t){var n=Object(c.useMemo)((function(){return Object(P.b)(t)}),[t]),r=Object(c.useContext)(B);return Object(c.useEffect)((function(){e.current.matrixAutoUpdate=!1;var t=Object(P.d)(n).subscribe((function(){e.current&&e.current.matrix.copy(n.transform)}));return r.add(n),function(){t.unsubscribe(),r.remove(n)}}),[n,r,e]),n}function W(e){do{e.set(Math.random()-Math.random(),Math.random()-Math.random(),Math.random()-Math.random())}while(0===e.lengthSq());e.normalize()}function A(e){var t=Object(c.useRef)(null);return Object(c.useMemo)((function(){t.current&&t.current.dispose();var n=function(e){for(var t=new j.BufferGeometry,n=[],c=[],r=function(e,t,n){var r=c[n].clone().sub(c[e]),a=c[n].clone().sub(c[t]),o=r.cross(a);if(0===o.lengthSq())return null;o.normalize();var i=o.dot(c[n]);return{ia:e,ib:t,ic:n,normal:o,distance:i}},a=new Map,o=function(e,t){var n=e+67108864*t,c=t+67108864*e;a.has(c)?a.set(c,a.get(c)+1):a.set(n,(a.get(n)||0)+1)},i=function(){var t=new j.Vector3;do{W(t),e(t)}while(c.some((function(e){return e.equals(t)})));c.push(t)};c.length<3;)i();var s=new j.Vector3,u=r(0,2,1);if(s.copy(u.normal).negate(),e(s),c.some((function(e){return e.equals(s)}))){u.normal.negate();var l=c[0];c[0]=c[2],c[2]=l,s.copy(u.normal).negate(),e(s)}c.push(s),n.push(u),n.push(r(0,1,3)),n.push(r(1,2,3)),n.push(r(2,0,3));for(var b=!1;!b;){b=!0;var p,d=Object(D.a)(n);try{var f=function(){var t=p.value;a.clear();var i=(new j.Vector3).copy(t.normal);if(e(i),!c.some((function(e){return i.equals(e)}))&&i.dot(t.normal)-t.distance>.01){b=!1;for(var s=0;s<n.length;s++){var u=n[s];i.clone().sub(c[u.ia]).dot(u.normal)>=0&&(o(u.ia,u.ib),o(u.ib,u.ic),o(u.ic,u.ia),n.splice(s,1),s--)}c.push(i);var l,d=Object(D.a)(a.keys());try{for(d.s();!(l=d.n()).done;){var f=l.value;if(1===a.get(f)){var O=67108863&f,h=Math.floor(f/67108864),m=r(O,h,c.length-1);n.push(m)}}}catch(v){d.e(v)}finally{d.f()}}};for(d.s();!(p=d.n()).done;)f()}catch(m){d.e(m)}finally{d.f()}}!function(){var e=new Map;n.forEach((function(t){e.has(t.ia)||e.set(t.ia,[]),e.has(t.ib)||e.set(t.ib,[]),e.has(t.ic)||e.set(t.ic,[]),e.get(t.ia).push(t),e.get(t.ib).push(t),e.get(t.ic).push(t)})),e.forEach((function(e,t){var n=[[e[0]]];e.forEach((function(e){var t,c=Object(D.a)(n);try{for(c.s();!(t=c.n()).done;){var r=t.value,a=e.normal.dot(r[0].normal);if(Math.acos(Math.max(-1,Math.min(1,a)))<Math.PI/4)return void r.push(e)}}catch(m){c.e(m)}finally{c.f()}n.push([e])}));for(var r=1;r<n.length;r++)n[r].forEach((function(e){e.ia===t&&(e.ia=c.length),e.ib===t&&(e.ib=c.length),e.ic===t&&(e.ic=c.length)})),c.push(c[t])}))}();var O=new Float32Array(c.flatMap((function(e){return[e.x,e.y,e.z]}))),h=n.flatMap((function(e){return[e.ia,e.ib,e.ic]}));return t.setAttribute("position",new j.BufferAttribute(O,3)),t.setIndex(h),t.computeVertexNormals(),t.attributes.normal.needsUpdate=!0,t.computeBoundingSphere(),t}(e);return t.current=n,n}),[e])}function U(e){var t=e.support,n=e.position,r=e.rotation,a=e.scale,o=e.kinematic,i=(e.userData,e.color),l=Object(z.a)(e,["support","position","rotation","scale","kinematic","userData","color"]);n=n||[0,0,0],r=r||[0,0,0],a=a||[1,1,1];var b=Object(c.useMemo)((function(){return{supports:[t],isKinematic:o}}),[t,o]),p=Object(c.useRef)(),d=F(p,b),f=r,O=Object(u.a)(f,3),h=O[0],m=O[1],v=O[2],x=a,g=Object(u.a)(x,3),y=g[0],C=g[1],k=g[2],S=n,M=Object(u.a)(S,3),w=M[0],V=M[1],E=M[2];Object(c.useEffect)((function(){d.transform.identity(),d.transform.multiply((new j.Matrix4).makeRotationFromEuler(new j.Euler(h*Math.PI/180,m*Math.PI/180,v*Math.PI/180))),d.transform.multiply((new j.Matrix4).makeScale(y,C,k)),d.transform.setPosition(w,V,E),d.velocity.set(0,0,0),d.update()}),[d,w,V,E,h,m,v,y,C,k]);var P=A(t);return Object(R.jsx)("mesh",Object(s.a)(Object(s.a)({ref:p,geometry:P,position:n,rotation:r,scale:a},l),{},{children:Object(R.jsx)("meshStandardMaterial",{color:i})}))}function q(e){var t=e.support,n=e.roundRadius,r=e.flatTop,a=e.flatBottom,o=Object(z.a)(e,["support","roundRadius","flatTop","flatBottom"]),i=n||0,u=Object(c.useMemo)((function(){return i>0?r?a?Object(P.e)({radius:i}):Object(P.j)(Object(P.e)({radius:i}),Object(P.i)({radius:i})):a?Object(P.j)(Object(P.i)({radius:i}),Object(P.e)({radius:i})):Object(P.i)({radius:i}):null}),[i,r,a]),j=Object(c.useMemo)((function(){return i>0?Object(P.k)(t,u):t}),[t,u,i]);return Object(R.jsx)(U,Object(s.a)({support:j},o))}var G=n(11),T=n(184),J=n(202);function X(e){var t=e.selection,n=e.data,r=e.onChange,a=e.prop,o=e.label,l=e.defaultValue,b=Object(c.useMemo)((function(){var e=new j.Vector3,c=new j.Vector3;return n.objects.forEach((function(n){t.has(n.id)&&(n.props[a]?c.set.apply(c,Object(i.a)(n.props[a])):c.set.apply(c,Object(i.a)(l)),e.add(c))})),e.multiplyScalar(1/t.size),[e.x,e.y,e.z]}),[t,n,a,l]),p=Object(c.useState)(l),d=Object(u.a)(p,2),f=d[0],O=d[1],h=Object(u.a)(b,3),m=h[0],v=h[1],x=h[2];Object(c.useEffect)((function(){O([m,v,x].map((function(e){return Math.round(1e3*e)/1e3})))}),[m,v,x]);var g=function(){if(f.some((function(e){return isNaN(e)})))O(b);else{var e=Object(s.a)(Object(s.a)({},n),{},{objects:n.objects.map((function(e){if(t.has(e.id)){for(var n=Object(i.a)(e.props[a]||l),c=0;c<n.length;c++)n[c]+=f[c]-b[c];return Object(s.a)(Object(s.a)({},e),{},{props:Object(s.a)(Object(s.a)({},e.props),{},Object(G.a)({},a,n))})}return e}))});r(e)}};return Object(R.jsx)(T.a,{container:!0,spacing:1,children:["x","y","z"].map((function(e,t){return Object(R.jsx)(T.a,{item:!0,xs:4,children:Object(R.jsx)(J.a,{label:(o?o+" ":"")+e.toUpperCase(),variant:"filled",value:f[t],onChange:function(e){return function(e,t){var n=Object(i.a)(f);n[e]=t,O(n)}(t,e.target.value)},onBlur:g})},e)}))})}var Y={key:"position",displayName:"Position",component:function(e){var t=e.selection,n=e.data,c=e.onChange;return Object(R.jsx)(X,{prop:"position",selection:t,data:n,onChange:c,defaultValue:[0,0,0]})}};var K={key:"rotation",displayName:"Rotation",component:function(e){var t=e.selection,n=e.data,c=e.onChange;return Object(R.jsx)(X,{prop:"rotation",selection:t,data:n,onChange:c,defaultValue:[0,0,0]})}};var Q={key:"scale",displayName:"Scale",component:function(e){var t=e.selection,n=e.data,c=e.onChange;return Object(R.jsx)(X,{prop:"scale",selection:t,data:n,onChange:c,defaultValue:[1,1,1]})}},Z=n(203),H=n(205),$=n(192),_=Object(V.a)((function(e){return{evenlySpaced:{"& > *":{margin:e.spacing(1)}}}}));function ee(e){var t=e.selection,n=e.data,r=e.onChange,a=e.prop,o=e.defaultValue,i=e.label,j=_(),l=Object(c.useMemo)((function(){var e=o;return n.objects.forEach((function(n){t.has(n.id)&&void 0!==n.props[a]&&(e=n.props[a])})),e}),[t,n,a,o]),b=Object(c.useState)(o),p=Object(u.a)(b,2),d=p[0],f=p[1];Object(c.useEffect)((function(){f(l)}),[l]);return Object(R.jsx)(Z.a,{className:j.evenlySpaced,children:Object(R.jsx)($.a,{control:Object(R.jsx)(H.a,{variant:"filled",checked:d,onChange:function(e){var c=e.target.checked;f(c);var o=Object(s.a)(Object(s.a)({},n),{},{objects:n.objects.map((function(e){return t.has(e.id)?Object(s.a)(Object(s.a)({},e),{},{props:Object(s.a)(Object(s.a)({},e.props),{},Object(G.a)({},a,c))}):e}))});r(o)}}),label:i})})}var te={key:"body",displayName:"Body",component:function(e){var t=e.selection,n=e.data,c=e.onChange;return Object(R.jsx)(ee,{prop:"kinematic",selection:t,data:n,onChange:c,defaultValue:!0,label:"Kinematic"})}};function ne(e){var t=e.selection,n=e.data,r=e.onChange,a=e.prop,o=e.defaultValue,i=Object(c.useMemo)((function(){var e=o;return n.objects.forEach((function(n){t.has(n.id)&&void 0!==n.props[a]&&(e=n.props[a])})),e}),[t,n,a,o]),j=Object(c.useState)(o),l=Object(u.a)(j,2),b=l[0],p=l[1];Object(c.useEffect)((function(){p(i)}),[i]);return Object(R.jsx)("input",{type:"color",value:b,onChange:function(e){var c=e.target.value;p(c);var o=Object(s.a)(Object(s.a)({},n),{},{objects:n.objects.map((function(e){return t.has(e.id)?Object(s.a)(Object(s.a)({},e),{},{props:Object(s.a)(Object(s.a)({},e.props),{},Object(G.a)({},a,c))}):e}))});r(o)}})}var ce={key:"color",displayName:"Color",component:function(e){var t=e.selection,n=e.data,c=e.onChange;return Object(R.jsx)(ne,{prop:"color",selection:t,data:n,onChange:c,defaultValue:"#ffffff"})}},re=Object(V.a)((function(e){return{evenlySpaced:{"& > *":{margin:e.spacing(1)}}}}));function ae(e){var t=e.selection,n=e.data,r=e.onChange,a=e.prop,o=e.defaultValue,i=e.label,j=re(),l=Object(c.useMemo)((function(){var e=0;return n.objects.forEach((function(n){t.has(n.id)&&(void 0!==n.props[a]?e+=n.props[a]:e+=o)})),e*=1/t.size}),[t,n,a,o]),b=Object(c.useState)(o),p=Object(u.a)(b,2),d=p[0],f=p[1];Object(c.useEffect)((function(){f(Math.round(1e3*l)/1e3)}),[l]);return Object(R.jsx)(Z.a,{className:j.evenlySpaced,children:Object(R.jsx)(J.a,{fullWidth:!0,label:i,variant:"filled",value:d,onChange:function(e){return f(e.target.value)},onBlur:function(){if(isNaN(d))f(l);else{var e=Object(s.a)(Object(s.a)({},n),{},{objects:n.objects.map((function(e){if(t.has(e.id)){var n=void 0!==e.props[a]?e.props[a]:o;return n+=d-l,Object(s.a)(Object(s.a)({},e),{},{props:Object(s.a)(Object(s.a)({},e.props),{},Object(G.a)({},a,n))})}return e}))});r(e)}}})})}var oe=[Y,K,Q,te,ce],ie=[].concat(oe,[{key:"roundBrush",displayName:"Round brush",component:function(e){var t=e.selection,n=e.data,c=e.onChange;return Object(R.jsxs)(Z.a,{children:[Object(R.jsx)(ae,{prop:"roundRadius",selection:t,data:n,onChange:c,defaultValue:0,label:"Round radius"}),Object(R.jsx)(ee,{prop:"flatTop",selection:t,data:n,onChange:c,defaultValue:!1,label:"Flat top"}),Object(R.jsx)(ee,{prop:"flatBottom",selection:t,data:n,onChange:c,defaultValue:!1,label:"Flat bottom"})]})}}]),se=[Y,ce];var ue={key:"boxSize",displayName:"Size",component:function(e){var t=e.selection,n=e.data,c=e.onChange;return Object(R.jsx)(X,{prop:"size",selection:t,data:n,onChange:c,defaultValue:[1,1,1]})}};var je={key:"box",displayName:"Box",inspectors:[].concat(Object(i.a)(ie),[ue]),component:function(e){var t=e.size,n=Object(z.a)(e,["size"]),r=t=t||[1,1,1],a=Object(u.a)(r,3),o=a[0],i=a[1],j=a[2],l=Object(c.useMemo)((function(){return Object(P.c)({size:[o,i,j]})}),[o,i,j]);return Object(R.jsx)(q,Object(s.a)({support:l},n))}};var le={key:"sphereSize",displayName:"Size",component:function(e){var t=e.selection,n=e.data,c=e.onChange;return Object(R.jsx)(ae,{prop:"radius",selection:t,data:n,onChange:c,defaultValue:.5,label:"Radius"})}};var be={key:"sphere",displayName:"Sphere",inspectors:[].concat(Object(i.a)(oe),[le]),component:function(e){var t=e.radius,n=Object(z.a)(e,["radius"]);t=t||.5;var r=Object(c.useMemo)((function(){return Object(P.i)({radius:t})}),[t]);return Object(R.jsx)(U,Object(s.a)({support:r},n))}};var pe={key:"cylinderSize",displayName:"Size",component:function(e){var t=e.selection,n=e.data,c=e.onChange;return Object(R.jsxs)(Z.a,{children:[Object(R.jsx)(ae,{prop:"r1",selection:t,data:n,onChange:c,defaultValue:.5,label:"Radius 1"}),Object(R.jsx)(ae,{prop:"r2",selection:t,data:n,onChange:c,defaultValue:.5,label:"Radius 2"}),Object(R.jsx)(ae,{prop:"height",selection:t,data:n,onChange:c,defaultValue:1,label:"Height"})]})}};var de={key:"cylinder",displayName:"Cylinder",inspectors:[].concat(Object(i.a)(ie),[pe]),component:function(e){var t=e.height,n=e.r1,r=e.r2,a=Object(z.a)(e,["height","r1","r2"]);n=n||.5,r=r||.5,t=t||1;var o=Object(c.useMemo)((function(){return Object(P.g)(Object(P.e)({position:[0,-t/2,0],radius:n}),Object(P.e)({position:[0,t/2,0],radius:r}))}),[t,n,r]);return Object(R.jsx)(q,Object(s.a)({support:o},a))}},fe={key:"pointLight",displayName:"Point Light",inspectors:Object(i.a)(se),component:function(e){var t=e.position,n=e.color,c=e.inEditor,r=Object(z.a)(e,["position","color","inEditor"]);return n=n||"#ffffff",t=t||[0,0,0],Object(R.jsxs)("group",{position:t,children:[c&&Object(R.jsxs)("mesh",{children:[Object(R.jsx)("meshBasicMaterial",{color:n}),Object(R.jsx)("sphereGeometry",{args:[.25,16,8]})]}),Object(R.jsx)("pointLight",Object(s.a)({color:n},r))]})}},Oe={key:"ambientLight",displayName:"Ambient Light",inspectors:Object(i.a)(se),component:function(e){var t=e.position,n=e.color,c=e.inEditor,r=Object(z.a)(e,["position","color","inEditor"]);return n=n||"#ffffff",t=t||[0,0,0],Object(R.jsxs)("group",{position:t,children:[c&&Object(R.jsxs)("mesh",{children:[Object(R.jsx)("meshBasicMaterial",{color:n}),Object(R.jsx)("sphereGeometry",{args:[.25,16,8]})]}),Object(R.jsx)("ambientLight",Object(s.a)({color:n},r))]})}},he={key:"directionalLight",displayName:"Directional Light",inspectors:Object(i.a)(se),component:function(e){var t=e.position,n=e.color,c=e.inEditor,r=Object(z.a)(e,["position","color","inEditor"]);return n=n||"#ffffff",t=t||[0,0,0],Object(R.jsxs)("group",{position:t,children:[c&&Object(R.jsxs)("mesh",{children:[Object(R.jsx)("meshBasicMaterial",{color:n}),Object(R.jsx)("sphereGeometry",{args:[.25,16,8]})]}),Object(R.jsx)("directionalLight",Object(s.a)({color:n},r))]})}};function me(e){var t=e.selection,n=e.data,r=e.onChange,a=e.prop,o=e.label,l=e.defaultValue,b=Object(c.useMemo)((function(){var e=new j.Vector2,c=new j.Vector2;return n.objects.forEach((function(n){t.has(n.id)&&(n.props[a]?c.set.apply(c,Object(i.a)(n.props[a])):c.set.apply(c,Object(i.a)(l)),e.add(c))})),e.multiplyScalar(1/t.size),[e.x,e.y]}),[t,n,a,l]),p=Object(c.useState)(l),d=Object(u.a)(p,2),f=d[0],O=d[1],h=Object(u.a)(b,2),m=h[0],v=h[1];Object(c.useEffect)((function(){O([m,v].map((function(e){return Math.round(1e3*e)/1e3})))}),[m,v]);var x=function(){if(f.some((function(e){return isNaN(e)})))O(b);else{var e=Object(s.a)(Object(s.a)({},n),{},{objects:n.objects.map((function(e){if(t.has(e.id)){for(var n=Object(i.a)(e.props[a]||l),c=0;c<n.length;c++)n[c]+=f[c]-b[c];return Object(s.a)(Object(s.a)({},e),{},{props:Object(s.a)(Object(s.a)({},e.props),{},Object(G.a)({},a,n))})}return e}))});r(e)}};return Object(R.jsx)(T.a,{container:!0,spacing:1,children:["x","y"].map((function(e,t){return Object(R.jsx)(T.a,{item:!0,xs:6,children:Object(R.jsx)(J.a,{label:(o?o+" ":"")+e.toUpperCase(),variant:"filled",value:f[t],onChange:function(e){return function(e,t){var n=Object(i.a)(f);n[e]=t,O(n)}(t,e.target.value)},onBlur:x})},e)}))})}var ve={key:"room",displayName:"Room",component:function(e){var t=e.selection,n=e.data,c=e.onChange,r=[.5,.5];return Object(R.jsxs)(Z.a,{children:[Object(R.jsx)(me,{label:"Left door size",prop:"leftDoorSize",selection:t,data:n,onChange:c,defaultValue:r}),Object(R.jsx)(me,{label:"Right door size",prop:"rightDoorSize",selection:t,data:n,onChange:c,defaultValue:r}),Object(R.jsx)(me,{label:"Front door size",prop:"frontDoorSize",selection:t,data:n,onChange:c,defaultValue:r}),Object(R.jsx)(me,{label:"Back door size",prop:"backDoorSize",selection:t,data:n,onChange:c,defaultValue:r})]})}},xe={key:"room",displayName:"Room",inspectors:[].concat(Object(i.a)(oe),[ue,ve]),component:function(e){var t=e.size,n=e.thickness,r=e.frontDoorSize,a=e.leftDoorSize,o=e.rightDoorSize,i=e.backDoorSize,j=Object(z.a)(e,["size","thickness","frontDoorSize","leftDoorSize","rightDoorSize","backDoorSize"]);n=n||.1;var l=t=t||[1,1,1],b=Object(u.a)(l,3),p=b[0],d=b[1],f=b[2],O=Object(c.useMemo)((function(){return[.5,.5]}),[]),h=Object(c.useMemo)((function(){return[[i||O,2,-1],[r||O,2,1],[[0,0],1,-1],[[0,0],1,1],[a||O,0,-1],[o||O,0,1]]}),[r,a,o,i,O]),m=Object(c.useMemo)((function(){return h.flatMap((function(e){var t=Object(u.a)(e,3),c=t[0],r=t[1],a=t[2];return function(e){var t=e.thickness,n=e.axisIndex,c=e.side,r=e.size,a=e.doorSize;if(a.some((function(e){return e<=0}))||1===n){var o=0===n?t:r[0]-2*t,i=1===n?t:r[1],s=2===n?t:0===n?r[2]:r[2]-2*t,u=[0,0,0];return u[n]=(r[n]-t)*c/2,[Object(P.c)({position:u,size:[o,i,s]})]}var j=[0===n?t:r[0]-2*t,1===n?t:r[1],2===n?t:0===n?r[2]:r[2]-2*t],l=[].concat(j),b=[0,0,0];b[n]=(r[n]-t)*c/2;var p=[].concat(b),d=[].concat(b);p[2-n]+=(j[2-n]+a[0])/4,d[2-n]-=(j[2-n]+a[0])/4,j[2-n]=(j[2-n]-a[0])/2;var f=[].concat(b);return f[1]+=a[1]/2,l[1]-=a[1],l[2-n]=a[0],j.every((function(e){return e>0}))&&l.every((function(e){return e>0}))?[Object(P.c)({position:p,size:j}),Object(P.c)({position:d,size:j}),Object(P.c)({position:f,size:l})]:[]}({thickness:n,axisIndex:r,size:[p,d,f],side:a,doorSize:c})}))}),[p,d,f,n,h]);return Object(R.jsx)(R.Fragment,{children:m.map((function(e,t){return Object(R.jsx)(U,Object(s.a)({support:e},j),t)}))})}};var ge=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.05,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.15,c=new j.CylinderGeometry(t,t,1,e,1).translate(0,.5,0);return c.merge(new j.ConeGeometry(n,.5,e,1).translate(0,1.25,0)),c}();function ye(){return ge}function Ce(e,t){Object(c.useEffect)((function(){return document.addEventListener(e,t),function(){document.removeEventListener(e,t)}}),[e,t])}function ke(){var e=Object(c.useRef)({});return Ce("keydown",Object(c.useCallback)((function(t){e.current[1===t.key.length?t.key.toUpperCase():t.key]=!0}),[])),Ce("keyup",Object(c.useCallback)((function(t){e.current[1===t.key.length?t.key.toUpperCase():t.key]=!1}),[])),e}function Se(e,t){var n=Object(c.useRef)({});Ce("keydown",Object(c.useCallback)((function(c){n.current[1===c.key.length?c.key.toUpperCase():c.key]=!0,c.target===document.body&&e.every((function(e){return n.current[e]}))&&Object.keys(n.current).filter((function(e){return n.current[e]})).every((function(t){return e.includes(t)}))&&t()}),[e,t])),Ce("keyup",Object(c.useCallback)((function(e){n.current[1===e.key.length?e.key.toUpperCase():e.key]=!1}),[]))}function Me(e){var t=e.color,n=e.position,r=e.rotation,a=ye(),o=A(Object(c.useMemo)((function(){return Object(P.g)(Object(P.i)({radius:.25}),Object(P.i)({position:[0,-1,0],radius:.25}))}),[]));return Object(R.jsxs)("group",{position:n,rotation:r.map((function(e){return e*Math.PI/180})),children:[Object(R.jsx)("mesh",{geometry:o,children:Object(R.jsx)("meshBasicMaterial",{color:t})}),Object(R.jsx)("mesh",{geometry:a,rotation:[-Math.PI/2,0,0],children:Object(R.jsx)("meshBasicMaterial",{color:t})})]})}var we={playerSpawn:{key:"playerSpawn",displayName:"Player Spawnpoint",inspectors:[Y,K],component:function(e){var t=e.position,n=e.rotation,c=e.inEditor;return Object(z.a)(e,["position","rotation","inEditor"]),c?(t=t||[0,0,0],n=n||[0,0,0],Object(R.jsx)(Me,{position:t,rotation:n,color:"#0000ff"})):null}},box:je,sphere:be,cylinder:de,pointLight:fe,ambientLight:Oe,directionalLight:he,room:xe},Ve=n(193),Ee=n(195),ze=n(194),Pe=n(196),De=n(100),Ne=n.n(De),Re=n(101),Be=n.n(Re);function Le(e){var t=Object(c.useState)(!0),n=Object(u.a)(t,2),r=n[0],a=n[1];return Object(R.jsxs)(R.Fragment,{children:[Object(R.jsxs)(Ve.a,{button:!0,onClick:function(){return a(!r)},children:[Object(R.jsx)(ze.a,{children:r?Object(R.jsx)(Ne.a,{}):Object(R.jsx)(Be.a,{})}),Object(R.jsx)(Ee.a,{children:e.title})]}),Object(R.jsx)(Pe.a,{in:r,children:Object(R.jsx)(Ve.a,{children:e.children})})]})}function Ie(e){var t=e.data,n=e.selection,c=e.onChange,r=t.objects.filter((function(e){return n.has(e.id)})),a=r.map((function(e){return we[e.type].inspectors})),o=r.length>0?a.reduce((function(e,t){return t.filter((function(t){return e.includes(t)}))})):[];return Object(R.jsx)("form",{noValidate:!0,children:Object(R.jsx)(E.a,{children:o.map((function(e){var r=e.component;return Object(R.jsx)(Le,{title:e.displayName,children:Object(R.jsx)(r,{data:t,selection:n,onChange:c})},e.key)}))})})}function Fe(e){var t=e.onClick,n=e.text,c=e.component,r=e.distance,a=c,o=1/Math.sqrt(3)*r;return Object(R.jsx)(T.a,{item:!0,xs:4,children:Object(R.jsx)(p.a,{title:"Add ".concat(n),children:Object(R.jsx)(l.a,{onClick:t,children:Object(R.jsx)("div",{style:{position:"relative",width:"1.0in",height:"1.0in",overflow:"hidden"},children:Object(R.jsx)(N.a,{camera:{position:[o,o,o]},invalidateFrameloop:!0,children:Object(R.jsxs)(L,{children:[Object(R.jsx)("directionalLight",{position:[1,3,2]}),Object(R.jsx)("ambientLight",{}),Object(R.jsx)(a,{inEditor:!0})]})})})})})})}function We(e){var t=e.onSelect,n=Object(c.useMemo)((function(){var e=[],n=function(n){e.push(Object(R.jsx)(Fe,{onClick:function(){return t(n)},text:we[n].displayName,component:we[n].component,distance:we[n].distance||2},n))};for(var c in we)n(c);return e}),[t]);return Object(R.jsx)(T.a,{container:!0,children:n})}var Ae=n(198);function Ue(e){var t=e.children,n=e.value,c=e.index,r=Object(z.a)(e,["children","value","index"]);return Object(R.jsx)(Ae.a,{in:n===c,style:{display:n===c?"block":"none"},children:Object(R.jsx)("div",Object(s.a)(Object(s.a)({role:"tabpanel"},r),{},{children:Object(R.jsx)(Z.a,{children:t})}))})}function qe(e){var t=e.onBeginDrag,n=e.onEndDrag,r=e.onDrag,a=e.color,o=e.direction,i=Object(z.a)(e,["onBeginDrag","onEndDrag","onDrag","color","direction"]),l=ye(),b=Object(c.useState)(),p=Object(u.a)(b,2),d=p[0],f=p[1],O=Object(u.a)(o,3),h=O[0],m=O[1],v=O[2],x=[Math.atan2(Math.sqrt(Math.pow(h,2)+Math.pow(v,2)),m),0,Math.atan2(-h,v)],g=Object(c.useCallback)((function(){f(!0)}),[f]),y=Object(c.useCallback)((function(){f(!1)}),[f]),C=Object(c.useRef)(new j.Vector3),k=Object(c.useRef)(),S=Object(c.useState)(!1),M=Object(u.a)(S,2),w=M[0],V=M[1],E=Object(c.useCallback)((function(e){e.stopPropagation(),e.target.setPointerCapture(e.pointerId),V(!0),C.current.set(0,0,0),t&&t()}),[V,t]),P=Object(c.useCallback)((function(e){e.stopPropagation(),e.target.releasePointerCapture(e.pointerId),V(!1),n&&n(C.current.clone())}),[V,n]),D=Object(N.c)(),B=D.camera,L=D.size,I=Object(c.useCallback)((function(e){var t=new j.Vector3,n=new j.Vector3(h,m,v);if(w){k.current.getWorldPosition(t),n.add(t),n.project(B),t.project(B),n.sub(t);var c=Math.sqrt(Math.pow(n.x,2)+Math.pow(n.y,2));n.multiplyScalar(1/c);var a=2*n.x*e.movementX/L.width-2*n.y*e.movementY/L.height;n.multiplyScalar(a),n.add(t),n.unproject(B),t.unproject(B),n.sub(t),r&&(C.current.add(n),r(n))}}),[w,r,B,h,m,v,L]);return Object(R.jsx)("mesh",Object(s.a)(Object(s.a)({geometry:l,onPointerDown:E,onPointerUp:P,onPointerMove:I,onPointerOver:g,onPointerLeave:y,rotation:x,ref:k,renderOrder:1e3},i),{},{children:Object(R.jsx)("meshBasicMaterial",{color:d||w?"#ffbb22":a})}))}function Ge(e){var t=e.position,n=e.onDrag,r=e.onBeginDrag,a=e.onEndDrag,o=Object(c.useRef)(),i=Object(c.useCallback)((function(){r&&r()}),[r]),s=Object(c.useCallback)((function(e){a&&a(e)}),[a]),l=Object(c.useCallback)((function(e){n&&n(e)}),[n]),b=Object(N.c)(),p=b.camera,d=b.gl,f=b.scene,O=Object(c.useMemo)((function(){return new j.Scene}),[]);Object(c.useEffect)((function(){O.clear(),O.add(o.current)}),[f,o,O]);var h=new j.Vector3;Object(N.b)((function(){o.current.getWorldPosition(h),h.applyMatrix4(p.matrixWorldInverse);var e=-.1*h.z;o.current.scale.set(e,e,e),d.clearDepth(),d.render(O,p)}),2);return Object(R.jsx)("group",{ref:o,position:t,children:[[[1,0,0],"#ff0000"],[[0,1,0],"#00ff00"],[[0,0,1],"#0000ff"]].map((function(e,t){var n=Object(u.a)(e,2),c=n[0],r=n[1];return Object(R.jsx)(qe,{direction:c,color:r,onDrag:l,onBeginDrag:i,onEndDrag:s},t)}))})}var Te=Object(c.forwardRef)((function(e,t){var n=e.position,r=e.mode,a=(Object(z.a)(e,["position","mode"]),Object(c.useRef)()),o=Object(N.c)().setDefaultCamera;Ce("mousemove",Object(c.useCallback)((function(e){"fps"===r&&(t.current.rotation.x-=.005*e.movementY,a.current.rotation.y-=.005*e.movementX)}),[r,t]));var i=ke();Object(c.useEffect)((function(){o(t.current)}),[o,t]);var s=Object(u.a)(n,3),l=s[0],b=s[1],p=s[2];Object(c.useEffect)((function(){a.current.position.set(l,b,p)}),[l,b,p]);var d=new j.Vector3,f=new j.Vector3,O=new j.Vector3;return Object(N.b)((function(e,n){if(t.current.updateMatrixWorld(),"fps"===r){var c=3*(i.current.Shift?4:1),o=a.current.position;t.current.matrixWorld.extractBasis(d,f,O),O.negate(),i.current.E&&o.addScaledVector(f,n*c),i.current.Q&&o.addScaledVector(f,-n*c),i.current.D&&o.addScaledVector(d,n*c),i.current.A&&o.addScaledVector(d,-n*c),i.current.W&&o.addScaledVector(O,n*c),i.current.S&&o.addScaledVector(O,-n*c)}})),Object(R.jsx)("group",{ref:a,children:Object(R.jsx)("perspectiveCamera",{ref:t})})})),Je=n(27);function Xe(){var e=Object(Je.a)();return Object(c.useMemo)((function(){return function(e){var t=new j.MeshMatcapMaterial({blending:j.CustomBlending,blendSrc:j.OneFactor,blendDst:j.DstAlphaFactor,color:(new j.Color).set(e),transparent:!0});return(new j.TextureLoader).load("/textures/matcap.png",(function(e){t.matcap=e,t.matcap=e})),t}(e.palette.secondary.main)}),[e])}function Ye(e){var t=e.selection,n=Xe();return Object(N.b)((function(e){var c=e.gl,r=e.scene,a=e.camera;if(c.autoClear=!1,c.clear(),c.render(r,a),t.size>0){var o=r.children.map((function(e){return e.visible}));r.children.forEach((function(e){e.visible=t.has(e.userData.id)})),r.overrideMaterial=n,c.render(r,a),r.children.forEach((function(e,t){e.visible=o[t]})),r.overrideMaterial=null}}),1),null}function Ke(e){var t=e.data,n=e.selection,r=e.onSelectionChange,a=e.onChange,o=e.onEdit,l=e.cameraRef,b=Object(c.useState)(),p=Object(u.a)(b,2),d=p[0],f=p[1];Ce("mouseup",(function(e){f()}));var O=Object(c.useCallback)((function(e){var t=new Set(n);t.has(e)?t.delete(e):t.add(e),r(t)}),[n,r]),h=Object(c.useCallback)((function(){r(new Set)}),[r]),m=Object(c.useCallback)((function(e){return Object(s.a)(Object(s.a)({},t),{},{objects:t.objects.map((function(t){if(n.has(t.id)){var c=t.props.position?[t.props.position[0]+e.x,t.props.position[1]+e.y,t.props.position[2]+e.z]:[e.x,e.y,e.z];return Object(s.a)(Object(s.a)({},t),{},{props:Object(s.a)(Object(s.a)({},t.props),{},{position:c})})}return t}))})}),[t,n]),v=Object(c.useState)(!1),x=Object(u.a)(v,2),g=x[0],y=x[1],C=Object(c.useCallback)((function(){y(!0)}),[y]),k=Object(c.useCallback)((function(e){a(m(e))}),[m,a]),S=Object(c.useCallback)((function(){o(t),y(!1)}),[t,o,y]),M=Object(c.useMemo)((function(){var e=new j.Vector3(0,0,0),c=new j.Vector3;return t.objects.forEach((function(t){n.has(t.id)&&(t.props.position?c.set.apply(c,Object(i.a)(t.props.position)):c.set(0,0,0),e.add(c))})),e.multiplyScalar(1/n.size),e}),[t,n]);Ce("keyup",(function(e){"Delete"===e.key&&e.target===document.body&&(a(Object(s.a)(Object(s.a)({},t),{},{objects:t.objects.filter((function(e){return!n.has(e.id)}))})),r(new Set))}));var w=t.objects.map((function(e,t){var n=we[e.type].component;return Object(R.jsx)("group",{userData:e,onPointerUp:function(t){t.stopPropagation(),g||"fps"===d||O(e.id)},children:Object(R.jsx)(n,Object(s.a)(Object(s.a)({},e.props),{},{inEditor:!0}))},e.id)}));return Object(R.jsxs)(N.a,{onMouseDown:function(e){2===e.buttons&&f("fps")},onContextMenu:function(e){e.preventDefault()},onPointerMissed:h,children:[Object(R.jsxs)(I,{children:[Object(R.jsx)(Te,{position:[0,0,2],mode:d,ref:l}),w,Object(R.jsx)(Ge,{onDrag:k,onBeginDrag:C,onEndDrag:S,position:[M.x,M.y,M.z]})]}),Object(R.jsx)(Ye,{selection:n})]})}var Qe=n(206);function Ze(e){var t=e.position,n=e.direction,r=e.speed,a=Object(c.useRef)(),o=F(a,Object(c.useMemo)((function(){return{supports:[Object(P.i)({radius:.25})]}}),[])),i=Object(u.a)(t,3),s=i[0],j=i[1],l=i[2],b=Object(u.a)(n,3),p=b[0],d=b[1],f=b[2];return Object(c.useEffect)((function(){o.transform.setPosition(s+p,j+d,l+f),o.update()}),[o,s,j,l,p,d,f]),Object(c.useEffect)((function(){o.velocity.set(p*r,d*r,f*r),o.update()}),[o,p,d,f,r]),Object(R.jsxs)("mesh",{ref:a,position:t,children:[Object(R.jsx)("sphereGeometry",{args:[.25,16,8]}),Object(R.jsx)("meshStandardMaterial",{color:"white"})]})}function He(e){var t=e.position,n=e.rotation,r=Object(z.a)(e,["position","rotation"]);t=t||[0,0,0],n=n||[0,0,0];var a=Object(c.useRef)(),o=Object(c.useRef)(),l=Object(N.c)().setDefaultCamera,b=Object(c.useRef)(),p=F(b,Object(c.useMemo)((function(){return{supports:[Object(P.g)(Object(P.i)({radius:.25}),Object(P.i)({position:[0,-1,0],radius:.25}))]}}),[])),d=Object(c.useState)([]),f=Object(u.a)(d,2),O=f[0],h=f[1],m=t,v=Object(u.a)(m,3),x=v[0],g=v[1],y=v[2];Object(c.useEffect)((function(){p.transform.setPosition(x,g,y),p.update()}),[p,x,g,y]);var C=n,k=Object(u.a)(C,3),S=k[0],M=k[1],w=k[2];Object(c.useEffect)((function(){o.current.rotation.y=M*Math.PI/180}),[S,M,w]);var V=function(e){var t=Object(c.useRef)([]);return Object(c.useEffect)((function(){var n=Object(P.a)(e).subscribe((function(e){t.current.push(e)}));return function(){return n.unsubscribe()}}),[e,t]),Object(c.useEffect)((function(){var n=Object(P.f)(e).subscribe((function(e){var n=t.current.indexOf(e);t.current.splice(n,1)}));return function(){return n.unsubscribe()}}),[e,t]),t}(p);Ce("mousemove",Object(c.useCallback)((function(e){var t=a.current.rotation.x;a.current.rotation.x=Math.min(Math.max(t-.005*e.movementY,-Math.PI/2),Math.PI/2),o.current.rotation.y-=.005*e.movementX}),[])),Object(c.useEffect)((function(){l(a.current)}),[l]);var E=ke(),D=new j.Vector3,B=new j.Vector3,L=new j.Vector3,I=new j.Vector3;return Ce("mousedown",(function(){h([].concat(Object(i.a)(O),[{key:Object(Qe.a)(),position:[p.position.x,p.position.y,p.position.z],direction:[I.x,I.y,I.z],speed:15}]).slice(-10))})),Object(N.b)((function(e,t){a.current.updateMatrixWorld(),I.setFromMatrixColumn(a.current.matrixWorld,2),I.negate(),o.current.matrixWorld.extractBasis(D,B,L),L.negate(),E.current.E&&(p.position.addScaledVector(B,4*t),p.transform.setPosition(p.position),p.update()),E.current.Q&&(p.position.addScaledVector(B,4*-t),p.transform.setPosition(p.position),p.update()),E.current.D&&(p.position.addScaledVector(D,4*t),p.transform.setPosition(p.position),p.update()),E.current.A&&(p.position.addScaledVector(D,4*-t),p.transform.setPosition(p.position),p.update()),E.current.W&&(p.position.addScaledVector(L,4*t),p.transform.setPosition(p.position),p.update()),E.current.S&&(p.position.addScaledVector(L,4*-t),p.transform.setPosition(p.position),p.update()),E.current[" "]&&V.current.length>0&&V.current.some((function(e){return e.amount.y/e.amount.length()<-.5}))&&p.velocity.set(0,3,0)})),Object(R.jsxs)(R.Fragment,{children:[Object(R.jsx)("group",Object(s.a)(Object(s.a)({ref:b},r),{},{children:Object(R.jsx)("group",{ref:o,children:Object(R.jsx)("perspectiveCamera",{ref:a})})})),O.map((function(e){var t=e.key,n=Object(z.a)(e,["key"]);return Object(R.jsx)(Ze,Object(s.a)({},n),t)}))]})}function $e(e){return{type:e.type,props:e.props,id:Object(Qe.a)()}}function _e(e){var t=e.data,n=t.objects.find((function(e){return"playerSpawn"===e.type})),c=n.props.position,r=n.props.rotation;return Object(R.jsx)(N.a,{onClick:function(e){return e.target.requestPointerLock()},children:Object(R.jsxs)(I,{children:[t.objects.map((function(e,t){var n=we[e.type].component;return Object(R.jsx)(n,Object(s.a)({},e.props),e.id)})),Object(R.jsx)(He,{position:c,rotation:r})]})})}var et=Object(V.a)((function(e){return{root:{display:"flex"},drawer:{width:320,flexShrink:0},drawerContent:{width:320,overflowX:"hidden"},content:{flexGrow:1,position:"absolute",left:320,top:0,right:0,bottom:0}}}));function tt(e){var t=e.data,n=e.selection,r=e.camera,a=e.onChange,o=e.onPlay,h=e.onStop,m=e.isPlaying,x=et(),y=Object(c.useState)(0),k=Object(u.a)(y,2),M=k[0],V=k[1];return Object(R.jsx)(O.a,{variant:"persistent",className:x.drawer,open:!0,children:Object(R.jsxs)("div",{className:x.drawerContent,children:[Object(R.jsxs)(b.a,{children:[Object(R.jsx)(p.a,{title:"New",children:Object(R.jsx)(l.a,{onClick:function(){a({objects:[]})},children:Object(R.jsx)(C.a,{})})}),Object(R.jsx)(p.a,{title:"Upload",children:Object(R.jsx)(l.a,{onClick:function(){new Promise((function(e,t){var n=document.createElement("input");n.setAttribute("type","file"),n.style.display="none",document.body.appendChild(n),n.addEventListener("change",(function(){this.files[0].text().then((function(t){return e(t)})).catch((function(e){return t(e)}))}),!1),n.click(),document.body.removeChild(n)})).then((function(e){return JSON.parse(e)})).then((function(e){return a(e)}))},children:Object(R.jsx)(w.a,{})})}),Object(R.jsx)(p.a,{title:"Download",onClick:function(){!function(e,t){var n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,".concat(encodeURIComponent(t))),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}("scene.json",JSON.stringify(t))},children:Object(R.jsx)(l.a,{children:Object(R.jsx)(S.a,{})})}),Object(R.jsx)(p.a,{title:m?"Stop":"Play",children:Object(R.jsx)(l.a,{onClick:m?h:o,children:m?Object(R.jsx)(g.a,{}):Object(R.jsx)(v.a,{})})})]}),Object(R.jsxs)(d.a,{onChange:function(e,t){return V(t)},value:M,variant:"fullWidth",children:[Object(R.jsx)(f.a,{label:"Palette"}),Object(R.jsx)(f.a,{label:"Properties"})]}),Object(R.jsx)(Ue,{value:M,index:0,children:Object(R.jsx)(We,{onSelect:function(e){var n=new j.Vector3,c=new j.Vector3,o=new j.Vector3,u=new j.Vector3;r.current.matrixWorld.extractBasis(n,c,o),r.current.getWorldPosition(u),o.negate();var l=we[e].distance||2,b=[u.x+o.x*l,u.y+o.y*l,u.z+o.z*l];a(Object(s.a)(Object(s.a)({},t),{},{objects:[].concat(Object(i.a)(t.objects),[$e({type:e,props:{kinematic:!0,position:b}})])}))}})}),Object(R.jsx)(Ue,{value:M,index:1,children:Object(R.jsx)(Ie,{data:t,selection:n,onChange:a})})]})})}function nt(e){var t=function(e,t){var n=Object(c.useState)(e),r=Object(u.a)(n,2),a=r[0],o=r[1],s=Object(c.useState)(e),j=Object(u.a)(s,2),l=j[0],b=j[1],p=Object(c.useState)([]),d=Object(u.a)(p,2),f=d[0],O=d[1],h=Object(c.useState)([]),m=Object(u.a)(h,2),v=m[0],x=m[1],g=Object(c.useCallback)((function(){f.length>0&&(x([l].concat(Object(i.a)(v))),b(f[0]),o(f[0]),O(f.slice(1)))}),[l,f,v,b,O,x]),y=Object(c.useCallback)((function(){v.length>0&&(O([l].concat(Object(i.a)(f))),b(v[0]),o(v[0]),x(v.slice(1)))}),[l,f,v,b,O,x]);return[a,Object(c.useCallback)((function(e){O([l].concat(Object(i.a)(f)).splice(-(t||1e3))),b(e),o(e),x([])}),[l,f,b,O,x,t]),g,y,o]}((function(){return{objects:[]}})),n=Object(u.a)(t,5),r=n[0],a=n[1],o=n[2],j=n[3],l=n[4],b=Object(c.useState)(new Set),p=Object(u.a)(b,2),d=p[0],f=p[1],O=Object(c.useState)([]),m=Object(u.a)(O,2),v=m[0],x=m[1],g=Object(c.useState)(!1),y=Object(u.a)(g,2),C=y[0],k=y[1],S=et(),M=Object(c.useRef)(),w=function(e){a(e)},V=r.objects.filter((function(e){return d.has(e.id)}));return Se(["Control","Z"],o),Se(["Control","Shift","Z"],j),Se(["Control","C"],(function(){x(V)})),Se(["Control","V"],(function(){var e=[].concat(Object(i.a)(r.objects),Object(i.a)(v.map($e)));a(Object(s.a)(Object(s.a)({},r),{},{objects:e}))})),Object(R.jsxs)("div",{className:S.root,children:[Object(R.jsx)(h.a,{}),Object(R.jsx)(tt,{data:r,selection:d,onChange:w,camera:M,isPlaying:C,onPlay:function(){k(!0)},onStop:function(){k(!1)}}),Object(R.jsx)("main",{className:S.content,children:C?Object(R.jsx)(_e,{data:r}):Object(R.jsx)(Ke,{cameraRef:M,data:r,selection:d,onSelectionChange:f,onChange:function(e){l(e)},onEdit:w})})]})}var ct=function(){return Object(R.jsx)("div",{className:"App",children:Object(R.jsx)(nt,{})})},rt=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,211)).then((function(t){var n=t.getCLS,c=t.getFID,r=t.getFCP,a=t.getLCP,o=t.getTTFB;n(e),c(e),r(e),a(e),o(e)}))};o.a.render(Object(R.jsx)(r.a.StrictMode,{children:Object(R.jsx)(ct,{})}),document.getElementById("root")),rt()}},[[146,1,2]]]);
//# sourceMappingURL=main.0bc70926.chunk.js.map