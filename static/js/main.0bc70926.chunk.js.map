{"version":3,"sources":["physics/index.js","game/components/Brush.js","game/components/RoundBrush.js","game/inspectors/Vector3Property.js","game/inspectors/position.js","game/inspectors/rotation.js","game/inspectors/scale.js","game/inspectors/BooleanProperty.js","game/inspectors/body.js","game/inspectors/ColorProperty.js","game/inspectors/color.js","game/inspectors/NumberProperty.js","game/inspectors/roundBrush.js","game/inspectors/mixins.js","game/inspectors/boxSize.js","game/components/box.js","game/inspectors/sphereSize.js","game/components/sphere.js","game/inspectors/cylinderSize.js","game/components/cylinder.js","game/components/pointLight.js","game/components/ambientLight.js","game/components/directionalLight.js","game/inspectors/Vector2Property.js","game/components/room.js","hooks/index.js","utils/index.js","game/components/playerSpawn.js","game/components/index.js","editor/ListSection.js","editor/Inspector.js","editor/Palette.js","editor/TabPanel.js","editor/TranslateArrows.js","editor/Camera.js","editor/SelectionRenderer.js","editor/ThreeView.js","game/Player.js","game/index.js","editor/index.js","App.js","reportWebVitals.js","index.js"],"names":["PhysicsSceneContext","createContext","scene","DisablePhysics","children","s","useMemo","Provider","value","PhysicsScene","useFrame","state","delta","update","Math","min","useBody","ref","options","b","body","useContext","useEffect","current","matrixAutoUpdate","subscription","changed","subscribe","matrix","copy","transform","add","unsubscribe","remove","randomizeDirection","d","set","random","lengthSq","normalize","useSupportGeometry","support","prev","useRef","dispose","ret","geometry","BufferGeometry","triangles","vertices","makeTriangle","ia","ib","ic","ac","clone","sub","bc","normal","cross","distance","dot","edgeCounts","Map","incEdge","a","key1","key2","has","get","v","Vector3","some","x","equals","push","length","t","negate","tmp","done","triangle","clear","i","splice","keys","key","e0","e1","floor","tri","vertexToTriangles","forEach","index","connected","t0","acos","max","PI","splitFaces","vertexData","Float32Array","flatMap","y","z","indexData","setAttribute","BufferAttribute","setIndex","computeVertexNormals","attributes","needsUpdate","computeBoundingSphere","makeSupportGeometry","Brush","position","rotation","scale","kinematic","color","userData","rest","supports","isKinematic","api","rx","ry","rz","sx","sy","sz","identity","multiply","Matrix4","makeRotationFromEuler","Euler","makeScale","setPosition","velocity","RoundBrush","roundRadius","flatTop","flatBottom","radius","roundSupport","circle","split","sphere","newSupport","sum","Vector3Property","selection","data","onChange","prop","label","defaultValue","origin","pos","objects","id","props","multiplyScalar","size","useState","setPos","ox","oy","oz","map","round","handleBlur","isNaN","newData","object","Grid","container","spacing","item","xs","TextField","toUpperCase","variant","e","newPos","setComponent","target","onBlur","displayName","component","useStyles","makeStyles","theme","evenlySpaced","margin","BooleanProperty","classes","undefined","setValue","Box","className","FormControlLabel","control","Checkbox","checked","ColorProperty","type","NumberProperty","fullWidth","brush","roundBrush","light","boxSize","inspectors","mixins","sizeX","sizeY","sizeZ","box","sphereSize","cylinderSize","height","r1","r2","hull","inEditor","args","Vector2Property","Vector2","inspector","thickness","frontDoorSize","leftDoorSize","rightDoorSize","backDoorSize","defaultDoorSize","doorOptions","doorSize","axisIndex","side","wallSize","topWallSize","position1","position2","position3","every","makeWallSupports","arrowGeometry","segments","CylinderGeometry","translate","merge","ConeGeometry","makeArrowGeometry","useArrowGeometry","useEventListener","callback","document","addEventListener","removeEventListener","useIsKeyDown","keyIsDown","useCallback","useKeyboardShortcut","Object","filter","includes","PlayerSpawnPreview","components","playerSpawn","cylinder","pointLight","ambientLight","directionalLight","room","ListSection","isExpanded","setIsExpanded","ListItem","button","onClick","ListItemIcon","ListItemText","title","Collapse","in","Inspector","selectedObjects","selectedInspectors","objectInspectors","reduce","noValidate","List","Component","PaletteItem","text","sqrt","Tooltip","Button","style","width","overflow","camera","invalidateFrameloop","Palette","onSelect","paletteItems","TabPanel","other","Fade","display","role","TranslateArrow","onBeginDrag","onEndDrag","onDrag","direction","isHovering","setIsHovering","dx","dy","dz","atan2","handlePointerOver","handlePointerLeave","totalAmount","isDragging","setIsDragging","handlePointerDown","stopPropagation","setPointerCapture","pointerId","handlePointerUp","releasePointerCapture","useThree","handlePointerMove","getWorldPosition","project","len","movementX","movementY","unproject","onPointerDown","onPointerUp","onPointerMove","onPointerOver","onPointerLeave","renderOrder","TranslateArrows","handleBeginDrag","handleEndDrag","amount","handleDrag","gl","arrowScene","Scene","worldPos","applyMatrix4","matrixWorldInverse","clearDepth","render","forwardRef","mode","rotationHelper","setDefaultCamera","right","up","forward","dt","updateMatrixWorld","totalSpeed","Shift","matrixWorld","extractBasis","E","addScaledVector","Q","D","A","W","S","useSelectionMaterial","useTheme","mat","MeshMatcapMaterial","blending","CustomBlending","blendSrc","OneFactor","blendDst","DstAlphaFactor","Color","transparent","TextureLoader","load","texture","matcap","makeSelectionMaterial","palette","secondary","main","SelectionRenderer","selectionMaterial","autoClear","originalVisibles","visible","overrideMaterial","ThreeView","onSelectionChange","onEdit","cameraRef","cameraMode","setCameraMode","handleObjectSelected","newSelection","Set","delete","handlePointerMissed","moveSelection","gameComponents","onMouseDown","buttons","onContextMenu","preventDefault","onPointerMissed","Camera","Snowball","speed","Player","bullets","setSnowballs","contacts","beginOverlap","event","endOverlap","indexOf","useContacts","cameraForward","uuid","slice","setFromMatrixColumn","Game","find","playerPosition","playerRotation","requestPointerLock","root","drawer","flexShrink","drawerContent","overflowX","content","flexGrow","left","top","bottom","EditorSidebar","onPlay","onStop","isPlaying","tab","setTab","Drawer","open","Toolbar","Promise","resolve","reject","element","createElement","appendChild","this","files","then","catch","error","click","removeChild","JSON","parse","filename","encodeURIComponent","download","stringify","Tabs","Tab","cameraPosition","Editor","initialState","setState","present","setPresent","past","setPast","future","setFuture","undo","redo","useUndoable","pushData","setData","setSelection","clipboardData","setClipboardData","setIsPlaying","handleEdit","CssBaseline","App","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.0bc70926.chunk.js","sourcesContent":["import {\n  useEffect,\n  useRef,\n  useContext,\n  createContext,\n  useMemo\n} from 'react'\n\nimport { useFrame } from 'react-three-fiber'\n\nimport { scene, body, beginOverlap, endOverlap, changed } from 'tcollide'\n\nimport {\n  Vector3,\n  BufferAttribute,\n  BufferGeometry\n} from 'three'\n\nconst PhysicsSceneContext = createContext(scene({}))\n\nexport function DisablePhysics ({ children }) {\n  const s = useMemo(() => scene({}), [])\n  return (\n    <PhysicsSceneContext.Provider value={s}>\n      {children}\n    </PhysicsSceneContext.Provider>\n  )\n}\n\nexport function PhysicsScene ({ children }) {\n  const s = useMemo(() => scene({}), [])\n  useFrame((state, delta) => {\n    s.update(Math.min(delta, 0.1))\n  })\n  return (\n    <PhysicsSceneContext.Provider value={s}>\n      {children}\n    </PhysicsSceneContext.Provider>\n  )\n}\n\nexport function useBody (ref, options) {\n  const b = useMemo(() => body(options), [options])\n  const s = useContext(PhysicsSceneContext)\n\n  useEffect(() => {\n    ref.current.matrixAutoUpdate = false\n    const subscription = changed(b).subscribe(() => {\n      if (ref.current) {\n        ref.current.matrix.copy(b.transform)\n      }\n    })\n    s.add(b)\n    return () => {\n      subscription.unsubscribe()\n      s.remove(b)\n    }\n  }, [b, s, ref])\n\n  return b\n}\n\nexport function useContacts (body) {\n  const contacts = useRef([])\n  useEffect(() => {\n    const subscription = beginOverlap(body).subscribe((event) => {\n      contacts.current.push(event)\n    })\n    return () => subscription.unsubscribe()\n  }, [body, contacts])\n  useEffect(() => {\n    const subscription = endOverlap(body).subscribe((event) => {\n      const index = contacts.current.indexOf(event)\n      contacts.current.splice(index, 1)\n    })\n    return () => subscription.unsubscribe()\n  }, [body, contacts])\n  return contacts\n}\n\nfunction randomizeDirection (d) {\n  do {\n    d.set(\n      Math.random() - Math.random(),\n      Math.random() - Math.random(),\n      Math.random() - Math.random()\n    )\n  } while (d.lengthSq() === 0)\n  d.normalize()\n}\n\nfunction makeSupportGeometry (support) {\n  const geometry = new BufferGeometry()\n\n  const tolerance = 0.01\n\n  const triangles = []\n  const vertices = []\n\n  const makeTriangle = (ia, ib, ic) => {\n    const ac = vertices[ic].clone().sub(vertices[ia])\n    const bc = vertices[ic].clone().sub(vertices[ib])\n    const normal = ac.cross(bc)\n\n    if (normal.lengthSq() === 0) {\n      return null\n    }\n    normal.normalize()\n\n    const distance = normal.dot(vertices[ic])\n\n    return {\n      ia,\n      ib,\n      ic,\n      normal,\n      distance\n    }\n  }\n\n  const edgeCounts = new Map()\n\n  const incEdge = (a, b) => {\n    /*\n     * Maximum safe integer is 2**53, so we shift by half of 53 to create a key.\n     * If a vertex index is greater than 2**26, we got other problems ;).\n     */\n    const key1 = a + (b * 0x4000000)\n    const key2 = b + (a * 0x4000000)\n    if (edgeCounts.has(key2)) {\n      edgeCounts.set(key2, edgeCounts.get(key2) + 1)\n    } else {\n      edgeCounts.set(key1, (edgeCounts.get(key1) || 0) + 1)\n    }\n  }\n\n  /* Create initial triangles. */\n  while (vertices.length < 3) {\n    const v = new Vector3()\n    do {\n      randomizeDirection(v)\n      support(v)\n    } while (vertices.some(x => x.equals(v)))\n    vertices.push(v)\n  }\n\n  {\n    const v = new Vector3()\n    const t = makeTriangle(0, 2, 1)\n    v.copy(t.normal).negate()\n    support(v)\n    if (vertices.some(x => x.equals(v))) {\n      t.normal.negate()\n      const tmp = vertices[0]\n      vertices[0] = vertices[2]\n      vertices[2] = tmp\n      v.copy(t.normal).negate()\n      support(v)\n    }\n\n    vertices.push(v)\n\n    triangles.push(t)\n    triangles.push(makeTriangle(0, 1, 3))\n    triangles.push(makeTriangle(1, 2, 3))\n    triangles.push(makeTriangle(2, 0, 3))\n  }\n\n  let done = false\n  while (!done) {\n    done = true\n    for (const triangle of triangles) {\n      edgeCounts.clear()\n\n      const a = new Vector3().copy(triangle.normal)\n      support(a)\n\n      /*\n       * Add the vertex if we can expand more, and the vertex has not already\n       * been added.\n       */\n      if (\n        !vertices.some(x => a.equals(x)) &&\n        a.dot(triangle.normal) - triangle.distance > tolerance\n      ) {\n        done = false\n        for (let i = 0; i < triangles.length; i++) {\n          const t = triangles[i]\n          if (a.clone().sub(vertices[t.ia]).dot(t.normal) >= 0) {\n            incEdge(t.ia, t.ib)\n            incEdge(t.ib, t.ic)\n            incEdge(t.ic, t.ia)\n            /* Remove the triangle. */\n            triangles.splice(i, 1)\n            i--\n          }\n        }\n\n        /* Add the new vertex. */\n        vertices.push(a)\n\n        /* Create new faces from non-shared edges. */\n        for (const key of edgeCounts.keys()) {\n          if (edgeCounts.get(key) === 1) {\n            const e0 = key & 0x3ffffff\n            const e1 = Math.floor(key / 0x4000000)\n            const tri = (\n              makeTriangle(\n                e0,\n                e1,\n                vertices.length - 1\n              )\n            )\n            triangles.push(tri)\n          }\n        }\n      }\n    }\n  }\n\n  function splitFaces () {\n    const vertexToTriangles = new Map()\n    triangles.forEach(t => {\n      if (!vertexToTriangles.has(t.ia)) {\n        vertexToTriangles.set(t.ia, [])\n      }\n      if (!vertexToTriangles.has(t.ib)) {\n        vertexToTriangles.set(t.ib, [])\n      }\n      if (!vertexToTriangles.has(t.ic)) {\n        vertexToTriangles.set(t.ic, [])\n      }\n      vertexToTriangles.get(t.ia).push(t)\n      vertexToTriangles.get(t.ib).push(t)\n      vertexToTriangles.get(t.ic).push(t)\n    })\n    vertexToTriangles.forEach((triangles, index) => {\n      const connected = [[triangles[0]]]\n      triangles.forEach(t0 => {\n        for (const set of connected) {\n          const dot = t0.normal.dot(set[0].normal)\n          const angle = Math.acos(\n            Math.max(-1, Math.min(1, dot))\n          )\n          if (angle < Math.PI / 4) {\n            set.push(t0)\n            return\n          }\n        }\n        connected.push([t0])\n      })\n      for (let i = 1; i < connected.length; i++) {\n        connected[i].forEach(t => {\n          if (t.ia === index) {\n            t.ia = vertices.length\n          }\n          if (t.ib === index) {\n            t.ib = vertices.length\n          }\n          if (t.ic === index) {\n            t.ic = vertices.length\n          }\n        })\n        vertices.push(vertices[index])\n      }\n    })\n  }\n\n  splitFaces()\n\n  const vertexData = new Float32Array(vertices.flatMap(x => [x.x, x.y, x.z]))\n  const indexData = triangles.flatMap(t => [t.ia, t.ib, t.ic])\n\n  geometry.setAttribute('position', new BufferAttribute(vertexData, 3))\n  geometry.setIndex(indexData)\n  geometry.computeVertexNormals()\n  geometry.attributes.normal.needsUpdate = true\n  geometry.computeBoundingSphere()\n\n  return geometry\n}\n\n/*\n * Basically the expanding polytope algorithm, but with some extra steps.\n */\nexport function useSupportGeometry (support) {\n  const prev = useRef(null)\n  return useMemo(() => {\n    if (prev.current) {\n      prev.current.dispose()\n    }\n    const ret = makeSupportGeometry(support)\n    prev.current = ret\n    return ret\n  }, [support])\n}\n","import {\n  useEffect,\n  useRef,\n  useMemo\n} from 'react'\n\nimport {\n  useBody,\n  useSupportGeometry\n} from '../../physics'\n\nimport {\n  Matrix4,\n  Euler\n} from 'three'\n\nexport default function Brush ({\n  support,\n  position,\n  rotation,\n  scale,\n  kinematic,\n  userData,\n  color,\n  ...rest\n}) {\n  /* Default values. */\n  position = position || [0.0, 0.0, 0.0]\n  rotation = rotation || [0.0, 0.0, 0.0]\n  scale = scale || [1.0, 1.0, 1.0]\n\n  const options = useMemo(() => ({\n    supports: [support],\n    isKinematic: kinematic\n  }), [support, kinematic])\n\n  const ref = useRef()\n  const api = useBody(ref, options)\n\n  const [rx, ry, rz] = rotation\n  const [sx, sy, sz] = scale\n  const [x, y, z] = position\n  useEffect(() => {\n    api.transform.identity()\n    api.transform.multiply(\n      new Matrix4().makeRotationFromEuler(new Euler(\n        rx * Math.PI / 180,\n        ry * Math.PI / 180,\n        rz * Math.PI / 180))\n    )\n    api.transform.multiply(\n      new Matrix4().makeScale(sx, sy, sz)\n    )\n    api.transform.setPosition(x, y, z)\n    api.velocity.set(0, 0, 0)\n    api.update()\n  }, [api, x, y, z, rx, ry, rz, sx, sy, sz])\n\n  const geometry = useSupportGeometry(support)\n\n  return (\n    <mesh\n      ref={ref}\n      geometry={geometry}\n      position={position}\n      rotation={rotation}\n      scale={scale}\n      {...rest}\n    >\n      <meshStandardMaterial\n        color={color}\n      />\n    </mesh>\n  )\n}\n","import {\n  useMemo\n} from 'react'\n\nimport {\n  sum,\n  split,\n  sphere,\n  circle\n} from 'tcollide'\n\nimport Brush from './Brush'\n\n/*\n * Like a brush, but with options for making it round.\n */\nexport default function RoundBrush ({\n  support,\n  roundRadius,\n  flatTop,\n  flatBottom,\n  ...rest\n}) {\n  const radius = roundRadius || 0.0\n\n  const roundSupport = useMemo(() => (\n    radius > 0\n      ? (\n          flatTop\n            ? (\n                flatBottom\n                  ? circle({ radius })\n                  : split(circle({ radius }), sphere({ radius }))\n              )\n            : (\n                flatBottom\n                  ? split(sphere({ radius }), circle({ radius }))\n                  : sphere({ radius })\n              )\n        )\n      : null\n  ), [radius, flatTop, flatBottom])\n\n  const newSupport = useMemo(() => (\n    radius > 0\n      ? sum(support, roundSupport)\n      : support\n  ), [support, roundSupport, radius])\n\n  return <Brush support={newSupport} {...rest} />\n}\n","import {\n  useMemo,\n  useState,\n  useEffect\n} from 'react'\n\n/* Material UI components. */\nimport Grid from '@material-ui/core/Grid'\nimport TextField from '@material-ui/core/TextField'\n\nimport {\n  Vector3\n} from 'three'\n\nexport default function Vector3Property ({\n  selection,\n  data,\n  onChange,\n  prop,\n  label,\n  defaultValue\n}) {\n  const origin = useMemo(() => {\n    const origin = new Vector3()\n    const pos = new Vector3()\n    data.objects.forEach(x => {\n      if (selection.has(x.id)) {\n        if (x.props[prop]) {\n          pos.set(...x.props[prop])\n        } else {\n          pos.set(...defaultValue)\n        }\n        origin.add(pos)\n      }\n    })\n    origin.multiplyScalar(1 / selection.size)\n    return [origin.x, origin.y, origin.z]\n  }, [selection, data, prop, defaultValue])\n\n  const [pos, setPos] = useState(defaultValue)\n  const [ox, oy, oz] = origin\n  useEffect(() => {\n    setPos([ox, oy, oz].map(v => Math.round(v * 1000) / 1000))\n  }, [ox, oy, oz])\n\n  const setComponent = (i, v) => {\n    const newPos = [...pos]\n    newPos[i] = v\n    setPos(newPos)\n  }\n\n  const handleBlur = () => {\n    if (pos.some(x => isNaN(x))) {\n      setPos(origin)\n      return\n    }\n    const newData = {\n      ...data,\n      objects: data.objects.map(object => {\n        if (selection.has(object.id)) {\n          const position = [...(object.props[prop] || defaultValue)]\n          for (let i = 0; i < position.length; i++) {\n            position[i] += pos[i] - origin[i]\n          }\n          return {\n            ...object,\n            props: {\n              ...object.props,\n              [prop]: position\n            }\n          }\n        } else {\n          return object\n        }\n      })\n    }\n    onChange(newData)\n  }\n\n  return (\n    <Grid container spacing={1}>\n      {['x', 'y', 'z'].map((x, i) => (\n        <Grid item key={x} xs={4}>\n          <TextField\n            label={(label ? label + ' ' : '') + x.toUpperCase()}\n            variant='filled'\n            value={pos[i]}\n            onChange={(e) => setComponent(i, e.target.value)}\n            onBlur={handleBlur}\n          />\n        </Grid>\n      ))}\n    </Grid>\n  )\n}\n","import Vector3Property from './Vector3Property'\n\nfunction Position ({\n  selection,\n  data,\n  onChange\n}) {\n  return (\n    <Vector3Property\n      prop='position'\n      selection={selection}\n      data={data}\n      onChange={onChange}\n      defaultValue={[0, 0, 0]}\n    />\n  )\n}\n\nconst position = {\n  key: 'position',\n  displayName: 'Position',\n  component: Position\n}\n\nexport default position\n","import Vector3Property from './Vector3Property'\n\nfunction Rotation ({\n  selection,\n  data,\n  onChange\n}) {\n  return (\n    <Vector3Property\n      prop='rotation'\n      selection={selection}\n      data={data}\n      onChange={onChange}\n      defaultValue={[0, 0, 0]}\n    />\n  )\n}\n\nconst rotation = {\n  key: 'rotation',\n  displayName: 'Rotation',\n  component: Rotation\n}\n\nexport default rotation\n","import Vector3Property from './Vector3Property'\n\nfunction Scale ({\n  selection,\n  data,\n  onChange\n}) {\n  return (\n    <Vector3Property\n      prop='scale'\n      selection={selection}\n      data={data}\n      onChange={onChange}\n      defaultValue={[1, 1, 1]}\n    />\n  )\n}\n\nconst scale = {\n  key: 'scale',\n  displayName: 'Scale',\n  component: Scale\n}\n\nexport default scale\n","import {\n  useMemo,\n  useState,\n  useEffect\n} from 'react'\n\n/* Material UI components. */\nimport Box from '@material-ui/core/Box'\nimport Checkbox from '@material-ui/core/Checkbox'\nimport FormControlLabel from '@material-ui/core/FormControlLabel'\n\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst useStyles = makeStyles((theme) => ({\n  evenlySpaced: {\n    '& > *': {\n      margin: theme.spacing(1)\n    }\n  }\n}))\n\nexport default function BooleanProperty ({\n  selection,\n  data,\n  onChange,\n  prop,\n  defaultValue,\n  label\n}) {\n  const classes = useStyles()\n\n  const origin = useMemo(() => {\n    let origin = defaultValue\n    data.objects.forEach(x => {\n      if (selection.has(x.id)) {\n        if (x.props[prop] !== undefined) {\n          origin = x.props[prop]\n        }\n      }\n    })\n    return origin\n  }, [selection, data, prop, defaultValue])\n\n  const [value, setValue] = useState(defaultValue)\n  useEffect(() => {\n    setValue(origin)\n  }, [origin])\n\n  const handleChange = (e) => {\n    const value = e.target.checked\n    setValue(value)\n\n    const newData = {\n      ...data,\n      objects: data.objects.map(object => {\n        if (selection.has(object.id)) {\n          return {\n            ...object,\n            props: {\n              ...object.props,\n              [prop]: value\n            }\n          }\n        } else {\n          return object\n        }\n      })\n    }\n    onChange(newData)\n  }\n\n  return (\n    <Box className={classes.evenlySpaced}>\n      <FormControlLabel\n        control={\n          <Checkbox\n            variant='filled'\n            checked={value}\n            onChange={handleChange}\n          />\n        }\n        label={label}\n      />\n    </Box>\n  )\n}\n","import BooleanProperty from './BooleanProperty'\n\nfunction Body ({\n  selection,\n  data,\n  onChange\n}) {\n  return (\n    <BooleanProperty\n      prop='kinematic'\n      selection={selection}\n      data={data}\n      onChange={onChange}\n      defaultValue\n      label='Kinematic'\n    />\n  )\n}\n\nconst body = {\n  key: 'body',\n  displayName: 'Body',\n  component: Body\n}\n\nexport default body\n","\nimport {\n  useMemo,\n  useState,\n  useEffect\n} from 'react'\n\nexport default function ColorProperty ({\n  selection,\n  data,\n  onChange,\n  prop,\n  defaultValue\n}) {\n  const origin = useMemo(() => {\n    let origin = defaultValue\n    data.objects.forEach(x => {\n      if (selection.has(x.id)) {\n        if (x.props[prop] !== undefined) {\n          origin = x.props[prop]\n        }\n      }\n    })\n    return origin\n  }, [selection, data, prop, defaultValue])\n\n  const [value, setValue] = useState(defaultValue)\n  useEffect(() => {\n    setValue(origin)\n  }, [origin])\n\n  const handleChange = (e) => {\n    const value = e.target.value\n    setValue(value)\n\n    const newData = {\n      ...data,\n      objects: data.objects.map(object => {\n        if (selection.has(object.id)) {\n          return {\n            ...object,\n            props: {\n              ...object.props,\n              [prop]: value\n            }\n          }\n        } else {\n          return object\n        }\n      })\n    }\n    onChange(newData)\n  }\n\n  return (\n    <input type='color' value={value} onChange={handleChange} />\n  )\n}\n","import ColorProperty from './ColorProperty'\n\nfunction Color ({\n  selection,\n  data,\n  onChange\n}) {\n  return (\n    <ColorProperty\n      prop='color'\n      selection={selection}\n      data={data}\n      onChange={onChange}\n      defaultValue='#ffffff'\n    />\n  )\n}\n\nconst color = {\n  key: 'color',\n  displayName: 'Color',\n  component: Color\n}\n\nexport default color\n","import {\n  useMemo,\n  useState,\n  useEffect\n} from 'react'\n\n/* Material UI components. */\nimport Box from '@material-ui/core/Box'\nimport TextField from '@material-ui/core/TextField'\n\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst useStyles = makeStyles((theme) => ({\n  evenlySpaced: {\n    '& > *': {\n      margin: theme.spacing(1)\n    }\n  }\n}))\n\nexport default function NumberProperty ({\n  selection,\n  data,\n  onChange,\n  prop,\n  defaultValue,\n  label\n}) {\n  const classes = useStyles()\n\n  const origin = useMemo(() => {\n    let origin = 0\n    data.objects.forEach(x => {\n      if (selection.has(x.id)) {\n        if (x.props[prop] !== undefined) {\n          origin += x.props[prop]\n        } else {\n          origin += defaultValue\n        }\n      }\n    })\n    origin *= 1 / selection.size\n    return origin\n  }, [selection, data, prop, defaultValue])\n\n  const [pos, setPos] = useState(defaultValue)\n  useEffect(() => {\n    setPos(Math.round(origin * 1000) / 1000)\n  }, [origin])\n\n  const handleBlur = () => {\n    if (isNaN(pos)) {\n      setPos(origin)\n      return\n    }\n    const newData = {\n      ...data,\n      objects: data.objects.map(object => {\n        if (selection.has(object.id)) {\n          let position = (\n            object.props[prop] !== undefined\n              ? object.props[prop]\n              : defaultValue\n          )\n          position += pos - origin\n          return {\n            ...object,\n            props: {\n              ...object.props,\n              [prop]: position\n            }\n          }\n        } else {\n          return object\n        }\n      })\n    }\n    onChange(newData)\n  }\n\n  return (\n    <Box className={classes.evenlySpaced}>\n      <TextField\n        fullWidth\n        label={label}\n        variant='filled'\n        value={pos}\n        onChange={(e) => setPos(e.target.value)}\n        onBlur={handleBlur}\n      />\n    </Box>\n  )\n}\n","import Box from '@material-ui/core/Box'\n\nimport NumberProperty from './NumberProperty'\nimport BooleanProperty from './BooleanProperty'\n\nfunction RoundBrush ({\n  selection,\n  data,\n  onChange\n}) {\n  return (\n    <Box>\n      <NumberProperty\n        prop='roundRadius'\n        selection={selection}\n        data={data}\n        onChange={onChange}\n        defaultValue={0.0}\n        label='Round radius'\n      />\n      <BooleanProperty\n        prop='flatTop'\n        selection={selection}\n        data={data}\n        onChange={onChange}\n        defaultValue={false}\n        label='Flat top'\n      />\n      <BooleanProperty\n        prop='flatBottom'\n        selection={selection}\n        data={data}\n        onChange={onChange}\n        defaultValue={false}\n        label='Flat bottom'\n      />\n    </Box>\n  )\n}\n\nconst roundBrush = {\n  key: 'roundBrush',\n  displayName: 'Round brush',\n  component: RoundBrush\n}\n\nexport default roundBrush\n","import position from './position'\nimport rotation from './rotation'\nimport scale from './scale'\nimport body from './body'\nimport color from './color'\nimport roundBrushInspector from './roundBrush'\n\nconst transform = [position, rotation, scale]\nconst brush = [position, rotation, scale, body, color]\nconst roundBrush = [...brush, roundBrushInspector]\nconst light = [position, color]\n\nexport { transform, brush, roundBrush, light }\n","import Vector3Property from './Vector3Property'\n\nfunction BoxSize ({\n  selection,\n  data,\n  onChange\n}) {\n  return (\n    <Vector3Property\n      prop='size'\n      selection={selection}\n      data={data}\n      onChange={onChange}\n      defaultValue={[1, 1, 1]}\n    />\n  )\n}\n\nconst boxSize = {\n  key: 'boxSize',\n  displayName: 'Size',\n  component: BoxSize\n}\n\nexport default boxSize\n","import {\n  useMemo\n} from 'react'\n\nimport {\n  box\n} from 'tcollide'\n\nimport RoundBrush from './RoundBrush'\n\nimport * as mixins from '../inspectors/mixins'\nimport boxSize from '../inspectors/boxSize'\n\nfunction Box ({ size, ...rest }) {\n  size = size || [1.0, 1.0, 1.0]\n  const [sizeX, sizeY, sizeZ] = size\n  const support = useMemo(() => (\n    box({ size: [sizeX, sizeY, sizeZ] })\n  ), [sizeX, sizeY, sizeZ])\n  return (\n    <RoundBrush support={support} {...rest} />\n  )\n}\n\nconst component = {\n  key: 'box',\n  displayName: 'Box',\n  inspectors: [...mixins.roundBrush, boxSize],\n  component: Box\n}\n\nexport default component\n","import NumberProperty from './NumberProperty'\n\nfunction SphereSize ({\n  selection,\n  data,\n  onChange\n}) {\n  return (\n    <NumberProperty\n      prop='radius'\n      selection={selection}\n      data={data}\n      onChange={onChange}\n      defaultValue={0.5}\n      label='Radius'\n    />\n  )\n}\n\nconst sphereSize = {\n  key: 'sphereSize',\n  displayName: 'Size',\n  component: SphereSize\n}\n\nexport default sphereSize\n","import {\n  useMemo\n} from 'react'\n\nimport {\n  sphere\n} from 'tcollide'\n\nimport Brush from './Brush'\n\nimport * as mixins from '../inspectors/mixins'\nimport sphereSize from '../inspectors/sphereSize'\n\nfunction Sphere ({ radius, ...rest }) {\n  radius = radius || 0.5\n  const support = useMemo(() => (\n    sphere({ radius })\n  ), [radius])\n  return (\n    <Brush support={support} {...rest} />\n  )\n}\n\nconst component = {\n  key: 'sphere',\n  displayName: 'Sphere',\n  inspectors: [...mixins.brush, sphereSize],\n  component: Sphere\n}\n\nexport default component\n","import Box from '@material-ui/core/Box'\nimport NumberProperty from './NumberProperty'\n\nfunction CylinderSize ({\n  selection,\n  data,\n  onChange\n}) {\n  return (\n    <Box>\n      <NumberProperty\n        prop='r1'\n        selection={selection}\n        data={data}\n        onChange={onChange}\n        defaultValue={0.5}\n        label='Radius 1'\n      />\n      <NumberProperty\n        prop='r2'\n        selection={selection}\n        data={data}\n        onChange={onChange}\n        defaultValue={0.5}\n        label='Radius 2'\n      />\n      <NumberProperty\n        prop='height'\n        selection={selection}\n        data={data}\n        onChange={onChange}\n        defaultValue={1.0}\n        label='Height'\n      />\n    </Box>\n  )\n}\n\nconst cylinderSize = {\n  key: 'cylinderSize',\n  displayName: 'Size',\n  component: CylinderSize\n}\n\nexport default cylinderSize\n","import {\n  useMemo\n} from 'react'\n\nimport {\n  hull,\n  circle\n} from 'tcollide'\n\nimport RoundBrush from './RoundBrush'\n\nimport * as mixins from '../inspectors/mixins'\nimport cylinderSize from '../inspectors/cylinderSize'\n\nfunction Cylinder ({ height, r1, r2, ...rest }) {\n  /* Default values. */\n  r1 = r1 || 0.5\n  r2 = r2 || 0.5\n  height = height || 1.0\n\n  const support = useMemo(() => (\n    hull(\n      circle({\n        position: [0, -height / 2, 0],\n        radius: r1\n      }),\n      circle({\n        position: [0, height / 2, 0],\n        radius: r2\n      })\n    )\n  ), [height, r1, r2])\n  return (\n    <RoundBrush support={support} {...rest} />\n  )\n}\n\nconst component = {\n  key: 'cylinder',\n  displayName: 'Cylinder',\n  inspectors: [...mixins.roundBrush, cylinderSize],\n  component: Cylinder\n}\n\nexport default component\n","import * as mixins from '../inspectors/mixins'\n\nconst component = {\n  key: 'pointLight',\n  displayName: 'Point Light',\n  inspectors: [...mixins.light],\n  component ({ position, color, inEditor, ...rest }) {\n    color = color || '#ffffff'\n    position = position || [0, 0, 0]\n    return (\n      <group position={position}>\n        {inEditor && (\n          <mesh>\n            <meshBasicMaterial color={color} />\n            <sphereGeometry args={[0.25, 16, 8]} />\n          </mesh>\n        )}\n        <pointLight color={color} {...rest} />\n      </group>\n    )\n  }\n}\n\nexport default component\n","import * as mixins from '../inspectors/mixins'\n\nconst component = {\n  key: 'ambientLight',\n  displayName: 'Ambient Light',\n  inspectors: [...mixins.light],\n  component ({ position, color, inEditor, ...rest }) {\n    color = color || '#ffffff'\n    position = position || [0, 0, 0]\n    return (\n      <group position={position}>\n        {inEditor && (\n          <mesh>\n            <meshBasicMaterial color={color} />\n            <sphereGeometry args={[0.25, 16, 8]} />\n          </mesh>\n        )}\n        <ambientLight color={color} {...rest} />\n      </group>\n    )\n  }\n}\n\nexport default component\n","import * as mixins from '../inspectors/mixins'\n\nconst component = {\n  key: 'directionalLight',\n  displayName: 'Directional Light',\n  inspectors: [...mixins.light],\n  component ({ position, color, inEditor, ...rest }) {\n    color = color || '#ffffff'\n    position = position || [0, 0, 0]\n    return (\n      <group position={position}>\n        {inEditor && (\n          <mesh>\n            <meshBasicMaterial color={color} />\n            <sphereGeometry args={[0.25, 16, 8]} />\n          </mesh>\n        )}\n        <directionalLight color={color} {...rest} />\n      </group>\n    )\n  }\n}\n\nexport default component\n","import {\n  useMemo,\n  useState,\n  useEffect\n} from 'react'\n\n/* Material UI components. */\nimport Grid from '@material-ui/core/Grid'\nimport TextField from '@material-ui/core/TextField'\n\nimport {\n  Vector2\n} from 'three'\n\nexport default function Vector2Property ({\n  selection,\n  data,\n  onChange,\n  prop,\n  label,\n  defaultValue\n}) {\n  const origin = useMemo(() => {\n    const origin = new Vector2()\n    const pos = new Vector2()\n    data.objects.forEach(x => {\n      if (selection.has(x.id)) {\n        if (x.props[prop]) {\n          pos.set(...x.props[prop])\n        } else {\n          pos.set(...defaultValue)\n        }\n        origin.add(pos)\n      }\n    })\n    origin.multiplyScalar(1 / selection.size)\n    return [origin.x, origin.y]\n  }, [selection, data, prop, defaultValue])\n\n  const [pos, setPos] = useState(defaultValue)\n  const [ox, oy] = origin\n  useEffect(() => {\n    setPos([ox, oy].map(v => Math.round(v * 1000) / 1000))\n  }, [ox, oy])\n\n  const setComponent = (i, v) => {\n    const newPos = [...pos]\n    newPos[i] = v\n    setPos(newPos)\n  }\n\n  const handleBlur = () => {\n    if (pos.some(x => isNaN(x))) {\n      setPos(origin)\n      return\n    }\n    const newData = {\n      ...data,\n      objects: data.objects.map(object => {\n        if (selection.has(object.id)) {\n          const position = [...(object.props[prop] || defaultValue)]\n          for (let i = 0; i < position.length; i++) {\n            position[i] += pos[i] - origin[i]\n          }\n          return {\n            ...object,\n            props: {\n              ...object.props,\n              [prop]: position\n            }\n          }\n        } else {\n          return object\n        }\n      })\n    }\n    onChange(newData)\n  }\n\n  return (\n    <Grid container spacing={1}>\n      {['x', 'y'].map((x, i) => (\n        <Grid item key={x} xs={6}>\n          <TextField\n            label={(label ? label + ' ' : '') + x.toUpperCase()}\n            variant='filled'\n            value={pos[i]}\n            onChange={(e) => setComponent(i, e.target.value)}\n            onBlur={handleBlur}\n          />\n        </Grid>\n      ))}\n    </Grid>\n  )\n}\n","import {\n  useMemo\n} from 'react'\n\nimport {\n  box\n} from 'tcollide'\n\nimport Box from '@material-ui/core/Box'\n\nimport Brush from './Brush'\n\nimport * as mixins from '../inspectors/mixins'\nimport boxSize from '../inspectors/boxSize'\nimport Vector2Property from '../inspectors/Vector2Property'\n\nfunction makeWallSupports ({\n  thickness,\n  axisIndex,\n  side,\n  size,\n  doorSize\n}) {\n  if (doorSize.some(x => x <= 0) || axisIndex === 1) {\n    const sizeX = (\n      axisIndex === 0\n        ? thickness\n        : (size[0] - 2 * thickness)\n    )\n    const sizeY = (\n      axisIndex === 1\n        ? thickness\n        : (size[1])\n    )\n    const sizeZ = (\n      axisIndex === 2\n        ? thickness\n        : (\n            axisIndex === 0\n              ? size[2]\n              : size[2] - 2 * thickness\n          )\n    )\n    const position = [0, 0, 0]\n    position[axisIndex] = (size[axisIndex] - thickness) * side / 2\n    return [\n      box({\n        position,\n        size: [sizeX, sizeY, sizeZ]\n      })\n    ]\n  } else {\n    const sizeX = (\n      axisIndex === 0\n        ? thickness\n        : (size[0] - 2 * thickness)\n    )\n    const sizeY = (\n      axisIndex === 1\n        ? thickness\n        : (size[1])\n    )\n    const sizeZ = (\n      axisIndex === 2\n        ? thickness\n        : (\n            axisIndex === 0\n              ? size[2]\n              : size[2] - 2 * thickness\n          )\n    )\n    const wallSize = [sizeX, sizeY, sizeZ]\n    const topWallSize = [...wallSize]\n    const position = [0, 0, 0]\n    position[axisIndex] = (size[axisIndex] - thickness) * side / 2\n\n    /* Side wall positions. */\n    const position1 = [...position]\n    const position2 = [...position]\n    position1[2 - axisIndex] += (wallSize[2 - axisIndex] + doorSize[0]) / 4\n    position2[2 - axisIndex] -= (wallSize[2 - axisIndex] + doorSize[0]) / 4\n    wallSize[2 - axisIndex] = (wallSize[2 - axisIndex] - doorSize[0]) / 2\n\n    /* Top wall position. */\n    const position3 = [...position]\n    position3[1] += doorSize[1] / 2\n    topWallSize[1] -= doorSize[1]\n    topWallSize[2 - axisIndex] = doorSize[0]\n\n    if (wallSize.every(x => x > 0) && topWallSize.every(x => x > 0)) {\n      return [\n        box({\n          position: position1,\n          size: wallSize\n        }),\n        box({\n          position: position2,\n          size: wallSize\n        }),\n        box({\n          position: position3,\n          size: topWallSize\n        })\n      ]\n    } else {\n      return []\n    }\n  }\n}\n\nfunction Room ({\n  size,\n  thickness,\n  frontDoorSize,\n  leftDoorSize,\n  rightDoorSize,\n  backDoorSize,\n  ...rest\n}) {\n  thickness = thickness || 0.1\n  size = size || [1.0, 1.0, 1.0]\n  const [sizeX, sizeY, sizeZ] = size\n  const defaultDoorSize = useMemo(() => [0.5, 0.5], [])\n\n  const doorOptions = useMemo(() => (\n    [\n      [backDoorSize || defaultDoorSize, 2, -1],\n      [frontDoorSize || defaultDoorSize, 2, 1],\n      [[0, 0], 1, -1],\n      [[0, 0], 1, 1],\n      [leftDoorSize || defaultDoorSize, 0, -1],\n      [rightDoorSize || defaultDoorSize, 0, 1]\n    ]\n  ), [\n    frontDoorSize,\n    leftDoorSize,\n    rightDoorSize,\n    backDoorSize,\n    defaultDoorSize\n  ])\n\n  const supports = useMemo(() => (\n    doorOptions.flatMap(([doorSize, axisIndex, side]) =>\n      makeWallSupports({\n        thickness,\n        axisIndex,\n        size: [sizeX, sizeY, sizeZ],\n        side,\n        doorSize\n      })\n    )\n  ), [sizeX, sizeY, sizeZ, thickness, doorOptions])\n  return (\n    <>\n      {supports.map((support, i) => (\n        <Brush key={i} support={support} {...rest} />\n      ))}\n    </>\n  )\n}\n\nfunction Inspector ({\n  selection,\n  data,\n  onChange\n}) {\n  const defaultValue = [0.5, 0.5]\n  return (\n    <Box>\n      <Vector2Property\n        label='Left door size'\n        prop='leftDoorSize'\n        selection={selection}\n        data={data}\n        onChange={onChange}\n        defaultValue={defaultValue}\n      />\n      <Vector2Property\n        label='Right door size'\n        prop='rightDoorSize'\n        selection={selection}\n        data={data}\n        onChange={onChange}\n        defaultValue={defaultValue}\n      />\n      <Vector2Property\n        label='Front door size'\n        prop='frontDoorSize'\n        selection={selection}\n        data={data}\n        onChange={onChange}\n        defaultValue={defaultValue}\n      />\n      <Vector2Property\n        label='Back door size'\n        prop='backDoorSize'\n        selection={selection}\n        data={data}\n        onChange={onChange}\n        defaultValue={defaultValue}\n      />\n    </Box>\n  )\n}\n\nconst inspector = {\n  key: 'room',\n  displayName: 'Room',\n  component: Inspector\n}\n\nconst component = {\n  key: 'room',\n  displayName: 'Room',\n  inspectors: [...mixins.brush, boxSize, inspector],\n  component: Room\n}\n\nexport default component\n","import { useState, useEffect, useRef, useCallback } from 'react'\n\n/* Utils. */\nimport { makeArrowGeometry } from '../utils'\n\nconst arrowGeometry = makeArrowGeometry()\nexport function useArrowGeometry () {\n  return arrowGeometry\n}\n\nexport function useEventListener (type, callback) {\n  useEffect(() => {\n    document.addEventListener(type, callback)\n    return () => {\n      document.removeEventListener(type, callback)\n    }\n  }, [type, callback])\n}\n\nexport function useIsKeyDown () {\n  /* Handle keyboard. */\n  const keyIsDown = useRef({})\n\n  const handleKeyDown = useCallback((e) => {\n    keyIsDown.current[\n      e.key.length === 1\n        ? e.key.toUpperCase()\n        : e.key\n    ] = true\n  }, [])\n  useEventListener('keydown', handleKeyDown)\n\n  const handleKeyUp = useCallback((e) => {\n    keyIsDown.current[\n      e.key.length === 1\n        ? e.key.toUpperCase()\n        : e.key\n    ] = false\n  }, [])\n\n  useEventListener('keyup', handleKeyUp)\n  return keyIsDown\n}\n\nexport function useKeyboardShortcut (keys, callback) {\n  /* Handle keyboard. */\n  const keyIsDown = useRef({})\n\n  const handleKeyDown = useCallback((e) => {\n    keyIsDown.current[\n      e.key.length === 1\n        ? e.key.toUpperCase()\n        : e.key\n    ] = true\n\n    /* Call the callback if all the keys are down. */\n    if (e.target === document.body) {\n      if (\n        keys.every(x => keyIsDown.current[x]) &&\n        Object.keys(keyIsDown.current)\n          .filter(x => keyIsDown.current[x])\n          .every(x => keys.includes(x))\n      ) {\n        callback()\n      }\n    }\n  }, [keys, callback])\n  useEventListener('keydown', handleKeyDown)\n\n  const handleKeyUp = useCallback((e) => {\n    keyIsDown.current[\n      e.key.length === 1\n        ? e.key.toUpperCase()\n        : e.key\n    ] = false\n  }, [])\n  useEventListener('keyup', handleKeyUp)\n}\n\n/**\n * Creates a callback function that calls the given callback by reference. This\n * is useful when multiple components need to use the same callback, and you\n * don't want to trigger a rerender of all the components when the callback\n * changes. Returns the memoized callback.\n */\nexport const useRefCallback = (callback) => {\n  const ref = useRef(null)\n  const memoizedCallback = useCallback(\n    (...args) => ref.current(...args),\n    []\n  )\n\n  useEffect(() => {\n    ref.current = callback\n  }, [callback])\n\n  return memoizedCallback\n}\n\n/**\n * Creates undoable state. Returns an array of [present, pushState, undo, redo,\n * setState]. pushState pushes the given state onto the stack. setState allows\n * you to set the state without modifying the history.\n */\nexport const useUndoable = (initialState, max) => {\n  const [state, setState] = useState(initialState)\n  const [present, setPresent] = useState(initialState)\n  const [past, setPast] = useState([])\n  const [future, setFuture] = useState([])\n\n  const undo = useCallback(() => {\n    const canUndo = past.length > 0\n    if (canUndo) {\n      setFuture([present, ...future])\n      setPresent(past[0])\n      setState(past[0])\n      setPast(past.slice(1))\n    }\n  }, [present, past, future, setPresent, setPast, setFuture])\n\n  const redo = useCallback(() => {\n    const canRedo = future.length > 0\n    if (canRedo) {\n      setPast([present, ...past])\n      setPresent(future[0])\n      setState(future[0])\n      setFuture(future.slice(1))\n    }\n  }, [present, past, future, setPresent, setPast, setFuture])\n\n  const pushState = useCallback((state) => {\n    setPast([present, ...past].splice(-(max || 1000)))\n    setPresent(state)\n    setState(state)\n    setFuture([])\n  }, [present, past, setPresent, setPast, setFuture, max])\n\n  return [state, pushState, undo, redo, setState]\n}\n","import { ConeGeometry, CylinderGeometry } from 'three'\n\nexport function makeArrowGeometry (\n  segments = 8,\n  r1 = 0.05,\n  r2 = 0.15\n) {\n  const geometry = new CylinderGeometry(r1, r1, 1.0, segments, 1)\n    .translate(0, 0.5, 0)\n  geometry.merge(new ConeGeometry(r2, 0.5, segments, 1).translate(0, 1.25, 0))\n  return geometry\n}\n\n/*\n * Prompts the user to save the given text as the given filename.\n */\nexport function download (filename, text) {\n  const element = document.createElement('a')\n  element.setAttribute(\n    'href',\n    `data:text/plain;charset=utf-8,${encodeURIComponent(text)}`)\n  element.setAttribute('download', filename)\n\n  element.style.display = 'none'\n  document.body.appendChild(element)\n\n  element.click()\n\n  document.body.removeChild(element)\n}\n\n/*\n * Prompts the user to upload a file. Returns a promise that resolves to the\n * text loaded from the file.\n */\nexport function upload () {\n  return new Promise((resolve, reject) => {\n    const element = document.createElement('input')\n    element.setAttribute('type', 'file')\n\n    element.style.display = 'none'\n    document.body.appendChild(element)\n\n    element.addEventListener(\n      'change',\n      function () {\n        this.files[0].text()\n          .then((data) => resolve(data))\n          .catch((error) => reject(error))\n      },\n      false)\n\n    element.click()\n\n    document.body.removeChild(element)\n  })\n}\n","import { useMemo } from 'react'\nimport { hull, sphere } from 'tcollide'\nimport position from '../inspectors/position'\nimport rotation from '../inspectors/rotation'\nimport { useSupportGeometry } from '../../physics'\n\n/* Utils. */\nimport { useArrowGeometry } from '../../hooks'\n\nfunction PlayerSpawnPreview ({ color, position, rotation }) {\n  const arrowGeometry = useArrowGeometry()\n  const support = useMemo(() => (\n    hull(\n      sphere({ radius: 0.25 }),\n      sphere({ position: [0, -1, 0], radius: 0.25 })\n    )\n  ), [])\n  const geometry = useSupportGeometry(support)\n  return (\n    <group position={position} rotation={rotation.map(x => x * Math.PI / 180)}>\n      <mesh geometry={geometry}>\n        <meshBasicMaterial color={color} />\n      </mesh>\n      <mesh geometry={arrowGeometry} rotation={[-Math.PI / 2, 0, 0]}>\n        <meshBasicMaterial color={color} />\n      </mesh>\n    </group>\n  )\n}\n\nfunction PlayerSpawn ({ position, rotation, inEditor, ...rest }) {\n  if (inEditor) {\n    position = position || [0, 0, 0]\n    rotation = rotation || [0, 0, 0]\n    return (\n      <PlayerSpawnPreview\n        position={position}\n        rotation={rotation}\n        color='#0000ff'\n      />\n    )\n  } else {\n    return null\n  }\n}\nconst component = {\n  key: 'playerSpawn',\n  displayName: 'Player Spawnpoint',\n  inspectors: [position, rotation],\n  component: PlayerSpawn\n}\n\nexport default component\n","import box from './box'\nimport sphere from './sphere'\nimport cylinder from './cylinder'\nimport pointLight from './pointLight'\nimport ambientLight from './ambientLight'\nimport directionalLight from './directionalLight'\nimport room from './room'\nimport playerSpawn from './playerSpawn'\n\nconst components = {\n  playerSpawn,\n  box,\n  sphere,\n  cylinder,\n  pointLight,\n  ambientLight,\n  directionalLight,\n  room\n}\nexport default components\n","import React, { useState } from 'react'\n\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemText from '@material-ui/core/ListItemText'\nimport ListItemIcon from '@material-ui/core/ListItemIcon'\nimport Collapse from '@material-ui/core/Collapse'\n\nimport ExpandLessIcon from '@material-ui/icons/ExpandLess'\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore'\n\n/**\n * A list item capable of being expanded or collapsed.\n */\nexport default function ListSection (props) {\n  const [isExpanded, setIsExpanded] = useState(true)\n  return (\n    <>\n      <ListItem button onClick={() => setIsExpanded(!isExpanded)}>\n        <ListItemIcon>\n          {\n            isExpanded\n              ? <ExpandLessIcon />\n              : <ExpandMoreIcon />\n          }\n        </ListItemIcon>\n        <ListItemText>{props.title}</ListItemText>\n      </ListItem>\n      <Collapse in={isExpanded}>\n        <ListItem>\n          {props.children}\n        </ListItem>\n      </Collapse>\n    </>\n  )\n}\n","/* Material UI components. */\nimport List from '@material-ui/core/List'\n\n/* Game components. */\nimport components from '../game/components'\n\n/* Editor components. */\nimport ListSection from './ListSection'\n\nexport default function Inspector ({ data, selection, onChange }) {\n  const selectedObjects = data.objects.filter(x => selection.has(x.id))\n  const selectedInspectors = selectedObjects.map(\n    x => components[x.type].inspectors\n  )\n  const objectInspectors = selectedObjects.length > 0\n    ? selectedInspectors.reduce((a, x) => x.filter(\n        inspector => a.includes(inspector))\n      )\n    : []\n  return (\n    <form noValidate>\n      <List>\n        {objectInspectors.map(inspector => {\n          const Component = inspector.component\n          return (\n            <ListSection key={inspector.key} title={inspector.displayName}>\n              <Component\n                data={data}\n                selection={selection}\n                onChange={onChange}\n              />\n            </ListSection>\n          )\n        })}\n      </List>\n    </form>\n  )\n}\n","/* React. */\nimport { useMemo } from 'react'\n\n/* Material UI components. */\nimport Button from '@material-ui/core/Button'\nimport Grid from '@material-ui/core/Grid'\nimport Tooltip from '@material-ui/core/Tooltip'\n\n/* react-three-fiber. */\nimport { Canvas } from 'react-three-fiber'\n\n/* Physics. */\nimport {\n  DisablePhysics\n} from '../physics'\n\n/* Game components. */\nimport components from '../game/components'\n\nfunction PaletteItem ({ onClick, text, component, distance }) {\n  const Component = component\n  const d = (1 / Math.sqrt(3)) * distance\n  return (\n    <Grid item xs={4}>\n      <Tooltip title={`Add ${text}`}>\n        <Button onClick={onClick}>\n          <div\n            style={{\n              position: 'relative',\n              width: '1.0in',\n              height: '1.0in',\n              overflow: 'hidden'\n            }}\n          >\n            <Canvas\n              camera={{ position: [d, d, d] }}\n              invalidateFrameloop\n            >\n              <DisablePhysics>\n                <directionalLight position={[1, 3, 2]} />\n                <ambientLight />\n                <Component inEditor />\n              </DisablePhysics>\n            </Canvas>\n          </div>\n        </Button>\n      </Tooltip>\n    </Grid>\n  )\n}\n\nexport default function Palette ({ onSelect }) {\n  const paletteItems = useMemo(() => {\n    const ret = []\n    for (const type in components) {\n      ret.push(\n        <PaletteItem\n          key={type}\n          onClick={() => onSelect(type)}\n          text={components[type].displayName}\n          component={components[type].component}\n          distance={components[type].distance || 2}\n        />\n      )\n    }\n    return ret\n  }, [onSelect])\n  return (\n    <Grid container>\n      {paletteItems}\n    </Grid>\n  )\n}\n","/* Material UI components. */\nimport Fade from '@material-ui/core/Fade'\nimport Box from '@material-ui/core/Box'\n\nexport default function TabPanel (props) {\n  const { children, value, index, ...other } = props\n\n  return (\n    <Fade\n      in={value === index}\n      style={{\n        display: value === index ? 'block' : 'none'\n      }}\n    >\n      <div\n        role='tabpanel'\n        {...other}\n      >\n        <Box>\n          {children}\n        </Box>\n      </div>\n    </Fade>\n  )\n}\n","/* React. */\nimport {\n  useCallback,\n  useState,\n  useRef,\n  useMemo,\n  useEffect\n} from 'react'\n\n/* react-three-fiber. */\nimport { useThree, useFrame } from 'react-three-fiber'\n\n/* three.js */\nimport {\n  Vector3,\n  Scene\n} from 'three'\n\nimport { useArrowGeometry } from '../hooks'\n\n/*\n * An arrow in a single direction.\n */\nfunction TranslateArrow ({\n  onBeginDrag,\n  onEndDrag,\n  onDrag,\n  color,\n  direction,\n  ...rest\n}) {\n  const arrowGeometry = useArrowGeometry()\n  const [isHovering, setIsHovering] = useState()\n\n  const [dx, dy, dz] = direction\n  const rotation = [\n    Math.atan2(Math.sqrt(dx ** 2 + dz ** 2), dy),\n    0,\n    Math.atan2(-dx, dz)\n  ]\n  const handlePointerOver = useCallback((...args) => {\n    setIsHovering(true)\n  }, [setIsHovering])\n  const handlePointerLeave = useCallback((...args) => {\n    setIsHovering(false)\n  }, [setIsHovering])\n  const totalAmount = useRef(new Vector3())\n\n  const ref = useRef()\n\n  /* Dragging. */\n  const [isDragging, setIsDragging] = useState(false)\n  const handlePointerDown = useCallback((e) => {\n    e.stopPropagation()\n    e.target.setPointerCapture(e.pointerId)\n    setIsDragging(true)\n    totalAmount.current.set(0, 0, 0)\n    if (onBeginDrag) {\n      onBeginDrag()\n    }\n  }, [setIsDragging, onBeginDrag])\n\n  const handlePointerUp = useCallback((e) => {\n    e.stopPropagation()\n    e.target.releasePointerCapture(e.pointerId)\n    setIsDragging(false)\n    if (onEndDrag) {\n      onEndDrag(totalAmount.current.clone())\n    }\n  }, [setIsDragging, onEndDrag])\n\n  /* Calculating direction. */\n  const { camera, size } = useThree()\n\n  const handlePointerMove = useCallback((e) => {\n    const b = new Vector3()\n    const v = new Vector3(dx, dy, dz)\n    if (isDragging) {\n      ref.current.getWorldPosition(b)\n\n      v.add(b)\n      v.project(camera)\n      b.project(camera)\n\n      v.sub(b)\n      const len = Math.sqrt(v.x ** 2 + v.y ** 2)\n      v.multiplyScalar(1 / len)\n      const dot = (\n        2 * v.x * e.movementX / size.width -\n        2 * v.y * e.movementY / size.height\n      )\n\n      v.multiplyScalar(dot)\n      v.add(b)\n      v.unproject(camera)\n      b.unproject(camera)\n      v.sub(b)\n\n      if (onDrag) {\n        totalAmount.current.add(v)\n        onDrag(v)\n      }\n    }\n  }, [isDragging, onDrag, camera, dx, dy, dz, size])\n\n  return (\n    <mesh\n      geometry={arrowGeometry}\n      onPointerDown={handlePointerDown}\n      onPointerUp={handlePointerUp}\n      onPointerMove={handlePointerMove}\n      onPointerOver={handlePointerOver}\n      onPointerLeave={handlePointerLeave}\n      rotation={rotation}\n      ref={ref}\n      renderOrder={1000}\n      {...rest}\n    >\n      <meshBasicMaterial\n        color={(isHovering || isDragging) ? '#ffbb22' : color}\n      />\n    </mesh>\n  )\n}\n\nexport default function TranslateArrows ({\n  position,\n  onDrag,\n  onBeginDrag,\n  onEndDrag\n}) {\n  const ref = useRef()\n\n  /* Callbacks. */\n  const handleBeginDrag = useCallback(() => {\n    if (onBeginDrag) {\n      onBeginDrag()\n    }\n  }, [onBeginDrag])\n\n  const handleEndDrag = useCallback((amount) => {\n    if (onEndDrag) {\n      onEndDrag(amount)\n    }\n  }, [onEndDrag])\n\n  const handleDrag = useCallback((v) => {\n    if (onDrag) {\n      onDrag(v)\n    }\n  }, [onDrag])\n\n  const { camera, gl, scene } = useThree()\n\n  /*\n   * Add the arrows to its own scene so that they can be rendered on top of the\n   * editor.\n   */\n  const arrowScene = useMemo(() => new Scene(), [])\n  useEffect(() => {\n    arrowScene.clear()\n    arrowScene.add(ref.current)\n  }, [scene, ref, arrowScene])\n\n  /* Scale so that the arrows have a constant size on the screen. */\n  const worldPos = new Vector3()\n  useFrame(() => {\n    ref.current.getWorldPosition(worldPos)\n    worldPos.applyMatrix4(camera.matrixWorldInverse)\n    const scale = -0.1 * worldPos.z\n    ref.current.scale.set(scale, scale, scale)\n\n    /* Render the arrows on top of the scene. */\n    gl.clearDepth()\n    gl.render(arrowScene, camera)\n  }, 2)\n\n  const directions = [\n    [[1, 0, 0], '#ff0000'],\n    [[0, 1, 0], '#00ff00'],\n    [[0, 0, 1], '#0000ff']\n  ]\n\n  return (\n    <group ref={ref} position={position}>\n      {directions.map(([direction, color], i) => (\n        <TranslateArrow\n          key={i}\n          direction={direction}\n          color={color}\n          onDrag={handleDrag}\n          onBeginDrag={handleBeginDrag}\n          onEndDrag={handleEndDrag}\n        />\n      ))}\n    </group>\n  )\n}\n","import { useRef, useCallback, useEffect, forwardRef } from 'react'\nimport { useThree, useFrame } from 'react-three-fiber'\nimport { useEventListener, useIsKeyDown } from '../hooks'\nimport { Vector3 } from 'three'\n\nexport default forwardRef(({\n  position,\n  mode,\n  ...rest\n}, ref) => {\n  const rotationHelper = useRef()\n  const { setDefaultCamera } = useThree()\n  const speed = 3\n\n  /* Handle mouselook. */\n  const handleMouseMove = useCallback((e) => {\n    if (mode === 'fps') {\n      ref.current.rotation.x -= e.movementY * 0.005\n      rotationHelper.current.rotation.y -= e.movementX * 0.005\n    }\n  }, [mode, ref])\n  useEventListener('mousemove', handleMouseMove)\n\n  const keyIsDown = useIsKeyDown()\n\n  useEffect(() => {\n    setDefaultCamera(ref.current)\n  }, [setDefaultCamera, ref])\n\n  const [x, y, z] = position\n  useEffect(() => {\n    rotationHelper.current.position.set(x, y, z)\n  }, [x, y, z])\n\n  const right = new Vector3()\n  const up = new Vector3()\n  const forward = new Vector3()\n\n  useFrame((state, dt) => {\n    /* Update the camera. */\n    ref.current.updateMatrixWorld()\n    if (mode === 'fps') {\n      const totalSpeed = speed * (keyIsDown.current.Shift ? 4 : 1)\n      const position = rotationHelper.current.position\n      ref.current.matrixWorld.extractBasis(right, up, forward)\n      forward.negate()\n      if (keyIsDown.current.E) {\n        position.addScaledVector(up, dt * totalSpeed)\n      }\n      if (keyIsDown.current.Q) {\n        position.addScaledVector(up, -dt * totalSpeed)\n      }\n      if (keyIsDown.current.D) {\n        position.addScaledVector(right, dt * totalSpeed)\n      }\n      if (keyIsDown.current.A) {\n        position.addScaledVector(right, -dt * totalSpeed)\n      }\n      if (keyIsDown.current.W) {\n        position.addScaledVector(forward, dt * totalSpeed)\n      }\n      if (keyIsDown.current.S) {\n        position.addScaledVector(forward, -dt * totalSpeed)\n      }\n    }\n  })\n\n  return (\n    <group ref={rotationHelper}>\n      <perspectiveCamera ref={ref} />\n    </group>\n  )\n})\n","/* React. */\nimport {\n  useMemo\n} from 'react'\n\n/* react-three-fiber. */\nimport { useFrame } from 'react-three-fiber'\n\n/* three.js */\nimport {\n  MeshMatcapMaterial,\n  CustomBlending,\n  OneFactor,\n  DstAlphaFactor,\n  Color,\n  TextureLoader\n} from 'three'\n\n/* Material UI. */\nimport { useTheme } from '@material-ui/core/styles'\n\nfunction makeSelectionMaterial (color) {\n  const mat = new MeshMatcapMaterial({\n    blending: CustomBlending,\n    blendSrc: OneFactor,\n    blendDst: DstAlphaFactor,\n    color: new Color().set(color),\n    transparent: true\n  })\n  const textureLoader = new TextureLoader()\n  textureLoader.load('/textures/matcap.png', (texture) => {\n    mat.matcap = texture\n    mat.matcap = texture\n  })\n  return mat\n}\n\nfunction useSelectionMaterial () {\n  const theme = useTheme()\n  return useMemo(() => makeSelectionMaterial(\n    theme.palette.secondary.main\n  ), [theme])\n}\n\nexport default function SelectionRenderer ({ selection }) {\n  const selectionMaterial = useSelectionMaterial()\n\n  useFrame(({ gl, scene, camera }) => {\n    gl.autoClear = false\n    gl.clear()\n    gl.render(scene, camera)\n    if (selection.size > 0) {\n      const originalVisibles = scene.children.map(x => x.visible)\n      scene.children.forEach(x => {\n        x.visible = selection.has(x.userData.id)\n      })\n      scene.overrideMaterial = selectionMaterial\n      gl.render(scene, camera)\n      scene.children.forEach((x, i) => {\n        x.visible = originalVisibles[i]\n      })\n      scene.overrideMaterial = null\n    }\n  }, 1)\n  return null\n}\n","/* React. */\nimport {\n  useCallback,\n  useState,\n  useMemo\n} from 'react'\n\n/* react-three-fiber. */\nimport { Canvas } from 'react-three-fiber'\n\n/* three.js */\nimport {\n  Vector3\n} from 'three'\n\n/* Editor components. */\nimport TranslateArrows from './TranslateArrows'\nimport Camera from './Camera'\nimport SelectionRenderer from './SelectionRenderer'\n\n/* Physics. */\nimport {\n  PhysicsScene\n} from '../physics'\n\n/* Game components. */\nimport components from '../game/components'\n\n/* Utils. */\nimport { useEventListener } from '../hooks'\n\nexport default function ThreeView ({\n  data,\n  selection,\n  onSelectionChange,\n  onChange,\n  onEdit,\n  cameraRef\n}) {\n  const [cameraMode, setCameraMode] = useState()\n\n  /* Camera controls. */\n  const handleMouseDown = (e) => {\n    if (e.buttons === 2) {\n      setCameraMode('fps')\n    }\n  }\n\n  const handleMouseUp = (e) => {\n    setCameraMode()\n  }\n  useEventListener('mouseup', handleMouseUp)\n\n  const handleContextMenu = (e) => {\n    e.preventDefault()\n  }\n\n  /* Selection. */\n  const handleObjectSelected = useCallback((id) => {\n    const newSelection = new Set(selection)\n    if (newSelection.has(id)) {\n      newSelection.delete(id)\n    } else {\n      newSelection.add(id)\n    }\n    onSelectionChange(newSelection)\n  }, [selection, onSelectionChange])\n\n  const handlePointerMissed = useCallback(() => {\n    onSelectionChange(new Set())\n  }, [onSelectionChange])\n\n  /* Movement. */\n  const moveSelection = useCallback((amount) => {\n    const newData = {\n      ...data,\n      objects: data.objects.map(x => {\n        if (selection.has(x.id)) {\n          /* If the object is selected, modify it. */\n          const position = (\n            x.props.position\n              ? [\n                  x.props.position[0] + amount.x,\n                  x.props.position[1] + amount.y,\n                  x.props.position[2] + amount.z\n                ]\n              : [amount.x, amount.y, amount.z]\n          )\n\n          /* Clone the object. */\n          return {\n            ...x,\n            props: {\n              ...x.props,\n              position\n            }\n          }\n        } else {\n          /* Otherwise just return the object. */\n          return x\n        }\n      })\n    }\n    return newData\n  }, [data, selection])\n\n  /* Dragging. */\n  const [isDragging, setIsDragging] = useState(false)\n  const handleBeginDrag = useCallback(() => {\n    setIsDragging(true)\n  }, [setIsDragging])\n\n  const handleDrag = useCallback((amount) => {\n    onChange(moveSelection(amount))\n  }, [moveSelection, onChange])\n\n  const handleEndDrag = useCallback(() => {\n    onEdit(data)\n    setIsDragging(false)\n  }, [data, onEdit, setIsDragging])\n\n  const origin = useMemo(() => {\n    const origin = new Vector3(0, 0, 0)\n    const pos = new Vector3()\n    data.objects.forEach(x => {\n      if (selection.has(x.id)) {\n        if (x.props.position) {\n          pos.set(...x.props.position)\n        } else {\n          pos.set(0, 0, 0)\n        }\n        origin.add(pos)\n      }\n    })\n    origin.multiplyScalar(1 / selection.size)\n    return origin\n  }, [data, selection])\n\n  /* Keyboard shortcuts. */\n  useEventListener('keyup', (e) => {\n    /* Handle delete. */\n    if (e.key === 'Delete') {\n      if (e.target === document.body) {\n        onChange({\n          ...data,\n          objects: data.objects.filter(x => !selection.has(x.id))\n        })\n        onSelectionChange(new Set())\n      }\n    }\n  })\n\n  /* Create the components in the scene. */\n  const gameComponents = data.objects.map((x, i) => {\n    const Component = components[x.type].component\n    return (\n      <group\n        key={x.id}\n        userData={x}\n        onPointerUp={(e) => {\n          e.stopPropagation()\n          if (!isDragging && cameraMode !== 'fps') {\n            handleObjectSelected(x.id)\n          }\n        }}\n      >\n        <Component\n          {...x.props}\n          inEditor\n        />\n      </group>\n    )\n  })\n\n  return (\n    <Canvas\n      onMouseDown={handleMouseDown}\n      onContextMenu={handleContextMenu}\n      onPointerMissed={handlePointerMissed}\n    >\n      <PhysicsScene>\n        <Camera\n          position={[0, 0, 2]}\n          mode={cameraMode}\n          ref={cameraRef}\n        />\n        {gameComponents}\n        <TranslateArrows\n          onDrag={handleDrag}\n          onBeginDrag={handleBeginDrag}\n          onEndDrag={handleEndDrag}\n          position={[origin.x, origin.y, origin.z]}\n        />\n      </PhysicsScene>\n      <SelectionRenderer selection={selection} />\n    </Canvas>\n  )\n}\n","import { v4 as uuid } from 'uuid'\nimport { sphere, hull } from 'tcollide'\nimport { useThree, useFrame } from 'react-three-fiber'\nimport { useCallback, useEffect, useRef, useMemo, useState } from 'react'\nimport { useBody, useContacts } from '../physics'\nimport { useEventListener, useIsKeyDown } from '../hooks'\nimport { Vector3 } from 'three'\n\nfunction Snowball ({ position, direction, speed }) {\n  const ref = useRef()\n  const options = useMemo(() => ({\n    supports: [\n      sphere({ radius: 0.25 })\n    ]\n  }), [])\n  const api = useBody(ref, options)\n\n  const [x, y, z] = position\n  const [dx, dy, dz] = direction\n\n  useEffect(() => {\n    api.transform.setPosition(x + dx, y + dy, z + dz)\n    api.update()\n  }, [api, x, y, z, dx, dy, dz])\n\n  useEffect(() => {\n    api.velocity.set(dx * speed, dy * speed, dz * speed)\n    api.update()\n  }, [api, dx, dy, dz, speed])\n\n  return (\n    <mesh ref={ref} position={position}>\n      <sphereGeometry args={[0.25, 16, 8]} />\n      <meshStandardMaterial color='white' />\n    </mesh>\n  )\n}\n\nexport default function Player ({ position, rotation, ...rest }) {\n  position = position || [0, 0, 0]\n  rotation = rotation || [0, 0, 0]\n\n  const camera = useRef()\n  const rotationHelper = useRef()\n  const { setDefaultCamera } = useThree()\n  const speed = 4\n  const jumpSpeed = 3\n\n  const ref = useRef()\n  const options = useMemo(() => ({\n    supports: [\n      hull(\n        sphere({ radius: 0.25 }),\n        sphere({ position: [0, -1, 0], radius: 0.25 })\n      )\n    ]\n  }), [])\n  const api = useBody(ref, options)\n  const [bullets, setSnowballs] = useState([])\n\n  const [x, y, z] = position\n  useEffect(() => {\n    api.transform.setPosition(x, y, z)\n    api.update()\n  }, [api, x, y, z])\n\n  const [rx, ry, rz] = rotation\n  useEffect(() => {\n    rotationHelper.current.rotation.y = ry * Math.PI / 180\n  }, [rx, ry, rz])\n\n  const contacts = useContacts(api)\n\n  /* Handle mouselook. */\n  const handleMouseMove = useCallback((e) => {\n    const rx = camera.current.rotation.x\n    camera.current.rotation.x = Math.min(\n      Math.max(\n        rx - e.movementY * 0.005, -Math.PI / 2\n      ),\n      Math.PI / 2\n    )\n    rotationHelper.current.rotation.y -= e.movementX * 0.005\n  }, [])\n  useEventListener('mousemove', handleMouseMove)\n\n  useEffect(() => {\n    setDefaultCamera(camera.current)\n  }, [setDefaultCamera])\n\n  const keyIsDown = useIsKeyDown()\n\n  const right = new Vector3()\n  const up = new Vector3()\n  const forward = new Vector3()\n  const cameraForward = new Vector3()\n\n  const handleMouseDown = () => {\n    setSnowballs([...bullets, {\n      key: uuid(),\n      position: [api.position.x, api.position.y, api.position.z],\n      direction: [cameraForward.x, cameraForward.y, cameraForward.z],\n      speed: 15\n    }].slice(-10))\n  }\n  useEventListener('mousedown', handleMouseDown)\n\n  useFrame((state, dt) => {\n    /* Update the camera. */\n    camera.current.updateMatrixWorld()\n    cameraForward.setFromMatrixColumn(camera.current.matrixWorld, 2)\n    cameraForward.negate()\n    rotationHelper.current.matrixWorld.extractBasis(right, up, forward)\n    forward.negate()\n    if (keyIsDown.current.E) {\n      api.position.addScaledVector(up, dt * speed)\n      api.transform.setPosition(api.position)\n      api.update()\n    }\n    if (keyIsDown.current.Q) {\n      api.position.addScaledVector(up, -dt * speed)\n      api.transform.setPosition(api.position)\n      api.update()\n    }\n    if (keyIsDown.current.D) {\n      api.position.addScaledVector(right, dt * speed)\n      api.transform.setPosition(api.position)\n      api.update()\n    }\n    if (keyIsDown.current.A) {\n      api.position.addScaledVector(right, -dt * speed)\n      api.transform.setPosition(api.position)\n      api.update()\n    }\n    if (keyIsDown.current.W) {\n      api.position.addScaledVector(forward, dt * speed)\n      api.transform.setPosition(api.position)\n      api.update()\n    }\n    if (keyIsDown.current.S) {\n      api.position.addScaledVector(forward, -dt * speed)\n      api.transform.setPosition(api.position)\n      api.update()\n    }\n    /* Jump. */\n    if (keyIsDown.current[' ']) {\n      if (\n        contacts.current.length > 0 &&\n        contacts.current.some(x => x.amount.y / x.amount.length() < -0.5)\n      ) {\n        api.velocity.set(0, jumpSpeed, 0)\n      }\n    }\n  })\n\n  return (\n    <>\n      <group ref={ref} {...rest}>\n        <group ref={rotationHelper}>\n          <perspectiveCamera ref={camera} />\n        </group>\n      </group>\n      {bullets.map(({ key, ...props }) => (\n        <Snowball key={key} {...props} />\n      ))}\n    </>\n  )\n}\n","import { v4 as uuid } from 'uuid'\nimport { Canvas } from 'react-three-fiber'\nimport components from './components'\nimport {\n  PhysicsScene\n} from '../physics'\nimport Player from './Player'\n\nconst nextId = () => {\n  return uuid()\n}\n\n/**\n * Create an empty game scene.\n */\nexport function scene () {\n  return {\n    objects: []\n  }\n}\n\n/**\n * Create an object with the specified type and properties.\n */\nexport function object ({ type, props }) {\n  return {\n    type,\n    props,\n    id: nextId()\n  }\n}\n\nexport function Game ({ data }) {\n  const playerSpawn = data.objects.find(x => x.type === 'playerSpawn')\n  const playerPosition = playerSpawn.props.position\n  const playerRotation = playerSpawn.props.rotation\n\n  return (\n    <Canvas onClick={e => e.target.requestPointerLock()}>\n      <PhysicsScene>\n        {data.objects.map((x, i) => {\n          const Component = components[x.type].component\n          return (\n            <Component\n              key={x.id}\n              {...x.props}\n            />\n          )\n        })}\n        <Player position={playerPosition} rotation={playerRotation} />\n      </PhysicsScene>\n    </Canvas>\n  )\n}\n","/* React. */\nimport {\n  useRef,\n  useState\n} from 'react'\n\n/* three.js */\nimport {\n  Vector3\n} from 'three'\n\n/* Material UI components. */\nimport Button from '@material-ui/core/Button'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport Tooltip from '@material-ui/core/Tooltip'\nimport Tabs from '@material-ui/core/Tabs'\nimport Tab from '@material-ui/core/Tab'\nimport Drawer from '@material-ui/core/Drawer'\nimport CssBaseline from '@material-ui/core/CssBaseline'\n\n/* Material UI icons. */\nimport PlayArrowIcon from '@material-ui/icons/PlayArrow'\nimport StopIcon from '@material-ui/icons/Stop'\nimport AddIcon from '@material-ui/icons/Add'\nimport CloudDownloadIcon from '@material-ui/icons/CloudDownload'\nimport CloudUploadIcon from '@material-ui/icons/CloudUpload'\n\nimport { makeStyles } from '@material-ui/core/styles'\n\n/* Editor components. */\nimport Inspector from './Inspector'\nimport Palette from './Palette'\nimport TabPanel from './TabPanel'\nimport ThreeView from './ThreeView'\n\n/* Game. */\nimport { Game, scene, object } from '../game'\nimport components from '../game/components'\n\n/* Hooks. */\nimport { useUndoable, useKeyboardShortcut } from '../hooks'\n\n/* Utils. */\nimport { download, upload } from '../utils'\n\nconst drawerWidth = 320\nconst useStyles = makeStyles(theme => ({\n  root: {\n    display: 'flex'\n  },\n  drawer: {\n    width: drawerWidth,\n    flexShrink: 0\n  },\n  drawerContent: {\n    width: drawerWidth,\n    overflowX: 'hidden'\n  },\n  content: {\n    flexGrow: 1,\n    position: 'absolute',\n    left: drawerWidth,\n    top: 0,\n    right: 0,\n    bottom: 0\n  }\n}))\n\nfunction EditorSidebar ({\n  data,\n  selection,\n  camera,\n  onChange,\n  onPlay,\n  onStop,\n  isPlaying\n}) {\n  const classes = useStyles()\n  const [tab, setTab] = useState(0)\n\n  const addObject = (type) => {\n    /* Calculate camera direction. */\n    const right = new Vector3()\n    const up = new Vector3()\n    const forward = new Vector3()\n    const cameraPosition = new Vector3()\n    camera.current.matrixWorld.extractBasis(right, up, forward)\n    camera.current.getWorldPosition(cameraPosition)\n    forward.negate()\n\n    /* Create the object in front of the camera. */\n    const distance = (components[type].distance || 2.0)\n    const position = [\n      cameraPosition.x + forward.x * distance,\n      cameraPosition.y + forward.y * distance,\n      cameraPosition.z + forward.z * distance\n    ]\n\n    onChange({\n      ...data,\n      objects: [\n        ...data.objects,\n        object({\n          type,\n          props: { kinematic: true, position }\n        })\n      ]\n    })\n  }\n\n  const handleDownload = () => {\n    download('scene.json', JSON.stringify(data))\n  }\n\n  const handleUpload = () => {\n    upload()\n      .then(data => JSON.parse(data))\n      .then(data => onChange(data))\n  }\n\n  const handleNew = () => {\n    onChange(scene({}))\n  }\n\n  return (\n    <Drawer variant='persistent' className={classes.drawer} open>\n      <div className={classes.drawerContent}>\n        <Toolbar>\n          <Tooltip title='New'>\n            <Button onClick={handleNew}>\n              <AddIcon />\n            </Button>\n          </Tooltip>\n          <Tooltip title='Upload'>\n            <Button onClick={handleUpload}>\n              <CloudUploadIcon />\n            </Button>\n          </Tooltip>\n          <Tooltip title='Download' onClick={handleDownload}>\n            <Button>\n              <CloudDownloadIcon />\n            </Button>\n          </Tooltip>\n          <Tooltip title={isPlaying ? 'Stop' : 'Play'}>\n            <Button onClick={isPlaying ? onStop : onPlay}>\n              {isPlaying\n                ? (<StopIcon />)\n                : (<PlayArrowIcon />)}\n            </Button>\n          </Tooltip>\n        </Toolbar>\n        <Tabs\n          onChange={(e, value) => setTab(value)}\n          value={tab}\n          variant='fullWidth'\n        >\n          <Tab label='Palette' />\n          <Tab label='Properties' />\n        </Tabs>\n        <TabPanel value={tab} index={0}>\n          <Palette onSelect={addObject} />\n        </TabPanel>\n        <TabPanel value={tab} index={1}>\n          <Inspector data={data} selection={selection} onChange={onChange} />\n        </TabPanel>\n      </div>\n    </Drawer>\n  )\n}\n\nexport function Editor (props) {\n  const [data, pushData, undo, redo, setData] = useUndoable(() => scene({}))\n  const [selection, setSelection] = useState(new Set())\n  const [clipboardData, setClipboardData] = useState([])\n  const [isPlaying, setIsPlaying] = useState(false)\n\n  const classes = useStyles()\n  const cameraRef = useRef()\n\n  /* When the data is changed, updated it, but not update the undo history. */\n  const handleChange = (newData) => {\n    setData(newData)\n  }\n\n  /* When an edit is made, update the undo history. */\n  const handleEdit = (newData) => {\n    pushData(newData)\n  }\n\n  const selectedObjects = data.objects.filter(x => selection.has(x.id))\n  const copy = () => {\n    setClipboardData(selectedObjects)\n  }\n  const paste = () => {\n    const objects = [\n      ...data.objects,\n      ...clipboardData.map(object)\n    ]\n    pushData({\n      ...data,\n      objects\n    })\n  }\n\n  useKeyboardShortcut(['Control', 'Z'], undo)\n  useKeyboardShortcut(['Control', 'Shift', 'Z'], redo)\n  useKeyboardShortcut(['Control', 'C'], copy)\n  useKeyboardShortcut(['Control', 'V'], paste)\n\n  return (\n    <div className={classes.root}>\n      <CssBaseline />\n      <EditorSidebar\n        data={data}\n        selection={selection}\n        onChange={handleEdit}\n        camera={cameraRef}\n        isPlaying={isPlaying}\n        onPlay={() => { setIsPlaying(true) }}\n        onStop={() => { setIsPlaying(false) }}\n      />\n      <main className={classes.content}>\n        {isPlaying\n          ? (\n            <Game data={data} />\n            )\n          : (\n            <ThreeView\n              cameraRef={cameraRef}\n              data={data}\n              selection={selection}\n              onSelectionChange={setSelection}\n              onChange={handleChange}\n              onEdit={handleEdit}\n            />\n            )}\n      </main>\n    </div>\n  )\n}\n","import './App.css'\nimport { Editor } from './editor'\n\nfunction App () {\n  return (\n    <div className='App'>\n      <Editor />\n    </div>\n  )\n}\n\nexport default App\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry)\n      getFID(onPerfEntry)\n      getFCP(onPerfEntry)\n      getLCP(onPerfEntry)\n      getTTFB(onPerfEntry)\n    })\n  }\n}\n\nexport default reportWebVitals\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.css'\nimport App from './App'\nimport reportWebVitals from './reportWebVitals'\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n)\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals()\n"],"sourceRoot":""}