{"version":3,"sources":["physics/index.js","utils/index.js","game/components/Model.js","game/components/Brush.js","game/components/RoundBrush.js","game/inspectors/Vector3Property.js","game/inspectors/position.js","game/inspectors/rotation.js","game/inspectors/scale.js","game/inspectors/BooleanProperty.js","game/inspectors/body.js","game/inspectors/ColorProperty.js","game/inspectors/color.js","game/inspectors/NumberProperty.js","game/inspectors/roundBrush.js","game/inspectors/visibility.js","game/inspectors/UrlProperty.js","game/inspectors/model.js","game/inspectors/mixins.js","game/inspectors/boxSize.js","game/components/box.js","game/inspectors/sphereSize.js","game/components/sphere.js","game/inspectors/cylinderSize.js","game/components/cylinder.js","game/components/pointLight.js","game/components/ambientLight.js","game/components/directionalLight.js","game/inspectors/Vector2Property.js","game/components/room.js","hooks/index.js","game/components/playerSpawn.js","game/components/index.js","editor/ListSection.js","editor/Inspector.js","editor/Palette.js","editor/TabPanel.js","editor/TranslateArrows.js","editor/Camera.js","editor/SelectionRenderer.js","editor/ThreeView.js","game/Player.js","game/index.js","editor/index.js","App.js","reportWebVitals.js","index.js"],"names":["PhysicsSceneContext","createContext","scene","DisablePhysics","children","s","useMemo","Provider","value","PhysicsScene","useFrame","state","delta","update","Math","min","useBody","ref","options","isEnabled","b","body","useContext","useEffect","current","matrixAutoUpdate","subscription","changed","subscribe","matrix","copy","transform","add","unsubscribe","remove","randomizeDirection","d","set","random","lengthSq","normalize","useSupportGeometry","support","prev","useRef","dispose","ret","geometry","BufferGeometry","triangles","vertices","makeTriangle","ia","ib","ic","ac","clone","sub","bc","normal","cross","distance","dot","edgeCounts","Map","incEdge","a","key1","key2","has","get","v","Vector3","some","x","equals","push","length","t","negate","tmp","done","triangle","clear","i","splice","keys","key","e0","e1","floor","tri","vertexToTriangles","forEach","index","connected","t0","acos","max","PI","splitFaces","vertexData","Float32Array","flatMap","y","z","indexData","setAttribute","BufferAttribute","setIndex","computeVertexNormals","attributes","needsUpdate","computeBoundingSphere","makeSupportGeometry","getBaseUrl","loc","window","location","protocol","host","pathname","split","ErrorBoundary","props","hasError","this","error","console","Component","ObjModel","forwardRef","url","rest","useLoader","OBJLoader","object","GltfModel","GLTFLoader","Model","useState","errorBoundaryKey","setErrorBoundaryKey","path","URL","model","match","fallback","SupportGeometry","Brush","position","rotation","scale","kinematic","color","userData","visible","inEditor","enableBody","modelUrl","undefined","supports","isKinematic","api","rx","ry","rz","sx","sy","sz","identity","multiply","Matrix4","makeRotationFromEuler","Euler","makeScale","setPosition","velocity","RoundBrush","roundRadius","flatTop","flatBottom","radius","roundSupport","circle","sphere","newSupport","sum","Vector3Property","selection","data","onChange","prop","label","defaultValue","origin","pos","objects","id","multiplyScalar","size","setPos","ox","oy","oz","map","round","handleBlur","isNaN","newData","Grid","container","spacing","item","xs","TextField","toUpperCase","variant","e","newPos","setComponent","target","onBlur","displayName","component","useStyles","makeStyles","theme","evenlySpaced","margin","BooleanProperty","classes","setValue","Box","className","FormControlLabel","control","Checkbox","checked","ColorProperty","type","NumberProperty","fullWidth","roundBrush","visibility","UrlProperty","find","string","_","isValidUrl","brush","roundBrushInspector","light","boxSize","inspectors","mixins","sizeX","sizeY","sizeZ","box","sphereSize","cylinderSize","height","r1","r2","hull","args","Vector2Property","Vector2","inspector","thickness","frontDoorSize","leftDoorSize","rightDoorSize","backDoorSize","defaultDoorSize","doorOptions","doorSize","axisIndex","side","wallSize","topWallSize","position1","position2","position3","every","makeWallSupports","arrowGeometry","segments","CylinderGeometry","translate","merge","ConeGeometry","makeArrowGeometry","useArrowGeometry","useEventListener","callback","document","addEventListener","removeEventListener","useIsKeyDown","keyIsDown","useCallback","useKeyboardShortcut","Object","filter","includes","PlayerSpawnPreview","components","playerSpawn","cylinder","pointLight","ambientLight","directionalLight","room","ListSection","isExpanded","setIsExpanded","ListItem","button","onClick","ListItemIcon","ListItemText","title","Collapse","in","Inspector","selectedObjects","selectedInspectors","objectInspectors","reduce","noValidate","List","PaletteItem","text","sqrt","Tooltip","Button","style","width","overflow","camera","invalidateFrameloop","Palette","onSelect","paletteItems","TabPanel","other","Fade","display","role","TranslateArrow","onBeginDrag","onEndDrag","onDrag","direction","isHovering","setIsHovering","dx","dy","dz","atan2","handlePointerOver","handlePointerLeave","totalAmount","isDragging","setIsDragging","handlePointerDown","stopPropagation","setPointerCapture","pointerId","handlePointerUp","releasePointerCapture","useThree","handlePointerMove","getWorldPosition","project","len","movementX","movementY","unproject","onPointerDown","onPointerUp","onPointerMove","onPointerOver","onPointerLeave","renderOrder","TranslateArrows","handleBeginDrag","handleEndDrag","amount","handleDrag","gl","arrowScene","Scene","worldPos","applyMatrix4","matrixWorldInverse","clearDepth","render","mode","rotationHelper","setDefaultCamera","right","up","forward","dt","updateMatrixWorld","totalSpeed","Shift","matrixWorld","extractBasis","E","addScaledVector","Q","D","A","W","S","fov","useSelectionMaterial","useTheme","mat","MeshMatcapMaterial","blending","CustomBlending","blendSrc","OneFactor","blendDst","DstAlphaFactor","Color","transparent","TextureLoader","load","texture","matcap","makeSelectionMaterial","palette","secondary","main","SelectionRenderer","selectionMaterial","originalVisibles","overrideMaterial","autoClear","ThreeView","onSelectionChange","onEdit","cameraRef","cameraMode","setCameraMode","handleObjectSelected","newSelection","Set","delete","handlePointerMissed","moveSelection","gameComponents","onMouseDown","buttons","onContextMenu","preventDefault","onPointerMissed","Camera","Snowball","speed","Player","bullets","setSnowballs","contacts","beginOverlap","event","endOverlap","indexOf","useContacts","cameraForward","uuid","slice","setFromMatrixColumn","Game","playerPosition","playerRotation","requestPointerLock","root","drawer","flexShrink","drawerContent","overflowX","content","flexGrow","left","top","bottom","EditorSidebar","onPlay","onStop","isPlaying","tab","setTab","Drawer","open","Toolbar","Promise","resolve","reject","element","createElement","appendChild","files","then","catch","click","removeChild","JSON","parse","filename","encodeURIComponent","download","stringify","Tabs","Tab","cameraPosition","Editor","initialState","setState","present","setPresent","past","setPast","future","setFuture","undo","redo","pushState","useUndoable","pushData","setData","setSelection","clipboardData","setClipboardData","setIsPlaying","errorMessage","setErrorMessage","handleEdit","CssBaseline","Snackbar","onClose","message","App","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.431ccbdc.chunk.js","sourcesContent":["import {\n  useEffect,\n  useRef,\n  useContext,\n  createContext,\n  useMemo\n} from 'react'\n\nimport { useFrame } from 'react-three-fiber'\n\nimport { scene, body, beginOverlap, endOverlap, changed } from 'tcollide'\n\nimport {\n  Vector3,\n  BufferAttribute,\n  BufferGeometry\n} from 'three'\n\nconst PhysicsSceneContext = createContext(scene({}))\n\nexport function DisablePhysics ({ children }) {\n  const s = useMemo(() => scene({}), [])\n  return (\n    <PhysicsSceneContext.Provider value={s}>\n      {children}\n    </PhysicsSceneContext.Provider>\n  )\n}\n\nexport function PhysicsScene ({ children }) {\n  const s = useMemo(() => scene({}), [])\n  useFrame((state, delta) => {\n    s.update(Math.min(delta, 0.1))\n  })\n  return (\n    <PhysicsSceneContext.Provider value={s}>\n      {children}\n    </PhysicsSceneContext.Provider>\n  )\n}\n\nexport function useBody (ref, options, isEnabled = true) {\n  const b = useMemo(() => body(options), [options])\n  const s = useContext(PhysicsSceneContext)\n\n  useEffect(() => {\n    if (ref.current) {\n      ref.current.matrixAutoUpdate = false\n    }\n    const subscription = changed(b).subscribe(() => {\n      if (ref.current) {\n        ref.current.matrix.copy(b.transform)\n      }\n    })\n    if (isEnabled) {\n      s.add(b)\n    }\n    return () => {\n      subscription.unsubscribe()\n      if (isEnabled) {\n        s.remove(b)\n      }\n    }\n  }, [b, s, ref, isEnabled])\n\n  return b\n}\n\nexport function useContacts (body) {\n  const contacts = useRef([])\n  useEffect(() => {\n    const subscription = beginOverlap(body).subscribe((event) => {\n      contacts.current.push(event)\n    })\n    return () => subscription.unsubscribe()\n  }, [body, contacts])\n  useEffect(() => {\n    const subscription = endOverlap(body).subscribe((event) => {\n      const index = contacts.current.indexOf(event)\n      contacts.current.splice(index, 1)\n    })\n    return () => subscription.unsubscribe()\n  }, [body, contacts])\n  return contacts\n}\n\nfunction randomizeDirection (d) {\n  do {\n    d.set(\n      Math.random() - Math.random(),\n      Math.random() - Math.random(),\n      Math.random() - Math.random()\n    )\n  } while (d.lengthSq() === 0)\n  d.normalize()\n}\n\nfunction makeSupportGeometry (support) {\n  const geometry = new BufferGeometry()\n\n  const tolerance = 0.01\n  const maxVertices = 4096\n\n  const triangles = []\n  const vertices = []\n\n  const makeTriangle = (ia, ib, ic) => {\n    const ac = vertices[ic].clone().sub(vertices[ia])\n    const bc = vertices[ic].clone().sub(vertices[ib])\n    const normal = ac.cross(bc)\n\n    if (normal.lengthSq() === 0) {\n      return null\n    }\n    normal.normalize()\n\n    const distance = normal.dot(vertices[ic])\n\n    return {\n      ia,\n      ib,\n      ic,\n      normal,\n      distance\n    }\n  }\n\n  const edgeCounts = new Map()\n\n  const incEdge = (a, b) => {\n    /*\n     * Maximum safe integer is 2**53, so we shift by half of 53 to create a key.\n     * If a vertex index is greater than 2**26, we got other problems ;).\n     */\n    const key1 = a + (b * 0x4000000)\n    const key2 = b + (a * 0x4000000)\n    if (edgeCounts.has(key2)) {\n      edgeCounts.set(key2, edgeCounts.get(key2) + 1)\n    } else {\n      edgeCounts.set(key1, (edgeCounts.get(key1) || 0) + 1)\n    }\n  }\n\n  /* Create initial triangles. */\n  while (vertices.length < 3) {\n    const v = new Vector3()\n    do {\n      randomizeDirection(v)\n      support(v)\n    } while (vertices.some(x => x.equals(v)))\n    vertices.push(v)\n  }\n\n  {\n    const v = new Vector3()\n    const t = makeTriangle(0, 2, 1)\n    v.copy(t.normal).negate()\n    support(v)\n    if (vertices.some(x => x.equals(v))) {\n      t.normal.negate()\n      const tmp = vertices[0]\n      vertices[0] = vertices[2]\n      vertices[2] = tmp\n      v.copy(t.normal).negate()\n      support(v)\n    }\n\n    vertices.push(v)\n\n    triangles.push(t)\n    triangles.push(makeTriangle(0, 1, 3))\n    triangles.push(makeTriangle(1, 2, 3))\n    triangles.push(makeTriangle(2, 0, 3))\n  }\n\n  let done = false\n  while (!done) {\n    done = true\n    for (const triangle of triangles) {\n      edgeCounts.clear()\n\n      const a = new Vector3().copy(triangle.normal)\n      support(a)\n\n      /*\n       * Add the vertex if we can expand more, and the vertex has not already\n       * been added.\n       */\n      if (\n        !vertices.some(x => a.equals(x)) &&\n        a.dot(triangle.normal) - triangle.distance > tolerance &&\n        vertices.length < maxVertices\n      ) {\n        done = false\n        for (let i = 0; i < triangles.length; i++) {\n          const t = triangles[i]\n          if (a.clone().sub(vertices[t.ia]).dot(t.normal) >= 0) {\n            incEdge(t.ia, t.ib)\n            incEdge(t.ib, t.ic)\n            incEdge(t.ic, t.ia)\n            /* Remove the triangle. */\n            triangles.splice(i, 1)\n            i--\n          }\n        }\n\n        /* Add the new vertex. */\n        vertices.push(a)\n\n        /* Create new faces from non-shared edges. */\n        for (const key of edgeCounts.keys()) {\n          if (edgeCounts.get(key) === 1) {\n            const e0 = key & 0x3ffffff\n            const e1 = Math.floor(key / 0x4000000)\n            const tri = (\n              makeTriangle(\n                e0,\n                e1,\n                vertices.length - 1\n              )\n            )\n            triangles.push(tri)\n          }\n        }\n      }\n    }\n  }\n\n  function splitFaces () {\n    const vertexToTriangles = new Map()\n    triangles.forEach(t => {\n      if (!vertexToTriangles.has(t.ia)) {\n        vertexToTriangles.set(t.ia, [])\n      }\n      if (!vertexToTriangles.has(t.ib)) {\n        vertexToTriangles.set(t.ib, [])\n      }\n      if (!vertexToTriangles.has(t.ic)) {\n        vertexToTriangles.set(t.ic, [])\n      }\n      vertexToTriangles.get(t.ia).push(t)\n      vertexToTriangles.get(t.ib).push(t)\n      vertexToTriangles.get(t.ic).push(t)\n    })\n    vertexToTriangles.forEach((triangles, index) => {\n      const connected = [[triangles[0]]]\n      triangles.forEach(t0 => {\n        for (const set of connected) {\n          const dot = t0.normal.dot(set[0].normal)\n          const angle = Math.acos(\n            Math.max(-1, Math.min(1, dot))\n          )\n          if (angle < Math.PI / 4) {\n            set.push(t0)\n            return\n          }\n        }\n        connected.push([t0])\n      })\n      for (let i = 1; i < connected.length; i++) {\n        connected[i].forEach(t => {\n          if (t.ia === index) {\n            t.ia = vertices.length\n          }\n          if (t.ib === index) {\n            t.ib = vertices.length\n          }\n          if (t.ic === index) {\n            t.ic = vertices.length\n          }\n        })\n        vertices.push(vertices[index])\n      }\n    })\n  }\n\n  splitFaces()\n\n  const vertexData = new Float32Array(vertices.flatMap(x => [x.x, x.y, x.z]))\n  const indexData = triangles.flatMap(t => [t.ia, t.ib, t.ic])\n\n  geometry.setAttribute('position', new BufferAttribute(vertexData, 3))\n  geometry.setIndex(indexData)\n  geometry.computeVertexNormals()\n  geometry.attributes.normal.needsUpdate = true\n  geometry.computeBoundingSphere()\n\n  return geometry\n}\n\n/*\n * Basically the expanding polytope algorithm, but with some extra steps.\n */\nexport function useSupportGeometry (support) {\n  const prev = useRef(null)\n  return useMemo(() => {\n    if (prev.current) {\n      prev.current.dispose()\n    }\n    const ret = makeSupportGeometry(support)\n    prev.current = ret\n    return ret\n  }, [support])\n}\n","import { ConeGeometry, CylinderGeometry } from 'three'\n\nexport function makeArrowGeometry (\n  segments = 8,\n  r1 = 0.05,\n  r2 = 0.15\n) {\n  const geometry = new CylinderGeometry(r1, r1, 1.0, segments, 1)\n    .translate(0, 0.5, 0)\n  geometry.merge(new ConeGeometry(r2, 0.5, segments, 1).translate(0, 1.25, 0))\n  return geometry\n}\n\n/*\n * Prompts the user to save the given text as the given filename.\n */\nexport function download (filename, text) {\n  const element = document.createElement('a')\n  element.setAttribute(\n    'href',\n    `data:text/plain;charset=utf-8,${encodeURIComponent(text)}`)\n  element.setAttribute('download', filename)\n\n  element.style.display = 'none'\n  document.body.appendChild(element)\n\n  element.click()\n\n  document.body.removeChild(element)\n}\n\n/*\n * Prompts the user to upload a file. Returns a promise that resolves to the\n * text loaded from the file.\n */\nexport function upload () {\n  return new Promise((resolve, reject) => {\n    const element = document.createElement('input')\n    element.setAttribute('type', 'file')\n\n    element.style.display = 'none'\n    document.body.appendChild(element)\n\n    element.addEventListener(\n      'change',\n      function () {\n        this.files[0].text()\n          .then((data) => resolve(data))\n          .catch((error) => reject(error))\n      },\n      false)\n\n    element.click()\n\n    document.body.removeChild(element)\n  })\n}\n\nexport function getBaseUrl () {\n  const loc = window.location\n  const baseUrl = `${loc.protocol}/${loc.host}/${loc.pathname.split('/')[1]}`\n  return baseUrl\n}\n","import { Suspense, Component, forwardRef, useState, useEffect } from 'react'\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader'\nimport { OBJLoader } from 'three/examples/jsm/loaders/OBJLoader'\nimport { useLoader } from 'react-three-fiber'\nimport { getBaseUrl } from '../../utils'\n\nclass ErrorBoundary extends Component {\n  constructor (props) {\n    super(props)\n    this.state = { hasError: false }\n  }\n\n  static getDerivedStateFromError (error) {\n    console.error(error)\n    return { hasError: true }\n  }\n\n  render () {\n    if (this.state.hasError) {\n      return null\n    } else {\n      return this.props.children\n    }\n  }\n}\n\nconst ObjModel = forwardRef(({ url, ...rest }, ref) => {\n  const scene = useLoader(OBJLoader, url)\n  return (\n    <primitive ref={ref} object={scene} {...rest} />\n  )\n})\n\nconst GltfModel = forwardRef(({ url, ...rest }, ref) => {\n  const { scene } = useLoader(GLTFLoader, url)\n  return (\n    <primitive ref={ref} object={scene} {...rest} />\n  )\n})\n\nconst Model = forwardRef(({ url, ...rest }, ref) => {\n  const [errorBoundaryKey, setErrorBoundaryKey] = useState(0)\n  const path = new URL(url, getBaseUrl()).pathname\n  let model = null\n\n  useEffect(() => {\n    setErrorBoundaryKey(key => key + 1)\n  }, [url])\n\n  if (path.match(/\\.glb$|\\.gltf$/)) {\n    model = (\n      <GltfModel ref={ref} url={url} {...rest} />\n    )\n  } else if (path.match(/\\.obj$/)) {\n    model = (\n      <ObjModel ref={ref} url={url} {...rest} />\n    )\n  } else {\n    return null\n  }\n\n  return (\n    <ErrorBoundary key={errorBoundaryKey}>\n      <Suspense fallback={null}>\n        {model}\n      </Suspense>\n    </ErrorBoundary>\n  )\n})\n\nexport default Model\n","import {\n  useEffect,\n  useRef,\n  useMemo,\n  forwardRef\n} from 'react'\n\nimport {\n  useBody,\n  useSupportGeometry\n} from '../../physics'\n\nimport {\n  Matrix4,\n  Euler\n} from 'three'\n\nimport Model from './Model'\n\nconst SupportGeometry = forwardRef(({ support, ...rest }, ref) => {\n  const geometry = useSupportGeometry(support)\n  return (\n    <mesh\n      ref={ref}\n      geometry={geometry}\n      {...rest}\n    />\n  )\n})\n\nexport default function Brush ({\n  support,\n  position,\n  rotation,\n  scale,\n  kinematic,\n  userData,\n  color,\n  visible,\n  inEditor,\n  enableBody,\n  modelUrl,\n  ...rest\n}) {\n  /* Default values. */\n  position = position || [0.0, 0.0, 0.0]\n  rotation = rotation || [0.0, 0.0, 0.0]\n  scale = scale || [1.0, 1.0, 1.0]\n  visible = visible === undefined ? true : visible\n\n  const options = useMemo(() => ({\n    supports: [support],\n    isKinematic: kinematic\n  }), [support, kinematic])\n\n  const ref = useRef()\n  const api = useBody(ref, options, enableBody)\n\n  const [rx, ry, rz] = rotation\n  const [sx, sy, sz] = scale\n  const [x, y, z] = position\n  useEffect(() => {\n    api.transform.identity()\n    api.transform.multiply(\n      new Matrix4().makeRotationFromEuler(new Euler(\n        rx * Math.PI / 180,\n        ry * Math.PI / 180,\n        rz * Math.PI / 180))\n    )\n    api.transform.multiply(\n      new Matrix4().makeScale(sx, sy, sz)\n    )\n    api.transform.setPosition(x, y, z)\n    api.velocity.set(0, 0, 0)\n    api.update()\n  }, [api, x, y, z, rx, ry, rz, sx, sy, sz])\n\n  if (visible || inEditor) {\n    return (\n      <group\n        ref={ref}\n        position={position}\n        rotation={rotation}\n        scale={scale}\n      >\n        {modelUrl && (\n          <Model\n            support={support}\n            url={modelUrl}\n            {...rest}\n          />\n        )}\n        {(!modelUrl || inEditor) && (\n          <SupportGeometry\n            support={support}\n            {...rest}\n          >\n            <meshStandardMaterial\n              color={color}\n            />\n          </SupportGeometry>\n        )}\n      </group>\n    )\n  } else {\n    return null\n  }\n}\n","import {\n  useMemo\n} from 'react'\n\nimport {\n  sum,\n  split,\n  sphere,\n  circle\n} from 'tcollide'\n\nimport Brush from './Brush'\n\n/*\n * Like a brush, but with options for making it round.\n */\nexport default function RoundBrush ({\n  support,\n  roundRadius,\n  flatTop,\n  flatBottom,\n  ...rest\n}) {\n  const radius = roundRadius || 0.0\n\n  const roundSupport = useMemo(() => (\n    radius > 0\n      ? (\n          flatTop\n            ? (\n                flatBottom\n                  ? circle({ radius })\n                  : split(circle({ radius }), sphere({ radius }))\n              )\n            : (\n                flatBottom\n                  ? split(sphere({ radius }), circle({ radius }))\n                  : sphere({ radius })\n              )\n        )\n      : null\n  ), [radius, flatTop, flatBottom])\n\n  const newSupport = useMemo(() => (\n    radius > 0\n      ? sum(support, roundSupport)\n      : support\n  ), [support, roundSupport, radius])\n\n  return <Brush support={newSupport} {...rest} />\n}\n","import {\n  useMemo,\n  useState,\n  useEffect\n} from 'react'\n\n/* Material UI components. */\nimport Grid from '@material-ui/core/Grid'\nimport TextField from '@material-ui/core/TextField'\n\nimport {\n  Vector3\n} from 'three'\n\nexport default function Vector3Property ({\n  selection,\n  data,\n  onChange,\n  prop,\n  label,\n  defaultValue\n}) {\n  const origin = useMemo(() => {\n    const origin = new Vector3()\n    const pos = new Vector3()\n    data.objects.forEach(x => {\n      if (selection.has(x.id)) {\n        if (x.props[prop]) {\n          pos.set(...x.props[prop])\n        } else {\n          pos.set(...defaultValue)\n        }\n        origin.add(pos)\n      }\n    })\n    origin.multiplyScalar(1 / selection.size)\n    return [origin.x, origin.y, origin.z]\n  }, [selection, data, prop, defaultValue])\n\n  const [pos, setPos] = useState(defaultValue)\n  const [ox, oy, oz] = origin\n  useEffect(() => {\n    setPos([ox, oy, oz].map(v => Math.round(v * 1000) / 1000))\n  }, [ox, oy, oz])\n\n  const setComponent = (i, v) => {\n    const newPos = [...pos]\n    newPos[i] = v\n    setPos(newPos)\n  }\n\n  const handleBlur = () => {\n    if (pos.some(x => isNaN(x))) {\n      setPos(origin)\n      return\n    }\n    const newData = {\n      ...data,\n      objects: data.objects.map(object => {\n        if (selection.has(object.id)) {\n          const position = [...(object.props[prop] || defaultValue)]\n          for (let i = 0; i < position.length; i++) {\n            position[i] += pos[i] - origin[i]\n          }\n          return {\n            ...object,\n            props: {\n              ...object.props,\n              [prop]: position\n            }\n          }\n        } else {\n          return object\n        }\n      })\n    }\n    onChange(newData)\n  }\n\n  return (\n    <Grid container spacing={1}>\n      {['x', 'y', 'z'].map((x, i) => (\n        <Grid item key={x} xs={4}>\n          <TextField\n            label={(label ? label + ' ' : '') + x.toUpperCase()}\n            variant='filled'\n            value={pos[i]}\n            onChange={(e) => setComponent(i, e.target.value)}\n            onBlur={handleBlur}\n          />\n        </Grid>\n      ))}\n    </Grid>\n  )\n}\n","import Vector3Property from './Vector3Property'\n\nfunction Position ({\n  selection,\n  data,\n  onChange\n}) {\n  return (\n    <Vector3Property\n      prop='position'\n      selection={selection}\n      data={data}\n      onChange={onChange}\n      defaultValue={[0, 0, 0]}\n    />\n  )\n}\n\nconst position = {\n  key: 'position',\n  displayName: 'Position',\n  component: Position\n}\n\nexport default position\n","import Vector3Property from './Vector3Property'\n\nfunction Rotation ({\n  selection,\n  data,\n  onChange\n}) {\n  return (\n    <Vector3Property\n      prop='rotation'\n      selection={selection}\n      data={data}\n      onChange={onChange}\n      defaultValue={[0, 0, 0]}\n    />\n  )\n}\n\nconst rotation = {\n  key: 'rotation',\n  displayName: 'Rotation',\n  component: Rotation\n}\n\nexport default rotation\n","import Vector3Property from './Vector3Property'\n\nfunction Scale ({\n  selection,\n  data,\n  onChange\n}) {\n  return (\n    <Vector3Property\n      prop='scale'\n      selection={selection}\n      data={data}\n      onChange={onChange}\n      defaultValue={[1, 1, 1]}\n    />\n  )\n}\n\nconst scale = {\n  key: 'scale',\n  displayName: 'Scale',\n  component: Scale\n}\n\nexport default scale\n","import {\n  useMemo,\n  useState,\n  useEffect\n} from 'react'\n\n/* Material UI components. */\nimport Box from '@material-ui/core/Box'\nimport Checkbox from '@material-ui/core/Checkbox'\nimport FormControlLabel from '@material-ui/core/FormControlLabel'\n\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst useStyles = makeStyles((theme) => ({\n  evenlySpaced: {\n    '& > *': {\n      margin: theme.spacing(1)\n    }\n  }\n}))\n\nexport default function BooleanProperty ({\n  selection,\n  data,\n  onChange,\n  prop,\n  defaultValue,\n  label\n}) {\n  const classes = useStyles()\n\n  const origin = useMemo(() => {\n    let origin = defaultValue\n    data.objects.forEach(x => {\n      if (selection.has(x.id)) {\n        if (x.props[prop] !== undefined) {\n          origin = x.props[prop]\n        }\n      }\n    })\n    return origin\n  }, [selection, data, prop, defaultValue])\n\n  const [value, setValue] = useState(defaultValue)\n  useEffect(() => {\n    setValue(origin)\n  }, [origin])\n\n  const handleChange = (e) => {\n    const value = e.target.checked\n    setValue(value)\n\n    const newData = {\n      ...data,\n      objects: data.objects.map(object => {\n        if (selection.has(object.id)) {\n          return {\n            ...object,\n            props: {\n              ...object.props,\n              [prop]: value\n            }\n          }\n        } else {\n          return object\n        }\n      })\n    }\n    onChange(newData)\n  }\n\n  return (\n    <Box className={classes.evenlySpaced}>\n      <FormControlLabel\n        control={\n          <Checkbox\n            variant='filled'\n            checked={value}\n            onChange={handleChange}\n          />\n        }\n        label={label}\n      />\n    </Box>\n  )\n}\n","import Box from '@material-ui/core/Box'\n\nimport BooleanProperty from './BooleanProperty'\n\nfunction Body ({\n  selection,\n  data,\n  onChange\n}) {\n  return (\n    <Box>\n      <BooleanProperty\n        prop='kinematic'\n        selection={selection}\n        data={data}\n        onChange={onChange}\n        label='Kinematic'\n        defaultValue\n      />\n      <BooleanProperty\n        prop='enableBody'\n        selection={selection}\n        data={data}\n        onChange={onChange}\n        label='Enable'\n        defaultValue\n      />\n    </Box>\n  )\n}\n\nconst body = {\n  key: 'body',\n  displayName: 'Body',\n  component: Body\n}\n\nexport default body\n","\nimport {\n  useMemo,\n  useState,\n  useEffect\n} from 'react'\n\nexport default function ColorProperty ({\n  selection,\n  data,\n  onChange,\n  prop,\n  defaultValue\n}) {\n  const origin = useMemo(() => {\n    let origin = defaultValue\n    data.objects.forEach(x => {\n      if (selection.has(x.id)) {\n        if (x.props[prop] !== undefined) {\n          origin = x.props[prop]\n        }\n      }\n    })\n    return origin\n  }, [selection, data, prop, defaultValue])\n\n  const [value, setValue] = useState(defaultValue)\n  useEffect(() => {\n    setValue(origin)\n  }, [origin])\n\n  const handleChange = (e) => {\n    const value = e.target.value\n    setValue(value)\n\n    const newData = {\n      ...data,\n      objects: data.objects.map(object => {\n        if (selection.has(object.id)) {\n          return {\n            ...object,\n            props: {\n              ...object.props,\n              [prop]: value\n            }\n          }\n        } else {\n          return object\n        }\n      })\n    }\n    onChange(newData)\n  }\n\n  return (\n    <input type='color' value={value} onChange={handleChange} />\n  )\n}\n","import ColorProperty from './ColorProperty'\n\nfunction Color ({\n  selection,\n  data,\n  onChange\n}) {\n  return (\n    <ColorProperty\n      prop='color'\n      selection={selection}\n      data={data}\n      onChange={onChange}\n      defaultValue='#ffffff'\n    />\n  )\n}\n\nconst color = {\n  key: 'color',\n  displayName: 'Color',\n  component: Color\n}\n\nexport default color\n","import {\n  useMemo,\n  useState,\n  useEffect\n} from 'react'\n\n/* Material UI components. */\nimport Box from '@material-ui/core/Box'\nimport TextField from '@material-ui/core/TextField'\n\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst useStyles = makeStyles((theme) => ({\n  evenlySpaced: {\n    '& > *': {\n      margin: theme.spacing(1)\n    }\n  }\n}))\n\nexport default function NumberProperty ({\n  selection,\n  data,\n  onChange,\n  prop,\n  defaultValue,\n  label\n}) {\n  const classes = useStyles()\n\n  const origin = useMemo(() => {\n    let origin = 0\n    data.objects.forEach(x => {\n      if (selection.has(x.id)) {\n        if (x.props[prop] !== undefined) {\n          origin += x.props[prop]\n        } else {\n          origin += defaultValue\n        }\n      }\n    })\n    origin *= 1 / selection.size\n    return origin\n  }, [selection, data, prop, defaultValue])\n\n  const [pos, setPos] = useState(defaultValue)\n  useEffect(() => {\n    setPos(Math.round(origin * 1000) / 1000)\n  }, [origin])\n\n  const handleBlur = () => {\n    if (isNaN(pos)) {\n      setPos(origin)\n      return\n    }\n    const newData = {\n      ...data,\n      objects: data.objects.map(object => {\n        if (selection.has(object.id)) {\n          let position = (\n            object.props[prop] !== undefined\n              ? object.props[prop]\n              : defaultValue\n          )\n          position += pos - origin\n          return {\n            ...object,\n            props: {\n              ...object.props,\n              [prop]: position\n            }\n          }\n        } else {\n          return object\n        }\n      })\n    }\n    onChange(newData)\n  }\n\n  return (\n    <Box className={classes.evenlySpaced}>\n      <TextField\n        fullWidth\n        label={label}\n        variant='filled'\n        value={pos}\n        onChange={(e) => setPos(e.target.value)}\n        onBlur={handleBlur}\n      />\n    </Box>\n  )\n}\n","import Box from '@material-ui/core/Box'\n\nimport NumberProperty from './NumberProperty'\nimport BooleanProperty from './BooleanProperty'\n\nfunction RoundBrush ({\n  selection,\n  data,\n  onChange\n}) {\n  return (\n    <Box>\n      <NumberProperty\n        prop='roundRadius'\n        selection={selection}\n        data={data}\n        onChange={onChange}\n        defaultValue={0.0}\n        label='Round radius'\n      />\n      <BooleanProperty\n        prop='flatTop'\n        selection={selection}\n        data={data}\n        onChange={onChange}\n        defaultValue={false}\n        label='Flat top'\n      />\n      <BooleanProperty\n        prop='flatBottom'\n        selection={selection}\n        data={data}\n        onChange={onChange}\n        defaultValue={false}\n        label='Flat bottom'\n      />\n    </Box>\n  )\n}\n\nconst roundBrush = {\n  key: 'roundBrush',\n  displayName: 'Round brush',\n  component: RoundBrush\n}\n\nexport default roundBrush\n","import BooleanProperty from './BooleanProperty'\n\nfunction Visibility ({\n  selection,\n  data,\n  onChange\n}) {\n  return (\n    <BooleanProperty\n      prop='visible'\n      selection={selection}\n      data={data}\n      onChange={onChange}\n      label='Visible'\n      defaultValue\n    />\n  )\n}\n\nconst visibility = {\n  key: 'visibility',\n  displayName: 'Visibility',\n  component: Visibility\n}\n\nexport default visibility\n","import {\n  useMemo,\n  useState,\n  useEffect\n} from 'react'\n\nimport { getBaseUrl } from '../../utils'\n\n/* Material UI components. */\nimport Box from '@material-ui/core/Box'\nimport TextField from '@material-ui/core/TextField'\n\nimport { makeStyles } from '@material-ui/core/styles'\n\nconst useStyles = makeStyles((theme) => ({\n  evenlySpaced: {\n    '& > *': {\n      margin: theme.spacing(1)\n    }\n  }\n}))\n\nfunction isValidUrl (string) {\n  try {\n    /* eslint-disable-next-line no-new */\n    new URL(string, getBaseUrl())\n    return true\n  } catch (_) {\n    return false\n  }\n}\n\nexport default function UrlProperty ({\n  selection,\n  data,\n  onChange,\n  prop,\n  defaultValue,\n  label\n}) {\n  const classes = useStyles()\n\n  const origin = useMemo(() => (\n    data.objects.find(x => selection.has(x.id)).props[prop] ||\n    defaultValue ||\n    ''\n  ), [selection, data, prop, defaultValue])\n\n  const [value, setValue] = useState(defaultValue)\n  useEffect(() => {\n    setValue(origin)\n  }, [origin])\n\n  const handleBlur = () => {\n    if (!isValidUrl(value)) {\n      setValue(origin)\n      return\n    }\n    const newData = {\n      ...data,\n      objects: data.objects.map(object => {\n        if (selection.has(object.id)) {\n          return {\n            ...object,\n            props: {\n              ...object.props,\n              [prop]: value\n            }\n          }\n        } else {\n          return object\n        }\n      })\n    }\n    onChange(newData)\n  }\n\n  return (\n    <Box className={classes.evenlySpaced}>\n      <TextField\n        fullWidth\n        label={label}\n        variant='filled'\n        value={value}\n        onChange={(e) => setValue(e.target.value)}\n        onBlur={handleBlur}\n      />\n    </Box>\n  )\n}\n","import UrlProperty from './UrlProperty'\n\nfunction Model ({\n  selection,\n  data,\n  onChange\n}) {\n  return (\n    <UrlProperty\n      prop='modelUrl'\n      selection={selection}\n      data={data}\n      onChange={onChange}\n      defaultValue=''\n      label='URL'\n    />\n  )\n}\n\nconst model = {\n  key: 'model',\n  displayName: 'Model',\n  component: Model\n}\n\nexport default model\n","import position from './position'\nimport rotation from './rotation'\nimport scale from './scale'\nimport body from './body'\nimport color from './color'\nimport roundBrushInspector from './roundBrush'\nimport visibility from './visibility'\nimport model from './model'\n\nconst transform = [position, rotation, scale]\nconst brush = [position, rotation, scale, body, color, visibility, model]\nconst roundBrush = [...brush, roundBrushInspector]\nconst light = [position, color]\n\nexport { transform, brush, roundBrush, light }\n","import Vector3Property from './Vector3Property'\n\nfunction BoxSize ({\n  selection,\n  data,\n  onChange\n}) {\n  return (\n    <Vector3Property\n      prop='size'\n      selection={selection}\n      data={data}\n      onChange={onChange}\n      defaultValue={[1, 1, 1]}\n    />\n  )\n}\n\nconst boxSize = {\n  key: 'boxSize',\n  displayName: 'Size',\n  component: BoxSize\n}\n\nexport default boxSize\n","import {\n  useMemo\n} from 'react'\n\nimport {\n  box\n} from 'tcollide'\n\nimport RoundBrush from './RoundBrush'\n\nimport * as mixins from '../inspectors/mixins'\nimport boxSize from '../inspectors/boxSize'\n\nfunction Box ({ size, ...rest }) {\n  size = size || [1.0, 1.0, 1.0]\n  const [sizeX, sizeY, sizeZ] = size\n  const support = useMemo(() => (\n    box({ size: [sizeX, sizeY, sizeZ] })\n  ), [sizeX, sizeY, sizeZ])\n  return (\n    <RoundBrush support={support} {...rest} />\n  )\n}\n\nconst component = {\n  key: 'box',\n  displayName: 'Box',\n  inspectors: [...mixins.roundBrush, boxSize],\n  component: Box\n}\n\nexport default component\n","import NumberProperty from './NumberProperty'\n\nfunction SphereSize ({\n  selection,\n  data,\n  onChange\n}) {\n  return (\n    <NumberProperty\n      prop='radius'\n      selection={selection}\n      data={data}\n      onChange={onChange}\n      defaultValue={0.5}\n      label='Radius'\n    />\n  )\n}\n\nconst sphereSize = {\n  key: 'sphereSize',\n  displayName: 'Size',\n  component: SphereSize\n}\n\nexport default sphereSize\n","import {\n  useMemo\n} from 'react'\n\nimport {\n  sphere\n} from 'tcollide'\n\nimport Brush from './Brush'\n\nimport * as mixins from '../inspectors/mixins'\nimport sphereSize from '../inspectors/sphereSize'\n\nfunction Sphere ({ radius, ...rest }) {\n  radius = radius || 0.5\n  const support = useMemo(() => (\n    sphere({ radius })\n  ), [radius])\n  return (\n    <Brush support={support} {...rest} />\n  )\n}\n\nconst component = {\n  key: 'sphere',\n  displayName: 'Sphere',\n  inspectors: [...mixins.brush, sphereSize],\n  component: Sphere\n}\n\nexport default component\n","import Box from '@material-ui/core/Box'\nimport NumberProperty from './NumberProperty'\n\nfunction CylinderSize ({\n  selection,\n  data,\n  onChange\n}) {\n  return (\n    <Box>\n      <NumberProperty\n        prop='r1'\n        selection={selection}\n        data={data}\n        onChange={onChange}\n        defaultValue={0.5}\n        label='Radius 1'\n      />\n      <NumberProperty\n        prop='r2'\n        selection={selection}\n        data={data}\n        onChange={onChange}\n        defaultValue={0.5}\n        label='Radius 2'\n      />\n      <NumberProperty\n        prop='height'\n        selection={selection}\n        data={data}\n        onChange={onChange}\n        defaultValue={1.0}\n        label='Height'\n      />\n    </Box>\n  )\n}\n\nconst cylinderSize = {\n  key: 'cylinderSize',\n  displayName: 'Size',\n  component: CylinderSize\n}\n\nexport default cylinderSize\n","import {\n  useMemo\n} from 'react'\n\nimport {\n  hull,\n  circle\n} from 'tcollide'\n\nimport RoundBrush from './RoundBrush'\n\nimport * as mixins from '../inspectors/mixins'\nimport cylinderSize from '../inspectors/cylinderSize'\n\nfunction Cylinder ({ height, r1, r2, ...rest }) {\n  /* Default values. */\n  r1 = r1 || 0.5\n  r2 = r2 || 0.5\n  height = height || 1.0\n\n  const support = useMemo(() => (\n    hull(\n      circle({\n        position: [0, -height / 2, 0],\n        radius: r1\n      }),\n      circle({\n        position: [0, height / 2, 0],\n        radius: r2\n      })\n    )\n  ), [height, r1, r2])\n  return (\n    <RoundBrush support={support} {...rest} />\n  )\n}\n\nconst component = {\n  key: 'cylinder',\n  displayName: 'Cylinder',\n  inspectors: [...mixins.roundBrush, cylinderSize],\n  component: Cylinder\n}\n\nexport default component\n","import * as mixins from '../inspectors/mixins'\n\nconst component = {\n  key: 'pointLight',\n  displayName: 'Point Light',\n  inspectors: [...mixins.light],\n  component ({ position, color, inEditor, ...rest }) {\n    color = color || '#ffffff'\n    position = position || [0, 0, 0]\n    return (\n      <group position={position}>\n        {inEditor && (\n          <mesh>\n            <meshBasicMaterial color={color} />\n            <sphereGeometry args={[0.25, 16, 8]} />\n          </mesh>\n        )}\n        <pointLight color={color} {...rest} />\n      </group>\n    )\n  }\n}\n\nexport default component\n","import * as mixins from '../inspectors/mixins'\n\nconst component = {\n  key: 'ambientLight',\n  displayName: 'Ambient Light',\n  inspectors: [...mixins.light],\n  component ({ position, color, inEditor, ...rest }) {\n    color = color || '#ffffff'\n    position = position || [0, 0, 0]\n    return (\n      <group position={position}>\n        {inEditor && (\n          <mesh>\n            <meshBasicMaterial color={color} />\n            <sphereGeometry args={[0.25, 16, 8]} />\n          </mesh>\n        )}\n        <ambientLight color={color} {...rest} />\n      </group>\n    )\n  }\n}\n\nexport default component\n","import * as mixins from '../inspectors/mixins'\n\nconst component = {\n  key: 'directionalLight',\n  displayName: 'Directional Light',\n  inspectors: [...mixins.light],\n  component ({ position, color, inEditor, ...rest }) {\n    color = color || '#ffffff'\n    position = position || [0, 0, 0]\n    return (\n      <group position={position}>\n        {inEditor && (\n          <mesh>\n            <meshBasicMaterial color={color} />\n            <sphereGeometry args={[0.25, 16, 8]} />\n          </mesh>\n        )}\n        <directionalLight color={color} {...rest} />\n      </group>\n    )\n  }\n}\n\nexport default component\n","import {\n  useMemo,\n  useState,\n  useEffect\n} from 'react'\n\n/* Material UI components. */\nimport Grid from '@material-ui/core/Grid'\nimport TextField from '@material-ui/core/TextField'\n\nimport {\n  Vector2\n} from 'three'\n\nexport default function Vector2Property ({\n  selection,\n  data,\n  onChange,\n  prop,\n  label,\n  defaultValue\n}) {\n  const origin = useMemo(() => {\n    const origin = new Vector2()\n    const pos = new Vector2()\n    data.objects.forEach(x => {\n      if (selection.has(x.id)) {\n        if (x.props[prop]) {\n          pos.set(...x.props[prop])\n        } else {\n          pos.set(...defaultValue)\n        }\n        origin.add(pos)\n      }\n    })\n    origin.multiplyScalar(1 / selection.size)\n    return [origin.x, origin.y]\n  }, [selection, data, prop, defaultValue])\n\n  const [pos, setPos] = useState(defaultValue)\n  const [ox, oy] = origin\n  useEffect(() => {\n    setPos([ox, oy].map(v => Math.round(v * 1000) / 1000))\n  }, [ox, oy])\n\n  const setComponent = (i, v) => {\n    const newPos = [...pos]\n    newPos[i] = v\n    setPos(newPos)\n  }\n\n  const handleBlur = () => {\n    if (pos.some(x => isNaN(x))) {\n      setPos(origin)\n      return\n    }\n    const newData = {\n      ...data,\n      objects: data.objects.map(object => {\n        if (selection.has(object.id)) {\n          const position = [...(object.props[prop] || defaultValue)]\n          for (let i = 0; i < position.length; i++) {\n            position[i] += pos[i] - origin[i]\n          }\n          return {\n            ...object,\n            props: {\n              ...object.props,\n              [prop]: position\n            }\n          }\n        } else {\n          return object\n        }\n      })\n    }\n    onChange(newData)\n  }\n\n  return (\n    <Grid container spacing={1}>\n      {['x', 'y'].map((x, i) => (\n        <Grid item key={x} xs={6}>\n          <TextField\n            label={(label ? label + ' ' : '') + x.toUpperCase()}\n            variant='filled'\n            value={pos[i]}\n            onChange={(e) => setComponent(i, e.target.value)}\n            onBlur={handleBlur}\n          />\n        </Grid>\n      ))}\n    </Grid>\n  )\n}\n","import {\n  useMemo\n} from 'react'\n\nimport {\n  box\n} from 'tcollide'\n\nimport Box from '@material-ui/core/Box'\n\nimport Brush from './Brush'\n\nimport * as mixins from '../inspectors/mixins'\nimport boxSize from '../inspectors/boxSize'\nimport Vector2Property from '../inspectors/Vector2Property'\n\nfunction makeWallSupports ({\n  thickness,\n  axisIndex,\n  side,\n  size,\n  doorSize\n}) {\n  if (doorSize.some(x => x <= 0) || axisIndex === 1) {\n    const sizeX = (\n      axisIndex === 0\n        ? thickness\n        : (size[0] - 2 * thickness)\n    )\n    const sizeY = (\n      axisIndex === 1\n        ? thickness\n        : (size[1])\n    )\n    const sizeZ = (\n      axisIndex === 2\n        ? thickness\n        : (\n            axisIndex === 0\n              ? size[2]\n              : size[2] - 2 * thickness\n          )\n    )\n    const position = [0, 0, 0]\n    position[axisIndex] = (size[axisIndex] - thickness) * side / 2\n    return [\n      box({\n        position,\n        size: [sizeX, sizeY, sizeZ]\n      })\n    ]\n  } else {\n    const sizeX = (\n      axisIndex === 0\n        ? thickness\n        : (size[0] - 2 * thickness)\n    )\n    const sizeY = (\n      axisIndex === 1\n        ? thickness\n        : (size[1])\n    )\n    const sizeZ = (\n      axisIndex === 2\n        ? thickness\n        : (\n            axisIndex === 0\n              ? size[2]\n              : size[2] - 2 * thickness\n          )\n    )\n    const wallSize = [sizeX, sizeY, sizeZ]\n    const topWallSize = [...wallSize]\n    const position = [0, 0, 0]\n    position[axisIndex] = (size[axisIndex] - thickness) * side / 2\n\n    /* Side wall positions. */\n    const position1 = [...position]\n    const position2 = [...position]\n    position1[2 - axisIndex] += (wallSize[2 - axisIndex] + doorSize[0]) / 4\n    position2[2 - axisIndex] -= (wallSize[2 - axisIndex] + doorSize[0]) / 4\n    wallSize[2 - axisIndex] = (wallSize[2 - axisIndex] - doorSize[0]) / 2\n\n    /* Top wall position. */\n    const position3 = [...position]\n    position3[1] += doorSize[1] / 2\n    topWallSize[1] -= doorSize[1]\n    topWallSize[2 - axisIndex] = doorSize[0]\n\n    if (wallSize.every(x => x > 0) && topWallSize.every(x => x > 0)) {\n      return [\n        box({\n          position: position1,\n          size: wallSize\n        }),\n        box({\n          position: position2,\n          size: wallSize\n        }),\n        box({\n          position: position3,\n          size: topWallSize\n        })\n      ]\n    } else {\n      return []\n    }\n  }\n}\n\nfunction Room ({\n  size,\n  thickness,\n  frontDoorSize,\n  leftDoorSize,\n  rightDoorSize,\n  backDoorSize,\n  ...rest\n}) {\n  thickness = thickness || 0.1\n  size = size || [1.0, 1.0, 1.0]\n  const [sizeX, sizeY, sizeZ] = size\n  const defaultDoorSize = useMemo(() => [0.5, 0.5], [])\n\n  const doorOptions = useMemo(() => (\n    [\n      [backDoorSize || defaultDoorSize, 2, -1],\n      [frontDoorSize || defaultDoorSize, 2, 1],\n      [[0, 0], 1, -1],\n      [[0, 0], 1, 1],\n      [leftDoorSize || defaultDoorSize, 0, -1],\n      [rightDoorSize || defaultDoorSize, 0, 1]\n    ]\n  ), [\n    frontDoorSize,\n    leftDoorSize,\n    rightDoorSize,\n    backDoorSize,\n    defaultDoorSize\n  ])\n\n  const supports = useMemo(() => (\n    doorOptions.flatMap(([doorSize, axisIndex, side]) =>\n      makeWallSupports({\n        thickness,\n        axisIndex,\n        size: [sizeX, sizeY, sizeZ],\n        side,\n        doorSize\n      })\n    )\n  ), [sizeX, sizeY, sizeZ, thickness, doorOptions])\n  return (\n    <>\n      {supports.map((support, i) => (\n        <Brush key={i} support={support} {...rest} />\n      ))}\n    </>\n  )\n}\n\nfunction Inspector ({\n  selection,\n  data,\n  onChange\n}) {\n  const defaultValue = [0.5, 0.5]\n  return (\n    <Box>\n      <Vector2Property\n        label='Left door size'\n        prop='leftDoorSize'\n        selection={selection}\n        data={data}\n        onChange={onChange}\n        defaultValue={defaultValue}\n      />\n      <Vector2Property\n        label='Right door size'\n        prop='rightDoorSize'\n        selection={selection}\n        data={data}\n        onChange={onChange}\n        defaultValue={defaultValue}\n      />\n      <Vector2Property\n        label='Front door size'\n        prop='frontDoorSize'\n        selection={selection}\n        data={data}\n        onChange={onChange}\n        defaultValue={defaultValue}\n      />\n      <Vector2Property\n        label='Back door size'\n        prop='backDoorSize'\n        selection={selection}\n        data={data}\n        onChange={onChange}\n        defaultValue={defaultValue}\n      />\n    </Box>\n  )\n}\n\nconst inspector = {\n  key: 'room',\n  displayName: 'Room',\n  component: Inspector\n}\n\nconst component = {\n  key: 'room',\n  displayName: 'Room',\n  inspectors: [...mixins.brush, boxSize, inspector],\n  component: Room\n}\n\nexport default component\n","import { useState, useEffect, useRef, useCallback } from 'react'\n\n/* Utils. */\nimport { makeArrowGeometry } from '../utils'\n\nconst arrowGeometry = makeArrowGeometry()\nexport function useArrowGeometry () {\n  return arrowGeometry\n}\n\nexport function useEventListener (type, callback) {\n  useEffect(() => {\n    document.addEventListener(type, callback)\n    return () => {\n      document.removeEventListener(type, callback)\n    }\n  }, [type, callback])\n}\n\nexport function useIsKeyDown () {\n  /* Handle keyboard. */\n  const keyIsDown = useRef({})\n\n  const handleKeyDown = useCallback((e) => {\n    keyIsDown.current[\n      e.key.length === 1\n        ? e.key.toUpperCase()\n        : e.key\n    ] = true\n  }, [])\n  useEventListener('keydown', handleKeyDown)\n\n  const handleKeyUp = useCallback((e) => {\n    keyIsDown.current[\n      e.key.length === 1\n        ? e.key.toUpperCase()\n        : e.key\n    ] = false\n  }, [])\n\n  useEventListener('keyup', handleKeyUp)\n  return keyIsDown\n}\n\nexport function useKeyboardShortcut (keys, callback) {\n  /* Handle keyboard. */\n  const keyIsDown = useRef({})\n\n  const handleKeyDown = useCallback((e) => {\n    keyIsDown.current[\n      e.key.length === 1\n        ? e.key.toUpperCase()\n        : e.key\n    ] = true\n\n    /* Call the callback if all the keys are down. */\n    if (e.target === document.body) {\n      if (\n        keys.every(x => keyIsDown.current[x]) &&\n        Object.keys(keyIsDown.current)\n          .filter(x => keyIsDown.current[x])\n          .every(x => keys.includes(x))\n      ) {\n        callback()\n      }\n    }\n  }, [keys, callback])\n  useEventListener('keydown', handleKeyDown)\n\n  const handleKeyUp = useCallback((e) => {\n    keyIsDown.current[\n      e.key.length === 1\n        ? e.key.toUpperCase()\n        : e.key\n    ] = false\n  }, [])\n  useEventListener('keyup', handleKeyUp)\n}\n\n/**\n * Creates a callback function that calls the given callback by reference. This\n * is useful when multiple components need to use the same callback, and you\n * don't want to trigger a rerender of all the components when the callback\n * changes. Returns the memoized callback.\n */\nexport const useRefCallback = (callback) => {\n  const ref = useRef(null)\n  const memoizedCallback = useCallback(\n    (...args) => ref.current(...args),\n    []\n  )\n\n  useEffect(() => {\n    ref.current = callback\n  }, [callback])\n\n  return memoizedCallback\n}\n\n/**\n * Creates undoable state. Returns an array of [present, pushState, undo, redo,\n * setState]. pushState pushes the given state onto the stack. setState allows\n * you to set the state without modifying the history.\n */\nexport const useUndoable = (initialState, max) => {\n  const [state, setState] = useState(initialState)\n  const [present, setPresent] = useState(initialState)\n  const [past, setPast] = useState([])\n  const [future, setFuture] = useState([])\n\n  const undo = useCallback(() => {\n    const canUndo = past.length > 0\n    if (canUndo) {\n      setFuture([present, ...future])\n      setPresent(past[0])\n      setState(past[0])\n      setPast(past.slice(1))\n    }\n  }, [present, past, future, setPresent, setPast, setFuture])\n\n  const redo = useCallback(() => {\n    const canRedo = future.length > 0\n    if (canRedo) {\n      setPast([present, ...past])\n      setPresent(future[0])\n      setState(future[0])\n      setFuture(future.slice(1))\n    }\n  }, [present, past, future, setPresent, setPast, setFuture])\n\n  const pushState = useCallback((state) => {\n    setPast([present, ...past].splice(-(max || 1000)))\n    setPresent(state)\n    setState(state)\n    setFuture([])\n  }, [present, past, setPresent, setPast, setFuture, max])\n\n  return [state, pushState, undo, redo, setState]\n}\n","import { useMemo } from 'react'\nimport { circle, hull } from 'tcollide'\nimport position from '../inspectors/position'\nimport rotation from '../inspectors/rotation'\nimport { useSupportGeometry } from '../../physics'\n\n/* Utils. */\nimport { useArrowGeometry } from '../../hooks'\n\nfunction PlayerSpawnPreview ({ color, position, rotation }) {\n  const arrowGeometry = useArrowGeometry()\n  const support = useMemo(() => (\n    hull(\n      circle({ position: [0, 0.25, 0], radius: 0.25 }),\n      circle({ position: [0, -1.25, 0], radius: 0.25 })\n    )\n  ), [])\n  const geometry = useSupportGeometry(support)\n  return (\n    <group position={position} rotation={rotation.map(x => x * Math.PI / 180)}>\n      <mesh geometry={geometry}>\n        <meshBasicMaterial color={color} />\n      </mesh>\n      <mesh geometry={arrowGeometry} rotation={[-Math.PI / 2, 0, 0]}>\n        <meshBasicMaterial color={color} />\n      </mesh>\n    </group>\n  )\n}\n\nfunction PlayerSpawn ({ position, rotation, inEditor, ...rest }) {\n  if (inEditor) {\n    position = position || [0, 0, 0]\n    rotation = rotation || [0, 0, 0]\n    return (\n      <PlayerSpawnPreview\n        position={position}\n        rotation={rotation}\n        color='#0000ff'\n      />\n    )\n  } else {\n    return null\n  }\n}\nconst component = {\n  key: 'playerSpawn',\n  displayName: 'Player Spawnpoint',\n  inspectors: [position, rotation],\n  component: PlayerSpawn\n}\n\nexport default component\n","import box from './box'\nimport sphere from './sphere'\nimport cylinder from './cylinder'\nimport pointLight from './pointLight'\nimport ambientLight from './ambientLight'\nimport directionalLight from './directionalLight'\nimport room from './room'\nimport playerSpawn from './playerSpawn'\n\nconst components = {\n  playerSpawn,\n  box,\n  sphere,\n  cylinder,\n  pointLight,\n  ambientLight,\n  directionalLight,\n  room\n}\nexport default components\n","import React, { useState } from 'react'\n\nimport ListItem from '@material-ui/core/ListItem'\nimport ListItemText from '@material-ui/core/ListItemText'\nimport ListItemIcon from '@material-ui/core/ListItemIcon'\nimport Collapse from '@material-ui/core/Collapse'\n\nimport ExpandLessIcon from '@material-ui/icons/ExpandLess'\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore'\n\n/**\n * A list item capable of being expanded or collapsed.\n */\nexport default function ListSection (props) {\n  const [isExpanded, setIsExpanded] = useState(true)\n  return (\n    <>\n      <ListItem button onClick={() => setIsExpanded(!isExpanded)}>\n        <ListItemIcon>\n          {\n            isExpanded\n              ? <ExpandLessIcon />\n              : <ExpandMoreIcon />\n          }\n        </ListItemIcon>\n        <ListItemText>{props.title}</ListItemText>\n      </ListItem>\n      <Collapse in={isExpanded}>\n        <ListItem>\n          {props.children}\n        </ListItem>\n      </Collapse>\n    </>\n  )\n}\n","/* Material UI components. */\nimport List from '@material-ui/core/List'\n\n/* Game components. */\nimport components from '../game/components'\n\n/* Editor components. */\nimport ListSection from './ListSection'\n\nexport default function Inspector ({ data, selection, onChange }) {\n  const selectedObjects = data.objects.filter(x => selection.has(x.id))\n  const selectedInspectors = selectedObjects.map(\n    x => components[x.type].inspectors\n  )\n  const objectInspectors = selectedObjects.length > 0\n    ? selectedInspectors.reduce((a, x) => x.filter(\n        inspector => a.includes(inspector))\n      )\n    : []\n  return (\n    <form noValidate>\n      <List>\n        {objectInspectors.map(inspector => {\n          const Component = inspector.component\n          return (\n            <ListSection key={inspector.key} title={inspector.displayName}>\n              <Component\n                data={data}\n                selection={selection}\n                onChange={onChange}\n              />\n            </ListSection>\n          )\n        })}\n      </List>\n    </form>\n  )\n}\n","/* React. */\nimport { useMemo } from 'react'\n\n/* Material UI components. */\nimport Button from '@material-ui/core/Button'\nimport Grid from '@material-ui/core/Grid'\nimport Tooltip from '@material-ui/core/Tooltip'\n\n/* react-three-fiber. */\nimport { Canvas } from 'react-three-fiber'\n\n/* Physics. */\nimport {\n  DisablePhysics\n} from '../physics'\n\n/* Game components. */\nimport components from '../game/components'\n\nfunction PaletteItem ({ onClick, text, component, distance }) {\n  const Component = component\n  const d = (1 / Math.sqrt(3)) * distance\n  return (\n    <Grid item xs={4}>\n      <Tooltip title={`Add ${text}`}>\n        <Button onClick={onClick}>\n          <div\n            style={{\n              position: 'relative',\n              width: '1.0in',\n              height: '1.0in',\n              overflow: 'hidden'\n            }}\n          >\n            <Canvas\n              camera={{ position: [d, d, d] }}\n              invalidateFrameloop\n            >\n              <DisablePhysics>\n                <directionalLight position={[1, 3, 2]} />\n                <ambientLight />\n                <Component inEditor />\n              </DisablePhysics>\n            </Canvas>\n          </div>\n        </Button>\n      </Tooltip>\n    </Grid>\n  )\n}\n\nexport default function Palette ({ onSelect }) {\n  const paletteItems = useMemo(() => {\n    const ret = []\n    for (const type in components) {\n      ret.push(\n        <PaletteItem\n          key={type}\n          onClick={() => onSelect(type)}\n          text={components[type].displayName}\n          component={components[type].component}\n          distance={components[type].distance || 2}\n        />\n      )\n    }\n    return ret\n  }, [onSelect])\n  return (\n    <Grid container>\n      {paletteItems}\n    </Grid>\n  )\n}\n","/* Material UI components. */\nimport Fade from '@material-ui/core/Fade'\nimport Box from '@material-ui/core/Box'\n\nexport default function TabPanel (props) {\n  const { children, value, index, ...other } = props\n\n  return (\n    <Fade\n      in={value === index}\n      style={{\n        display: value === index ? 'block' : 'none'\n      }}\n    >\n      <div\n        role='tabpanel'\n        {...other}\n      >\n        <Box>\n          {children}\n        </Box>\n      </div>\n    </Fade>\n  )\n}\n","/* React. */\nimport {\n  useCallback,\n  useState,\n  useRef,\n  useMemo,\n  useEffect\n} from 'react'\n\n/* react-three-fiber. */\nimport { useThree, useFrame } from 'react-three-fiber'\n\n/* three.js */\nimport {\n  Vector3,\n  Scene\n} from 'three'\n\nimport { useArrowGeometry } from '../hooks'\n\n/*\n * An arrow in a single direction.\n */\nfunction TranslateArrow ({\n  onBeginDrag,\n  onEndDrag,\n  onDrag,\n  color,\n  direction,\n  ...rest\n}) {\n  const arrowGeometry = useArrowGeometry()\n  const [isHovering, setIsHovering] = useState()\n\n  const [dx, dy, dz] = direction\n  const rotation = [\n    Math.atan2(Math.sqrt(dx ** 2 + dz ** 2), dy),\n    0,\n    Math.atan2(-dx, dz)\n  ]\n  const handlePointerOver = useCallback((...args) => {\n    setIsHovering(true)\n  }, [setIsHovering])\n  const handlePointerLeave = useCallback((...args) => {\n    setIsHovering(false)\n  }, [setIsHovering])\n  const totalAmount = useRef(new Vector3())\n\n  const ref = useRef()\n\n  /* Dragging. */\n  const [isDragging, setIsDragging] = useState(false)\n  const handlePointerDown = useCallback((e) => {\n    e.stopPropagation()\n    e.target.setPointerCapture(e.pointerId)\n    setIsDragging(true)\n    totalAmount.current.set(0, 0, 0)\n    if (onBeginDrag) {\n      onBeginDrag()\n    }\n  }, [setIsDragging, onBeginDrag])\n\n  const handlePointerUp = useCallback((e) => {\n    e.stopPropagation()\n    e.target.releasePointerCapture(e.pointerId)\n    setIsDragging(false)\n    if (onEndDrag) {\n      onEndDrag(totalAmount.current.clone())\n    }\n  }, [setIsDragging, onEndDrag])\n\n  /* Calculating direction. */\n  const { camera, size } = useThree()\n\n  const handlePointerMove = useCallback((e) => {\n    const b = new Vector3()\n    const v = new Vector3(dx, dy, dz)\n    if (isDragging) {\n      ref.current.getWorldPosition(b)\n\n      v.add(b)\n      v.project(camera)\n      b.project(camera)\n\n      v.sub(b)\n      const len = Math.sqrt(v.x ** 2 + v.y ** 2)\n      v.multiplyScalar(1 / len)\n      const dot = (\n        2 * v.x * e.movementX / size.width -\n        2 * v.y * e.movementY / size.height\n      )\n\n      v.multiplyScalar(dot)\n      v.add(b)\n      v.unproject(camera)\n      b.unproject(camera)\n      v.sub(b)\n\n      if (onDrag) {\n        totalAmount.current.add(v)\n        onDrag(v)\n      }\n    }\n  }, [isDragging, onDrag, camera, dx, dy, dz, size])\n\n  return (\n    <mesh\n      geometry={arrowGeometry}\n      onPointerDown={handlePointerDown}\n      onPointerUp={handlePointerUp}\n      onPointerMove={handlePointerMove}\n      onPointerOver={handlePointerOver}\n      onPointerLeave={handlePointerLeave}\n      rotation={rotation}\n      ref={ref}\n      renderOrder={1000}\n      {...rest}\n    >\n      <meshBasicMaterial\n        color={(isHovering || isDragging) ? '#ffbb22' : color}\n      />\n    </mesh>\n  )\n}\n\nexport default function TranslateArrows ({\n  position,\n  onDrag,\n  onBeginDrag,\n  onEndDrag\n}) {\n  const ref = useRef()\n\n  /* Callbacks. */\n  const handleBeginDrag = useCallback(() => {\n    if (onBeginDrag) {\n      onBeginDrag()\n    }\n  }, [onBeginDrag])\n\n  const handleEndDrag = useCallback((amount) => {\n    if (onEndDrag) {\n      onEndDrag(amount)\n    }\n  }, [onEndDrag])\n\n  const handleDrag = useCallback((v) => {\n    if (onDrag) {\n      onDrag(v)\n    }\n  }, [onDrag])\n\n  const { camera, gl, scene } = useThree()\n\n  /*\n   * Add the arrows to its own scene so that they can be rendered on top of the\n   * editor.\n   */\n  const arrowScene = useMemo(() => new Scene(), [])\n  useEffect(() => {\n    arrowScene.clear()\n    arrowScene.add(ref.current)\n  }, [scene, ref, arrowScene])\n\n  /* Scale so that the arrows have a constant size on the screen. */\n  const worldPos = new Vector3()\n  useFrame(() => {\n    ref.current.getWorldPosition(worldPos)\n    worldPos.applyMatrix4(camera.matrixWorldInverse)\n    const scale = -0.1 * worldPos.z\n    ref.current.scale.set(scale, scale, scale)\n\n    /* Render the arrows on top of the scene. */\n    gl.clearDepth()\n    gl.render(arrowScene, camera)\n  }, 2)\n\n  const directions = [\n    [[1, 0, 0], '#ff0000'],\n    [[0, 1, 0], '#00ff00'],\n    [[0, 0, 1], '#0000ff']\n  ]\n\n  return (\n    <group ref={ref} position={position}>\n      {directions.map(([direction, color], i) => (\n        <TranslateArrow\n          key={i}\n          direction={direction}\n          color={color}\n          onDrag={handleDrag}\n          onBeginDrag={handleBeginDrag}\n          onEndDrag={handleEndDrag}\n        />\n      ))}\n    </group>\n  )\n}\n","import { useRef, useCallback, useEffect, forwardRef } from 'react'\nimport { useThree, useFrame } from 'react-three-fiber'\nimport { useEventListener, useIsKeyDown } from '../hooks'\nimport { Vector3 } from 'three'\n\nexport default forwardRef(({\n  position,\n  mode,\n  ...rest\n}, ref) => {\n  const rotationHelper = useRef()\n  const { setDefaultCamera } = useThree()\n  const speed = 3\n\n  /* Handle mouselook. */\n  const handleMouseMove = useCallback((e) => {\n    if (mode === 'fps') {\n      ref.current.rotation.x -= e.movementY * 0.0025\n      rotationHelper.current.rotation.y -= e.movementX * 0.0025\n    }\n  }, [mode, ref])\n  useEventListener('mousemove', handleMouseMove)\n\n  const keyIsDown = useIsKeyDown()\n\n  useEffect(() => {\n    setDefaultCamera(ref.current)\n  }, [setDefaultCamera, ref])\n\n  const [x, y, z] = position\n  useEffect(() => {\n    rotationHelper.current.position.set(x, y, z)\n  }, [x, y, z])\n\n  const right = new Vector3()\n  const up = new Vector3()\n  const forward = new Vector3()\n\n  useFrame((state, dt) => {\n    /* Update the camera. */\n    ref.current.updateMatrixWorld()\n    if (mode === 'fps') {\n      const totalSpeed = speed * (keyIsDown.current.Shift ? 4 : 1)\n      const position = rotationHelper.current.position\n      ref.current.matrixWorld.extractBasis(right, up, forward)\n      forward.negate()\n      if (keyIsDown.current.E) {\n        position.addScaledVector(up, dt * totalSpeed)\n      }\n      if (keyIsDown.current.Q) {\n        position.addScaledVector(up, -dt * totalSpeed)\n      }\n      if (keyIsDown.current.D) {\n        position.addScaledVector(right, dt * totalSpeed)\n      }\n      if (keyIsDown.current.A) {\n        position.addScaledVector(right, -dt * totalSpeed)\n      }\n      if (keyIsDown.current.W) {\n        position.addScaledVector(forward, dt * totalSpeed)\n      }\n      if (keyIsDown.current.S) {\n        position.addScaledVector(forward, -dt * totalSpeed)\n      }\n    }\n  })\n\n  return (\n    <group ref={rotationHelper}>\n      <perspectiveCamera ref={ref} fov={75.0} />\n    </group>\n  )\n})\n","/* React. */\nimport {\n  useMemo\n} from 'react'\n\n/* react-three-fiber. */\nimport { useFrame } from 'react-three-fiber'\n\n/* three.js */\nimport {\n  MeshMatcapMaterial,\n  CustomBlending,\n  OneFactor,\n  DstAlphaFactor,\n  Color,\n  TextureLoader\n} from 'three'\n\n/* Material UI. */\nimport { useTheme } from '@material-ui/core/styles'\n\nfunction makeSelectionMaterial (color) {\n  const mat = new MeshMatcapMaterial({\n    blending: CustomBlending,\n    blendSrc: OneFactor,\n    blendDst: DstAlphaFactor,\n    color: new Color().set(color),\n    transparent: true\n  })\n  const textureLoader = new TextureLoader()\n  textureLoader.load('/textures/matcap.png', (texture) => {\n    mat.matcap = texture\n    mat.matcap = texture\n  })\n  return mat\n}\n\nfunction useSelectionMaterial () {\n  const theme = useTheme()\n  return useMemo(() => makeSelectionMaterial(\n    theme.palette.secondary.main\n  ), [theme])\n}\n\nexport default function SelectionRenderer ({ selection }) {\n  const selectionMaterial = useSelectionMaterial()\n\n  useFrame(({ gl, scene, camera }) => {\n    gl.clear()\n    gl.render(scene, camera)\n    if (selection.size > 0) {\n      const originalVisibles = scene.children.map(x => x.visible)\n      scene.children.forEach(x => {\n        x.visible = selection.has(x.userData.id)\n      })\n      scene.overrideMaterial = selectionMaterial\n      gl.render(scene, camera)\n      scene.children.forEach((x, i) => {\n        x.visible = originalVisibles[i]\n      })\n      scene.overrideMaterial = null\n    }\n    gl.autoClear = false\n  }, 1)\n  return null\n}\n","/* React. */\nimport {\n  useCallback,\n  useState,\n  useMemo\n} from 'react'\n\n/* react-three-fiber. */\nimport { Canvas } from 'react-three-fiber'\n\n/* three.js */\nimport {\n  Vector3\n} from 'three'\n\n/* Editor components. */\nimport TranslateArrows from './TranslateArrows'\nimport Camera from './Camera'\nimport SelectionRenderer from './SelectionRenderer'\n\n/* Physics. */\nimport {\n  PhysicsScene\n} from '../physics'\n\n/* Game components. */\nimport components from '../game/components'\n\n/* Utils. */\nimport { useEventListener } from '../hooks'\n\nexport default function ThreeView ({\n  data,\n  selection,\n  onSelectionChange,\n  onChange,\n  onEdit,\n  cameraRef\n}) {\n  const [cameraMode, setCameraMode] = useState()\n\n  /* Camera controls. */\n  const handleMouseDown = (e) => {\n    if (e.buttons === 2) {\n      setCameraMode('fps')\n    }\n  }\n\n  const handleMouseUp = (e) => {\n    setCameraMode()\n  }\n  useEventListener('mouseup', handleMouseUp)\n\n  const handleContextMenu = (e) => {\n    e.preventDefault()\n  }\n\n  /* Selection. */\n  const handleObjectSelected = useCallback((id) => {\n    const newSelection = new Set(selection)\n    if (newSelection.has(id)) {\n      newSelection.delete(id)\n    } else {\n      newSelection.add(id)\n    }\n    onSelectionChange(newSelection)\n  }, [selection, onSelectionChange])\n\n  const handlePointerMissed = useCallback(() => {\n    onSelectionChange(new Set())\n  }, [onSelectionChange])\n\n  /* Movement. */\n  const moveSelection = useCallback((amount) => {\n    const newData = {\n      ...data,\n      objects: data.objects.map(x => {\n        if (selection.has(x.id)) {\n          /* If the object is selected, modify it. */\n          const position = (\n            x.props.position\n              ? [\n                  x.props.position[0] + amount.x,\n                  x.props.position[1] + amount.y,\n                  x.props.position[2] + amount.z\n                ]\n              : [amount.x, amount.y, amount.z]\n          )\n\n          /* Clone the object. */\n          return {\n            ...x,\n            props: {\n              ...x.props,\n              position\n            }\n          }\n        } else {\n          /* Otherwise just return the object. */\n          return x\n        }\n      })\n    }\n    return newData\n  }, [data, selection])\n\n  /* Dragging. */\n  const [isDragging, setIsDragging] = useState(false)\n  const handleBeginDrag = useCallback(() => {\n    setIsDragging(true)\n  }, [setIsDragging])\n\n  const handleDrag = useCallback((amount) => {\n    onChange(moveSelection(amount))\n  }, [moveSelection, onChange])\n\n  const handleEndDrag = useCallback(() => {\n    onEdit(data)\n    setIsDragging(false)\n  }, [data, onEdit, setIsDragging])\n\n  const origin = useMemo(() => {\n    const origin = new Vector3(0, 0, 0)\n    const pos = new Vector3()\n    data.objects.forEach(x => {\n      if (selection.has(x.id)) {\n        if (x.props.position) {\n          pos.set(...x.props.position)\n        } else {\n          pos.set(0, 0, 0)\n        }\n        origin.add(pos)\n      }\n    })\n    origin.multiplyScalar(1 / selection.size)\n    return origin\n  }, [data, selection])\n\n  /* Keyboard shortcuts. */\n  useEventListener('keyup', (e) => {\n    /* Handle delete. */\n    if (e.key === 'Delete') {\n      if (e.target === document.body) {\n        onChange({\n          ...data,\n          objects: data.objects.filter(x => !selection.has(x.id))\n        })\n        onSelectionChange(new Set())\n      }\n    }\n  })\n\n  /* Create the components in the scene. */\n  const gameComponents = data.objects.map((x, i) => {\n    const Component = components[x.type].component\n    return (\n      <group\n        key={x.id}\n        userData={x}\n        onPointerUp={(e) => {\n          e.stopPropagation()\n          if (!isDragging && cameraMode !== 'fps') {\n            handleObjectSelected(x.id)\n          }\n        }}\n      >\n        <Component\n          {...x.props}\n          inEditor\n        />\n      </group>\n    )\n  })\n\n  return (\n    <Canvas\n      onMouseDown={handleMouseDown}\n      onContextMenu={handleContextMenu}\n      onPointerMissed={handlePointerMissed}\n    >\n      <PhysicsScene>\n        <Camera\n          position={[0, 0, 2]}\n          mode={cameraMode}\n          ref={cameraRef}\n        />\n        {gameComponents}\n        <TranslateArrows\n          onDrag={handleDrag}\n          onBeginDrag={handleBeginDrag}\n          onEndDrag={handleEndDrag}\n          position={[origin.x, origin.y, origin.z]}\n        />\n      </PhysicsScene>\n      <SelectionRenderer selection={selection} />\n    </Canvas>\n  )\n}\n","import { v4 as uuid } from 'uuid'\nimport { sphere, circle, hull } from 'tcollide'\nimport { useThree, useFrame } from 'react-three-fiber'\nimport { useCallback, useEffect, useRef, useMemo, useState } from 'react'\nimport { useBody, useContacts } from '../physics'\nimport { useEventListener, useIsKeyDown } from '../hooks'\nimport { Vector3 } from 'three'\n\nfunction Snowball ({ position, direction, speed }) {\n  const ref = useRef()\n  const options = useMemo(() => ({\n    supports: [\n      sphere({ radius: 0.25 })\n    ]\n  }), [])\n  const api = useBody(ref, options)\n\n  const [x, y, z] = position\n  const [dx, dy, dz] = direction\n\n  useEffect(() => {\n    api.transform.setPosition(x + dx, y + dy, z + dz)\n    api.update()\n  }, [api, x, y, z, dx, dy, dz])\n\n  useEffect(() => {\n    api.velocity.set(dx * speed, dy * speed, dz * speed)\n    api.update()\n  }, [api, dx, dy, dz, speed])\n\n  return (\n    <mesh ref={ref} position={position}>\n      <sphereGeometry args={[0.25, 16, 8]} />\n      <meshStandardMaterial color='white' />\n    </mesh>\n  )\n}\n\nexport default function Player ({ position, rotation, ...rest }) {\n  position = position || [0, 0, 0]\n  rotation = rotation || [0, 0, 0]\n\n  const camera = useRef()\n  const rotationHelper = useRef()\n  const { setDefaultCamera } = useThree()\n  const speed = 5\n  const jumpSpeed = 3\n\n  const ref = useRef()\n  const options = useMemo(() => ({\n    supports: [\n      hull(\n        circle({ position: [0, 0.25, 0], radius: 0.25 }),\n        circle({ position: [0, -1.25, 0], radius: 0.25 })\n      )\n    ]\n  }), [])\n  const api = useBody(ref, options)\n  const [bullets, setSnowballs] = useState([])\n\n  const [x, y, z] = position\n  useEffect(() => {\n    api.transform.setPosition(x, y, z)\n    api.update()\n  }, [api, x, y, z])\n\n  const [rx, ry, rz] = rotation\n  useEffect(() => {\n    rotationHelper.current.rotation.y = ry * Math.PI / 180\n  }, [rx, ry, rz])\n\n  const contacts = useContacts(api)\n\n  /* Handle mouselook. */\n  const handleMouseMove = useCallback((e) => {\n    if (camera.current) {\n      const rx = camera.current.rotation.x\n      camera.current.rotation.x = Math.min(\n        Math.max(\n          rx - e.movementY * 0.0025, -Math.PI / 2\n        ),\n        Math.PI / 2\n      )\n      rotationHelper.current.rotation.y -= e.movementX * 0.0025\n    }\n  }, [])\n  useEventListener('mousemove', handleMouseMove)\n\n  useEffect(() => {\n    setDefaultCamera(camera.current)\n  }, [setDefaultCamera])\n\n  const keyIsDown = useIsKeyDown()\n\n  const right = new Vector3()\n  const up = new Vector3()\n  const forward = new Vector3()\n  const cameraForward = new Vector3()\n\n  const handleMouseDown = () => {\n    setSnowballs([...bullets, {\n      key: uuid(),\n      position: [api.position.x, api.position.y, api.position.z],\n      direction: [cameraForward.x, cameraForward.y, cameraForward.z],\n      speed: 15\n    }].slice(-10))\n  }\n  useEventListener('mousedown', handleMouseDown)\n\n  useFrame((state, dt) => {\n    /* Update the camera. */\n    camera.current.updateMatrixWorld()\n    cameraForward.setFromMatrixColumn(camera.current.matrixWorld, 2)\n    cameraForward.negate()\n    rotationHelper.current.matrixWorld.extractBasis(right, up, forward)\n    forward.negate()\n    if (keyIsDown.current.E) {\n      api.position.addScaledVector(up, dt * speed)\n      api.transform.setPosition(api.position)\n      api.update()\n    }\n    if (keyIsDown.current.Q) {\n      api.position.addScaledVector(up, -dt * speed)\n      api.transform.setPosition(api.position)\n      api.update()\n    }\n    if (keyIsDown.current.D) {\n      api.position.addScaledVector(right, dt * speed)\n      api.transform.setPosition(api.position)\n      api.update()\n    }\n    if (keyIsDown.current.A) {\n      api.position.addScaledVector(right, -dt * speed)\n      api.transform.setPosition(api.position)\n      api.update()\n    }\n    if (keyIsDown.current.W) {\n      api.position.addScaledVector(forward, dt * speed)\n      api.transform.setPosition(api.position)\n      api.update()\n    }\n    if (keyIsDown.current.S) {\n      api.position.addScaledVector(forward, -dt * speed)\n      api.transform.setPosition(api.position)\n      api.update()\n    }\n    /* Jump. */\n    if (keyIsDown.current[' ']) {\n      if (\n        contacts.current.length > 0 &&\n        contacts.current.some(x => x.amount.y / x.amount.length() < -0.5)\n      ) {\n        api.velocity.set(0, jumpSpeed, 0)\n      }\n    }\n  })\n\n  return (\n    <>\n      <group ref={ref} {...rest}>\n        <group ref={rotationHelper}>\n          <perspectiveCamera ref={camera} fov={75} />\n        </group>\n      </group>\n      {bullets.map(({ key, ...props }) => (\n        <Snowball key={key} {...props} />\n      ))}\n    </>\n  )\n}\n","import { v4 as uuid } from 'uuid'\nimport { Canvas } from 'react-three-fiber'\nimport components from './components'\nimport {\n  PhysicsScene\n} from '../physics'\nimport Player from './Player'\n\nconst nextId = () => {\n  return uuid()\n}\n\n/**\n * Create an empty game scene.\n */\nexport function scene () {\n  return {\n    objects: []\n  }\n}\n\n/**\n * Create an object with the specified type and properties.\n */\nexport function object ({ type, props }) {\n  return {\n    type,\n    props,\n    id: nextId()\n  }\n}\n\nexport function Game ({ data }) {\n  const playerSpawn = data.objects.find(x => x.type === 'playerSpawn')\n  const playerPosition = playerSpawn.props.position\n  const playerRotation = playerSpawn.props.rotation\n\n  return (\n    <Canvas onClick={e => e.target.requestPointerLock()}>\n      <PhysicsScene>\n        {data.objects.map((x, i) => {\n          const Component = components[x.type].component\n          return (\n            <Component\n              key={x.id}\n              {...x.props}\n            />\n          )\n        })}\n        <Player position={playerPosition} rotation={playerRotation} />\n      </PhysicsScene>\n    </Canvas>\n  )\n}\n","/* React. */\nimport {\n  useRef,\n  useState\n} from 'react'\n\n/* three.js */\nimport {\n  Vector3\n} from 'three'\n\n/* Material UI components. */\nimport Button from '@material-ui/core/Button'\nimport CssBaseline from '@material-ui/core/CssBaseline'\nimport Drawer from '@material-ui/core/Drawer'\nimport Snackbar from '@material-ui/core/Snackbar'\nimport Tab from '@material-ui/core/Tab'\nimport Tabs from '@material-ui/core/Tabs'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport Tooltip from '@material-ui/core/Tooltip'\n\n/* Material UI icons. */\nimport PlayArrowIcon from '@material-ui/icons/PlayArrow'\nimport StopIcon from '@material-ui/icons/Stop'\nimport AddIcon from '@material-ui/icons/Add'\nimport CloudDownloadIcon from '@material-ui/icons/CloudDownload'\nimport CloudUploadIcon from '@material-ui/icons/CloudUpload'\n\nimport { makeStyles } from '@material-ui/core/styles'\n\n/* Editor components. */\nimport Inspector from './Inspector'\nimport Palette from './Palette'\nimport TabPanel from './TabPanel'\nimport ThreeView from './ThreeView'\n\n/* Game. */\nimport { Game, scene, object } from '../game'\nimport components from '../game/components'\n\n/* Hooks. */\nimport { useUndoable, useKeyboardShortcut } from '../hooks'\n\n/* Utils. */\nimport { download, upload } from '../utils'\n\nconst drawerWidth = 320\nconst useStyles = makeStyles(theme => ({\n  root: {\n    display: 'flex'\n  },\n  drawer: {\n    width: drawerWidth,\n    flexShrink: 0\n  },\n  drawerContent: {\n    width: drawerWidth,\n    overflowX: 'hidden'\n  },\n  content: {\n    flexGrow: 1,\n    position: 'absolute',\n    left: drawerWidth,\n    top: 0,\n    right: 0,\n    bottom: 0\n  }\n}))\n\nfunction EditorSidebar ({\n  data,\n  selection,\n  camera,\n  onChange,\n  onPlay,\n  onStop,\n  isPlaying\n}) {\n  const classes = useStyles()\n  const [tab, setTab] = useState(0)\n\n  const addObject = (type) => {\n    /* Calculate camera direction. */\n    const right = new Vector3()\n    const up = new Vector3()\n    const forward = new Vector3()\n    const cameraPosition = new Vector3()\n    camera.current.matrixWorld.extractBasis(right, up, forward)\n    camera.current.getWorldPosition(cameraPosition)\n    forward.negate()\n\n    /* Create the object in front of the camera. */\n    const distance = (components[type].distance || 2.0)\n    const position = [\n      cameraPosition.x + forward.x * distance,\n      cameraPosition.y + forward.y * distance,\n      cameraPosition.z + forward.z * distance\n    ]\n\n    onChange({\n      ...data,\n      objects: [\n        ...data.objects,\n        object({\n          type,\n          props: { kinematic: true, position }\n        })\n      ]\n    })\n  }\n\n  const handleDownload = () => {\n    download('scene.json', JSON.stringify(data))\n  }\n\n  const handleUpload = () => {\n    upload()\n      .then(data => JSON.parse(data))\n      .then(data => onChange(data))\n  }\n\n  const handleNew = () => {\n    onChange(scene({}))\n  }\n\n  return (\n    <Drawer variant='persistent' className={classes.drawer} open>\n      <div className={classes.drawerContent}>\n        <Toolbar>\n          <Tooltip title='New'>\n            <Button onClick={handleNew}>\n              <AddIcon />\n            </Button>\n          </Tooltip>\n          <Tooltip title='Upload'>\n            <Button onClick={handleUpload}>\n              <CloudUploadIcon />\n            </Button>\n          </Tooltip>\n          <Tooltip title='Download' onClick={handleDownload}>\n            <Button>\n              <CloudDownloadIcon />\n            </Button>\n          </Tooltip>\n          <Tooltip title={isPlaying ? 'Stop' : 'Play'}>\n            <Button onClick={isPlaying ? onStop : onPlay}>\n              {isPlaying\n                ? (<StopIcon />)\n                : (<PlayArrowIcon />)}\n            </Button>\n          </Tooltip>\n        </Toolbar>\n        <Tabs\n          onChange={(e, value) => setTab(value)}\n          value={tab}\n          variant='fullWidth'\n        >\n          <Tab label='Palette' />\n          <Tab label='Properties' />\n        </Tabs>\n        <TabPanel value={tab} index={0}>\n          <Palette onSelect={addObject} />\n        </TabPanel>\n        <TabPanel value={tab} index={1}>\n          <Inspector data={data} selection={selection} onChange={onChange} />\n        </TabPanel>\n      </div>\n    </Drawer>\n  )\n}\n\nexport function Editor (props) {\n  const [data, pushData, undo, redo, setData] = useUndoable(() => scene({}))\n  const [selection, setSelection] = useState(new Set())\n  const [clipboardData, setClipboardData] = useState([])\n  const [isPlaying, setIsPlaying] = useState(false)\n  const [errorMessage, setErrorMessage] = useState(null)\n\n  const classes = useStyles()\n  const cameraRef = useRef()\n\n  /* When the data is changed, updated it, but not update the undo history. */\n  const handleChange = (newData) => {\n    setData(newData)\n  }\n\n  /* When an edit is made, update the undo history. */\n  const handleEdit = (newData) => {\n    pushData(newData)\n  }\n\n  /* When the user clicks the play button. */\n  const handlePlay = () => {\n    const playerSpawn = data.objects.find(x => x.type === 'playerSpawn')\n    if (playerSpawn) {\n      setIsPlaying(true)\n    } else {\n      setErrorMessage('You need to place a spawnpoint first!')\n    }\n  }\n\n  const selectedObjects = data.objects.filter(x => selection.has(x.id))\n  const copy = () => {\n    setClipboardData(selectedObjects)\n  }\n  const paste = () => {\n    const objects = [\n      ...data.objects,\n      ...clipboardData.map(object)\n    ]\n    pushData({\n      ...data,\n      objects\n    })\n  }\n\n  useKeyboardShortcut(['Control', 'Z'], undo)\n  useKeyboardShortcut(['Control', 'Shift', 'Z'], redo)\n  useKeyboardShortcut(['Control', 'C'], copy)\n  useKeyboardShortcut(['Control', 'V'], paste)\n\n  return (\n    <div className={classes.root}>\n      <CssBaseline />\n      <EditorSidebar\n        data={data}\n        selection={selection}\n        onChange={handleEdit}\n        camera={cameraRef}\n        isPlaying={isPlaying}\n        onPlay={handlePlay}\n        onStop={() => { setIsPlaying(false) }}\n      />\n      <main className={classes.content}>\n        {isPlaying\n          ? (\n            <Game data={data} />\n            )\n          : (\n            <ThreeView\n              cameraRef={cameraRef}\n              data={data}\n              selection={selection}\n              onSelectionChange={setSelection}\n              onChange={handleChange}\n              onEdit={handleEdit}\n            />\n            )}\n        <Snackbar\n          open={!!errorMessage}\n          onClose={() => { setErrorMessage(null) }}\n          message={errorMessage}\n        />\n      </main>\n    </div>\n  )\n}\n","import './App.css'\nimport { Editor } from './editor'\n\nfunction App () {\n  return (\n    <div className='App'>\n      <Editor />\n    </div>\n  )\n}\n\nexport default App\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry)\n      getFID(onPerfEntry)\n      getFCP(onPerfEntry)\n      getLCP(onPerfEntry)\n      getTTFB(onPerfEntry)\n    })\n  }\n}\n\nexport default reportWebVitals\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.css'\nimport App from './App'\nimport reportWebVitals from './reportWebVitals'\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n)\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals()\n"],"sourceRoot":""}